{
  "info": {
    "name": "çŒæº‰ç³»ç»ŸAPIæµ‹è¯•é›†åˆ",
    "description": "å†œåœºçŒæº‰ç®¡ç†ç³»ç»Ÿå®Œæ•´APIæµ‹è¯•é›†åˆ",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. ç³»ç»Ÿç®¡ç†",
      "item": [
        {
          "name": "ç³»ç»Ÿåˆå§‹åŒ–",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_file_path\": \"/path/to/config.json\",\n  \"force_reinit\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/system/init",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "system",
                "init"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "å¥åº·æ£€æŸ¥",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/system/health-check",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "system",
                "health-check"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æœåŠ¡å¥åº·çŠ¶æ€æ­£å¸¸\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"healthy\");",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. åŠ¨æ€æ‰§è¡Œ",
      "item": [
        {
          "name": "å¯åŠ¨åŠ¨æ€æ‰§è¡Œ",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_file_path\": \"{{plan_id}}\",\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_file_path\": \"\",\n  \"auto_start\": true,\n  \"water_level_update_interval_minutes\": 30,\n  \"enable_plan_regeneration\": true,\n  \"execution_mode\": \"simulation\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/execution/start",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "execution",
                "start"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰§è¡Œå¯åŠ¨æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // ä¿å­˜execution_idä¾›åç»­ä½¿ç”¨",
                  "    if (jsonData.data && jsonData.data.execution_id) {",
                  "        pm.environment.set(\"execution_id\", jsonData.data.execution_id);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/execution/status?execution_id={{execution_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "execution",
                "status"
              ],
              "query": [
                {
                  "key": "execution_id",
                  "value": "{{execution_id}}"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€æŸ¥è¯¢æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property(\"status\");",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«scenarioä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.selected_scenario) {",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"scenario_name\");",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"pumps_used\");",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"total_batches\");",
                  "        console.log(\"å½“å‰æ‰§è¡Œçš„scenario:\", jsonData.data.selected_scenario.scenario_name);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "åœæ­¢æ‰§è¡Œ",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"execution_id\": \"{{execution_id}}\",\n  \"reason\": \"æ‰‹åŠ¨åœæ­¢æµ‹è¯•\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/execution/stop",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "execution",
                "stop"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "3. æ°´ä½ç®¡ç†",
      "item": [
        {
          "name": "æ›´æ–°æ°´ä½æ•°æ®",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"field_id\": \"{{field_id}}\",\n  \"water_level_mm\": {{water_level}},\n  \"timestamp\": \"2025-01-01T12:00:00Z\",\n  \"source\": \"manual\",\n  \"quality\": \"good\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/water-levels/update",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "water-levels",
                "update"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ°´ä½æ›´æ–°æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–æ°´ä½å†å²",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/history?farm_id={{farm_id}}&field_id={{field_id}}&hours=24",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "water-levels",
                "history"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "field_id",
                  "value": "{{field_id}}"
                },
                {
                  "key": "hours",
                  "value": "24"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–æ°´ä½æ±‡æ€»ï¼ˆæ•°å­—IDï¼‰",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/summary?farm_id={{farm_id}}&use_sgf_format=false",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "water-levels",
                "summary"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "use_sgf_format",
                  "value": "false",
                  "description": "ä½¿ç”¨æ•°å­—IDæ ¼å¼"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"è·å–æ°´ä½æ±‡æ€»æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('total_fields');",
                  "    pm.expect(jsonData).to.have.property('field_details');",
                  "    ",
                  "    // éªŒè¯è¿”å›çš„æ˜¯æ•°å­—IDæ ¼å¼",
                  "    var firstFieldId = Object.keys(jsonData.field_details)[0];",
                  "    pm.expect(firstFieldId).to.match(/^\\d+$/);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "è·å–æ°´ä½æ±‡æ€»ï¼ˆSGFæ ¼å¼ï¼‰",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/summary?farm_id={{farm_id}}&use_sgf_format=true",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "water-levels",
                "summary"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "use_sgf_format",
                  "value": "true",
                  "description": "ä½¿ç”¨SGFæ ¼å¼ï¼ˆå¦‚S1-G2-F03ï¼‰"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"è·å–æ°´ä½æ±‡æ€»æˆåŠŸï¼ˆSGFæ ¼å¼ï¼‰\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('total_fields');",
                  "    pm.expect(jsonData).to.have.property('field_details');",
                  "    ",
                  "    // éªŒè¯è¿”å›çš„æ˜¯SGFæ ¼å¼",
                  "    var firstFieldId = Object.keys(jsonData.field_details)[0];",
                  "    pm.expect(firstFieldId).to.match(/^S\\d+-G\\d+-F\\d+$/);",
                  "    ",
                  "    // éªŒè¯åŒ…å«numeric_idå­—æ®µ",
                  "    var firstField = jsonData.field_details[firstFieldId];",
                  "    pm.expect(firstField).to.have.property('numeric_id');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "è·å–æ°´ä½ç›®æ ‡å€¼",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/targets?farm_id={{farm_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "water-levels",
                "targets"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}",
                  "description": "å†œåœºID"
                },
                {
                  "key": "field_id",
                  "value": "{{field_id}}",
                  "description": "ç”°å—IDï¼ˆå¯é€‰ï¼Œä¸æä¾›åˆ™è¿”å›æ‰€æœ‰ç”°å—ï¼‰",
                  "disabled": true
                }
              ]
            },
            "description": "è·å–æ‰€æœ‰ç”°å—æˆ–æŒ‡å®šç”°å—çš„ç›®æ ‡æ°´ä½å€¼\n\n**è¿”å›å­—æ®µè¯´æ˜**:\n- wl_low: ä½æ°´ä½é˜ˆå€¼ï¼ˆmmï¼‰ï¼Œè§¦å‘çŒæº‰çš„åˆ¤æ–­æ ‡å‡†\n- wl_opt: æœ€ä¼˜æ°´ä½ï¼ˆmmï¼‰ï¼ŒçŒæº‰çš„ç›®æ ‡æ°´ä½\n- wl_high: é«˜æ°´ä½é˜ˆå€¼ï¼ˆmmï¼‰ï¼Œè¶…è¿‡åˆ™ä¸éœ€è¦çŒæº‰\n- source: æ•°æ®æ¥æºï¼ˆglobal_default=ä½¿ç”¨å…¨å±€é»˜è®¤å€¼ï¼Œfield_config=ç”°å—è‡ªå®šä¹‰é…ç½®ï¼‰\n\n**ä½¿ç”¨åœºæ™¯**:\n- å‰ç«¯å±•ç¤ºç”°å—çš„æ°´ä½æ ‡å‡†\n- åˆ¤æ–­ç”°å—æ˜¯å¦éœ€è¦çŒæº‰ï¼ˆå½“å‰æ°´ä½ < wl_lowï¼‰\n- è®¡ç®—çŒæº‰éœ€æ°´é‡ï¼ˆwl_opt - å½“å‰æ°´ä½ï¼‰"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"è·å–æ°´ä½ç›®æ ‡å€¼æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData).to.have.property('global_standards');",
                  "    pm.expect(jsonData).to.have.property('fields');",
                  "    pm.expect(jsonData).to.have.property('total_fields');",
                  "});",
                  "",
                  "pm.test(\"å…¨å±€æ°´ä½æ ‡å‡†åŒ…å«å¿…è¦å­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var global = jsonData.global_standards;",
                  "    pm.expect(global).to.have.property('wl_low');",
                  "    pm.expect(global).to.have.property('wl_opt');",
                  "    pm.expect(global).to.have.property('wl_high');",
                  "    ",
                  "    console.log('\\n=== å…¨å±€æ°´ä½æ ‡å‡† ===');",
                  "    console.log('ä½æ°´ä½é˜ˆå€¼ (wl_low): ' + global.wl_low + ' mm - ä½äºæ­¤å€¼è§¦å‘çŒæº‰');",
                  "    console.log('æœ€ä¼˜æ°´ä½ (wl_opt): ' + global.wl_opt + ' mm - çŒæº‰çš„ç›®æ ‡æ°´ä½');",
                  "    console.log('é«˜æ°´ä½é˜ˆå€¼ (wl_high): ' + global.wl_high + ' mm - è¶…è¿‡æ­¤å€¼ä¸éœ€è¦çŒæº‰');",
                  "    console.log('\\nğŸ’¡ å®é™…çŒæº‰æ·±åº¦ = wl_opt - å½“å‰æ°´ä½ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰');",
                  "});",
                  "",
                  "pm.test(\"ç”°å—æ•°æ®åŒ…å«å¿…è¦å­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fields = jsonData.fields;",
                  "    ",
                  "    if (Object.keys(fields).length > 0) {",
                  "        var firstFieldId = Object.keys(fields)[0];",
                  "        var firstField = fields[firstFieldId];",
                  "        ",
                  "        pm.expect(firstField).to.have.property('wl_low');",
                  "        pm.expect(firstField).to.have.property('wl_opt');",
                  "        pm.expect(firstField).to.have.property('wl_high');",
                  "        pm.expect(firstField).to.have.property('area_mu');",
                  "        pm.expect(firstField).to.have.property('source');",
                  "        ",
                  "        console.log('\\n=== ç”°å—æ°´ä½æ ‡å‡†ç¤ºä¾‹ ===');",
                  "        console.log('ç”°å—ID: ' + firstFieldId);",
                  "        console.log('ä½æ°´ä½é˜ˆå€¼: ' + firstField.wl_low + ' mm');",
                  "        console.log('æœ€ä¼˜æ°´ä½ï¼ˆç›®æ ‡ï¼‰: ' + firstField.wl_opt + ' mm');",
                  "        console.log('é«˜æ°´ä½é˜ˆå€¼: ' + firstField.wl_high + ' mm');",
                  "        console.log('ç”°å—é¢ç§¯: ' + firstField.area_mu + ' äº©');",
                  "        console.log('æ•°æ®æ¥æº: ' + firstField.source);",
                  "        ",
                  "        // ç»Ÿè®¡ä½¿ç”¨è‡ªå®šä¹‰é…ç½®çš„ç”°å—æ•°é‡",
                  "        var customCount = 0;",
                  "        var defaultCount = 0;",
                  "        Object.keys(fields).forEach(function(fid) {",
                  "            if (fields[fid].source === 'field_config') {",
                  "                customCount++;",
                  "            } else {",
                  "                defaultCount++;",
                  "            }",
                  "        });",
                  "        ",
                  "        console.log('\\n=== ç»Ÿè®¡ä¿¡æ¯ ===');",
                  "        console.log('æ€»ç”°å—æ•°: ' + jsonData.total_fields);",
                  "        console.log('ä½¿ç”¨å…¨å±€é»˜è®¤å€¼: ' + defaultCount + ' ä¸ª');",
                  "        console.log('ä½¿ç”¨è‡ªå®šä¹‰é…ç½®: ' + customCount + ' ä¸ª');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4. è®¡åˆ’é‡æ–°ç”Ÿæˆ",
      "item": [
        {
          "name": "æ‰‹åŠ¨é‡æ–°ç”Ÿæˆï¼ˆæ°´ä½ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"batch_index\": 1,\n  \"custom_water_levels\": {\n    \"S3-G5-F3\": {{custom_water_level}}\n  },\n  \"custom_water_level_standards\": {\n    \"S3-G5-F3\": {\n      \"wl_low\": {{custom_wl_low}},\n      \"wl_opt\": {{custom_wl_opt}},\n      \"wl_high\": {{custom_wl_high}}\n    }\n  },\n  \"force_regeneration\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/manual",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "manual"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"é‡æ–°ç”Ÿæˆè¯·æ±‚æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æ°´ä½æ ‡å‡†å‚æ•°\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('wl_low');",
                  "    pm.expect(jsonData).to.have.property('wl_opt');",
                  "    pm.expect(jsonData).to.have.property('wl_high');",
                  "    pm.expect(jsonData).to.have.property('d_target_mm');",
                  "    ",
                  "    console.log('\\n=== å…¨å±€æ°´ä½æ ‡å‡†å‚æ•° ===');",
                  "    console.log('ä½æ°´ä½é˜ˆå€¼ (wl_low): ' + jsonData.wl_low + ' mm - è§¦å‘çŒæº‰çš„åˆ¤æ–­æ ‡å‡†');",
                  "    console.log('æœ€ä¼˜æ°´ä½ (wl_opt): ' + jsonData.wl_opt + ' mm - ç†æƒ³çš„ç”°é—´æŒæ°´é‡');",
                  "    console.log('é«˜æ°´ä½é˜ˆå€¼ (wl_high): ' + jsonData.wl_high + ' mm - è¶…è¿‡åˆ™ä¸éœ€è¦çŒæº‰');",
                  "    console.log('ç›®æ ‡çŒæº‰æ°´æ·± (d_target_mm): ' + jsonData.d_target_mm + ' mm - æ¯æ¬¡çŒæº‰å¢åŠ çš„æ°´æ·±');",
                  "    ",
                  "    // æ£€æŸ¥ç”°å—çº§æ°´ä½æ ‡å‡†ï¼ˆå¦‚æœæœ‰è‡ªå®šä¹‰ï¼‰",
                  "    if (jsonData.field_water_level_standards) {",
                  "        console.log('\\n=== ç”°å—çº§æ°´ä½æ ‡å‡†ï¼ˆè‡ªå®šä¹‰ï¼‰ ===');",
                  "        Object.keys(jsonData.field_water_level_standards).forEach(function(fieldId) {",
                  "            var standards = jsonData.field_water_level_standards[fieldId];",
                  "            console.log('ç”°å— ' + fieldId + ':');",
                  "            console.log('  - wl_low: ' + standards.wl_low + ' mm');",
                  "            console.log('  - wl_opt: ' + standards.wl_opt + ' mm');",
                  "            console.log('  - wl_high: ' + standards.wl_high + ' mm');",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–æ‰§è¡ŒçŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/execution/status",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "execution",
                "status"
              ]
            }
          }
        },
        {
          "name": "æ‰¹æ¬¡é‡æ–°ç”Ÿæˆï¼ˆç”°å—+æ—¶é—´ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"scenario_name\": null,\n  \"field_modifications\": [\n    {\n      \"field_id\": \"{{test_field_add}}\",\n      \"action\": \"add\",\n      \"custom_water_level\": {{custom_water_level}}\n    },\n    {\n      \"field_id\": \"{{test_field_remove}}\",\n      \"action\": \"remove\"\n    }\n  ],\n  \"time_modifications\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"start_time_h\": {{start_time_h}},\n      \"duration_h\": {{duration_h}}\n    }\n  ],\n  \"regeneration_params\": {\n    \"force_regeneration\": true,\n    \"optimize_schedule\": true\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/batch",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "batch"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é‡æ–°ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.original_plan).to.exist;",
                  "    pm.expect(jsonData.modified_plan).to.exist;",
                  "    pm.expect(jsonData.modifications_summary).to.exist;",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜æ–°ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„åˆ°plan_idç¯å¢ƒå˜é‡",
                  "    if (jsonData.modified_plan_path) {",
                  "        pm.environment.set('plan_id', jsonData.modified_plan_path);",
                  "        console.log('âœ… æ–°æ–‡ä»¶è·¯å¾„å·²è‡ªåŠ¨ä¿å­˜åˆ°plan_id:', jsonData.modified_plan_path);",
                  "        console.log('ğŸ’¡ æç¤ºï¼šå¯ä»¥ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºä¸‹ä¸€æ¬¡ä¿®æ”¹çš„è¾“å…¥ï¼');",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"ä¿®æ”¹æ‘˜è¦åŒ…å«é¢„æœŸå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    pm.expect(summary.field_modifications).to.be.an('array');",
                  "    pm.expect(summary.time_modifications).to.be.an('array');",
                  "    pm.expect(summary.total_changes).to.be.a('number');",
                  "    console.log('\\n=== æ¥å£1-ALL: åªä¿®æ”¹ç”°å—å’Œæ—¶é—´ï¼Œä¸æ¶‰åŠæ°´æ³µ ===');",
                  "});",
                  "",
                  "pm.test(\"ä¿®æ”¹æ‘˜è¦åŒ…å«scenarioç»Ÿè®¡ä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    ",
                  "    console.log('\\n=== Scenarioä¿®æ”¹ç»Ÿè®¡ ===');",
                  "    if (summary.scenarios_modified) {",
                  "        console.log('å·²ä¿®æ”¹çš„scenarios:', summary.scenarios_modified.join(', '));",
                  "    }",
                  "    if (summary.scenarios_unchanged) {",
                  "        console.log('æœªä¿®æ”¹çš„scenarios:', summary.scenarios_unchanged.join(', '));",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ‰¹æ¬¡é‡æ–°ç”Ÿæˆï¼ˆæ°´æ³µ+æ—¶é—´ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"scenario_name\": \"{{scenario_name}}\",\n  \"pump_assignments\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"pump_ids\": [\"{{pump_id_1}}\"]\n    }\n  ],\n  \"time_modifications\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"start_time_h\": {{start_time_h}},\n      \"duration_h\": {{duration_h}}\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/batch",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "batch"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é‡æ–°ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜æ–°ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„åˆ°plan_idç¯å¢ƒå˜é‡",
                  "    if (jsonData.modified_plan_path) {",
                  "        pm.environment.set('plan_id', jsonData.modified_plan_path);",
                  "        console.log('âœ… æ–°æ–‡ä»¶è·¯å¾„å·²è‡ªåŠ¨ä¿å­˜åˆ°plan_id:', jsonData.modified_plan_path);",
                  "        console.log('ğŸ’¡ æç¤ºï¼šå¯ä»¥ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºä¸‹ä¸€æ¬¡ä¿®æ”¹çš„è¾“å…¥ï¼');",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"åªä¿®æ”¹äº†æŒ‡å®šçš„scenario\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    ",
                  "    console.log('\\n=== æ¥å£2-scenario: æ°´æ³µ+æ—¶é—´ä¿®æ”¹ï¼ˆåªå½±å“æŒ‡å®šscenarioï¼‰ ===');",
                  "    console.log('æŒ‡å®šä¿®æ”¹:', pm.environment.get('scenario_name'));",
                  "    ",
                  "    if (summary.scenarios_modified) {",
                  "        console.log('å®é™…ä¿®æ”¹çš„scenarios:', summary.scenarios_modified);",
                  "        pm.expect(summary.scenarios_modified).to.include(pm.environment.get('scenario_name'));",
                  "    }",
                  "    ",
                  "    if (summary.scenarios_unchanged) {",
                  "        console.log('æœªä¿®æ”¹çš„scenarios:', summary.scenarios_unchanged);",
                  "    }",
                  "    ",
                  "    // éªŒè¯æ°´æ³µåˆ†é…ä¸­åŒ…å«scenarios_affectedå­—æ®µ",
                  "    if (summary.pump_assignments && summary.pump_assignments.length > 0) {",
                  "        pm.expect(summary.pump_assignments[0]).to.have.property('scenarios_affected');",
                  "        console.log('\\nå—å½±å“çš„scenarios:', summary.pump_assignments[0].scenarios_affected);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æŸ¥è¯¢å¯ç”¨æ–¹æ¡ˆåç§°",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/regeneration/scenarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "scenarios"
              ],
              "query": [
                {
                  "key": "plan_id",
                  "value": "{{plan_id}}",
                  "description": "å¯é€‰ï¼šæŒ‡å®šè®¡åˆ’IDæˆ–æ–‡ä»¶è·¯å¾„ã€‚ä¸æä¾›åˆ™è‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„è®¡åˆ’æ–‡ä»¶",
                  "disabled": true
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æŸ¥è¯¢scenariosæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.exist;",
                  "    pm.expect(jsonData.data.available_scenarios).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨scenarios\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var scenarios = jsonData.data.available_scenarios;",
                  "    ",
                  "    console.log('\\n=== å¯ç”¨çš„Scenarios ===');",
                  "    console.log('æ€»æ•°:', jsonData.data.total_scenarios);",
                  "    console.log('');",
                  "    ",
                  "    scenarios.forEach(function(scenario, index) {",
                  "        console.log(`${index + 1}. ${scenario.scenario_name}`);",
                  "        console.log(`   æ°´æ³µ: ${scenario.pumps_used.join(', ')}`);",
                  "        console.log(`   æ‰¹æ¬¡æ•°: ${scenario.total_batches}`);",
                  "        console.log(`   æ€»æ—¶é•¿: ${scenario.total_eta_h.toFixed(1)}h`);",
                  "        console.log(`   æ€»ç”µè´¹: Â¥${scenario.total_electricity_cost.toFixed(2)}`);",
                  "        if (scenario.optimization_goal) {",
                  "            console.log(`   ä¼˜åŒ–ç›®æ ‡: ${scenario.optimization_goal}`);",
                  "        }",
                  "        console.log('');",
                  "    });",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜ç¬¬ä¸€ä¸ªscenarioåç§°åˆ°ç¯å¢ƒå˜é‡",
                  "    if (scenarios.length > 0) {",
                  "        pm.environment.set('scenario_name', scenarios[0].scenario_name);",
                  "        console.log('âœ… å·²è‡ªåŠ¨è®¾ç½®scenario_nameä¸º:', scenarios[0].scenario_name);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ¸…é™¤ç¼“å­˜",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/regeneration/clear-cache",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "clear-cache"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ¸…é™¤ç¼“å­˜æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    console.log('âœ…', jsonData.message);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–é‡æ–°ç”Ÿæˆæ‘˜è¦",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/regeneration/summary/{{farm_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "regeneration",
                "summary",
                "{{farm_id}}"
              ]
            }
          }
        },
        {
          "name": "æ‰¹æ¬¡é—´ç”°å—è°ƒæ•´",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_id\": \"{{plan_id}}\",\n  \"field_adjustments\": [\n    {\n      \"field_id\": \"{{field_id_move_1}}\",\n      \"from_batch\": {{from_batch_1}},\n      \"to_batch\": {{to_batch_1}}\n    },\n    {\n      \"field_id\": \"{{field_id_move_2}}\",\n      \"from_batch\": {{from_batch_2}},\n      \"to_batch\": {{to_batch_2}}\n    }\n  ],\n  \"options\": {\n    \"recalculate_sequence\": true,\n    \"recalculate_timing\": true,\n    \"maintain_pump_assignments\": true,\n    \"regenerate_commands\": true\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/batch/adjust",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "batch",
                "adjust"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é—´ç”°å—è°ƒæ•´æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.original_plan).to.exist;",
                  "    pm.expect(jsonData.adjusted_plan).to.exist;",
                  "    pm.expect(jsonData.changes_summary).to.exist;",
                  "});",
                  "",
                  "pm.test(\"å˜æ›´æ‘˜è¦åŒ…å«é¢„æœŸå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.changes_summary;",
                  "    pm.expect(summary.total_fields_moved).to.be.a('number');",
                  "    pm.expect(summary.affected_batches).to.be.an('array');",
                  "    pm.expect(summary.field_movements).to.be.an('array');",
                  "    pm.expect(summary.batch_time_changes).to.be.an('array');",
                  "    ",
                  "    console.log('\\n=== æ‰¹æ¬¡è°ƒæ•´ç»“æœ ===');",
                  "    console.log('ç§»åŠ¨ç”°å—æ•°: ' + summary.total_fields_moved);",
                  "    console.log('å—å½±å“æ‰¹æ¬¡: ' + summary.affected_batches.join(', '));",
                  "    ",
                  "    if (summary.batch_time_changes && summary.batch_time_changes.length > 0) {",
                  "        console.log('\\næ‰¹æ¬¡æ—¶é—´å˜åŒ–:');",
                  "        summary.batch_time_changes.forEach(function(change) {",
                  "            console.log('  æ‰¹æ¬¡' + change.batch_index + ': ' + change.old_duration_h + 'h -> ' + change.new_duration_h + 'h (å˜åŒ–: ' + change.time_diff_h + 'h)');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"éªŒè¯é€šè¿‡\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.validation).to.exist;",
                  "    pm.expect(jsonData.validation.is_valid).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ‰¹æ¬¡é—´é¡ºåºè°ƒæ•´",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_id\": \"{{plan_id}}\",\n  \"reorder_configs\": [\n    {\n      \"scenario_name\": \"P1å•ç‹¬ä½¿ç”¨\",\n      \"new_order\": [2, 1, 3, 4, 5, 6, 7, 8, 9, 10]\n    },\n    {\n      \"scenario_name\": \"P2å•ç‹¬ä½¿ç”¨\",\n      \"new_order\": [3, 1, 2, 4, 5, 6, 7, 8, 9, 10]\n    },\n    {\n      \"scenario_name\": \"å…¨éƒ¨æ°´æ³µ(P1+P2)ç»„åˆä½¿ç”¨\",\n      \"new_order\": [2, 1, 3, 4, 5]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/batch/reorder",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "batch",
                "reorder"
              ]
            },
            "description": "è°ƒæ•´æ‰¹æ¬¡çš„æ‰§è¡Œé¡ºåºï¼ˆæ”¯æŒå•ä¸ªæˆ–å¤šä¸ªscenarioï¼‰\n\n**æ–¹å¼1ï¼šè°ƒæ•´å•ä¸ªscenarioï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰**\n```json\n{\n  \"plan_id\": \"irrigation_plan_20251110_133959.json\",\n  \"scenario_name\": \"P2å•ç‹¬ä½¿ç”¨\",\n  \"new_order\": [2, 1, 3, 4, 5, 6, 7, 8, 9, 10]\n}\n```\n\n**æ–¹å¼2ï¼šåŒæ—¶è°ƒæ•´å¤šä¸ªscenariosï¼ˆæ–°åŠŸèƒ½ï¼‰**\n```json\n{\n  \"plan_id\": \"irrigation_plan_20251110_133959.json\",\n  \"reorder_configs\": [\n    {\n      \"scenario_name\": \"P1å•ç‹¬ä½¿ç”¨\",\n      \"new_order\": [2, 1, 3, 4, 5, 6, 7, 8, 9, 10]\n    },\n    {\n      \"scenario_name\": \"P2å•ç‹¬ä½¿ç”¨\",\n      \"new_order\": [3, 1, 2, 4, 5, 6, 7, 8, 9, 10]\n    },\n    {\n      \"scenario_name\": \"å…¨éƒ¨æ°´æ³µ(P1+P2)ç»„åˆä½¿ç”¨\",\n      \"new_order\": [2, 1, 3, 4, 5]\n    }\n  ]\n}\n```\n\n**æ–¹å¼3ï¼šä½¿ç”¨ç›¸åŒé¡ºåºè°ƒæ•´æ‰€æœ‰scenarios**\n```json\n{\n  \"plan_id\": \"irrigation_plan_20251110_133959.json\",\n  \"reorder_configs\": [\n    {\n      \"scenario_name\": null,\n      \"new_order\": [2, 1, 3, 4]\n    }\n  ]\n}\n```\n\n**å‚æ•°è¯´æ˜**:\n- plan_id: è®¡åˆ’IDæˆ–æ–‡ä»¶è·¯å¾„\n- scenario_name: æŒ‡å®šè¦è°ƒæ•´çš„scenarioåç§°ï¼ˆæ–¹å¼1ï¼‰\n- new_order: æ–°çš„æ‰¹æ¬¡æ‰§è¡Œé¡ºåºï¼ˆæ–¹å¼1ï¼‰\n- reorder_configs: å¤šscenarioè°ƒæ•´é…ç½®åˆ—è¡¨ï¼ˆæ–¹å¼2ã€3ï¼‰\n  - scenario_name: scenarioåç§°ï¼Œnullè¡¨ç¤ºæ‰€æœ‰scenario\n  - new_order: è¯¥scenarioçš„æ–°é¡ºåº\n\n**âš ï¸ é‡è¦**:\nä¸åŒscenarioçš„æ‰¹æ¬¡æ•°é‡å¯èƒ½ä¸åŒï¼š\n- P1å•ç‹¬ä½¿ç”¨ï¼š10ä¸ªæ‰¹æ¬¡\n- P2å•ç‹¬ä½¿ç”¨ï¼š10ä¸ªæ‰¹æ¬¡\n- P1+P2ç»„åˆä½¿ç”¨ï¼š5ä¸ªæ‰¹æ¬¡ï¼ˆåŒæ³µæµé‡å¤§ï¼‰\n\n**ä½¿ç”¨åœºæ™¯**:\n- å•scenarioè°ƒæ•´ï¼šåªéœ€è°ƒæ•´ä¸€ä¸ªæ–¹æ¡ˆ\n- å¤šscenarioè°ƒæ•´ï¼šä¸åŒæ–¹æ¡ˆæœ‰ä¸åŒä¼˜å…ˆçº§ç­–ç•¥\n- å…¨å±€è°ƒæ•´ï¼šç»Ÿä¸€åº”å¯¹ç´§æ€¥æƒ…å†µ"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é¡ºåºè°ƒæ•´æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.changes_summary).to.exist;",
                  "});",
                  "",
                  "pm.test(\"æ˜¾ç¤ºè°ƒæ•´ç»“æœ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.changes_summary;",
                  "    ",
                  "    // æ£€æŸ¥æ˜¯å¦ä¸ºå¤šscenarioè°ƒæ•´",
                  "    if (summary.total_scenarios_modified !== undefined) {",
                  "        // å¤šscenarioè°ƒæ•´",
                  "        console.log('\\n=== å¤šScenarioæ‰¹æ¬¡é¡ºåºè°ƒæ•´ç»“æœ ===');",
                  "        console.log('ä¿®æ”¹çš„scenarios: ' + summary.total_scenarios_modified + ' ä¸ª');",
                  "        console.log('å·²ä¿®æ”¹: ' + (summary.scenarios_modified || []).join(', '));",
                  "        console.log('æœªä¿®æ”¹: ' + (summary.scenarios_unchanged || []).join(', '));",
                  "        ",
                  "        // æ˜¾ç¤ºæ¯ä¸ªscenarioçš„å˜åŒ–",
                  "        if (summary.scenario_changes) {",
                  "            Object.keys(summary.scenario_changes).forEach(function(name) {",
                  "                var change = summary.scenario_changes[name];",
                  "                if (change.order_changed) {",
                  "                    console.log('\\nã€' + name + 'ã€‘');",
                  "                    console.log('  åŸé¡ºåº: [' + change.original_order.join(', ') + ']');",
                  "                    console.log('  æ–°é¡ºåº: [' + change.new_order.join(', ') + ']');",
                  "                    console.log('  æ‰¹æ¬¡æ•°: ' + change.total_batches);",
                  "                    ",
                  "                    if (change.batch_movements && change.batch_movements.length > 0) {",
                  "                        console.log('  ä½ç½®å˜åŒ–:');",
                  "                        change.batch_movements.forEach(function(move) {",
                  "                            var direction = move.position_change > 0 ? 'åç§»' : 'å‰ç§»';",
                  "                            console.log('    æ‰¹æ¬¡' + move.batch_index + ': ç¬¬' + move.from_position + 'ä½ -> ç¬¬' + move.to_position + 'ä½ (' + direction + Math.abs(move.position_change) + 'ä½)');",
                  "                        });",
                  "                    }",
                  "                }",
                  "            });",
                  "        }",
                  "    } else {",
                  "        // å•scenarioè°ƒæ•´ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰",
                  "        console.log('\\n=== æ‰¹æ¬¡é¡ºåºè°ƒæ•´ç»“æœ ===');",
                  "        if (summary.order_changed !== undefined && !summary.order_changed) {",
                  "            console.log('æ‰¹æ¬¡é¡ºåºæœªæ”¹å˜');",
                  "        } else {",
                  "            console.log('åŸé¡ºåº: [' + (summary.original_order || []).join(', ') + ']');",
                  "            console.log('æ–°é¡ºåº: [' + (summary.new_order || []).join(', ') + ']');",
                  "            console.log('æ€»æ‰¹æ¬¡æ•°: ' + (summary.total_batches || 0));",
                  "            ",
                  "            if (summary.batch_changes && summary.batch_changes.length > 0) {",
                  "                console.log('\\næ‰¹æ¬¡ä½ç½®å˜åŒ–:');",
                  "                summary.batch_changes.forEach(function(change) {",
                  "                    var direction = change.position_change > 0 ? 'åç§»' : (change.position_change < 0 ? 'å‰ç§»' : 'ä¸å˜');",
                  "                    console.log('  ' + change.batch_name + ': ç¬¬' + change.original_position + 'ä½ -> ç¬¬' + change.new_position + 'ä½ (' + direction + ')');",
                  "                });",
                  "            }",
                  "        }",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"éªŒè¯é€šè¿‡\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.validation) {",
                  "        pm.expect(jsonData.validation.is_valid).to.be.true;",
                  "    }",
                  "});",
                  "",
                  "// è‡ªåŠ¨ä¿å­˜è¾“å‡ºæ–‡ä»¶è·¯å¾„",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.output_file) {",
                  "        pm.environment.set('plan_id', jsonData.output_file);",
                  "        console.log('\\nâœ… å·²è‡ªåŠ¨æ›´æ–° plan_id: ' + jsonData.output_file);",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5. æ‰¹æ¬¡ç®¡ç†",
      "item": [
        {
          "name": "è·å–æ‰¹æ¬¡åˆ—è¡¨",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/batches?farm_id={{farm_id}}&status=active",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "batches"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "status",
                  "value": "active"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–æ‰¹æ¬¡è¯¦æƒ…",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/batches/{{batch_index}}/details",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "batches",
                "{{batch_index}}",
                "details"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "6. çŒæº‰è®¡åˆ’ç”Ÿæˆ",
      "item": [
        {
          "name": "ç”ŸæˆçŒæº‰è®¡åˆ’",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_path\": \"{{config_file_path}}\",\n  \"output_dir\": \"{{output_dir}}\",\n  \"scenario_name\": \"test_scenario\",\n  \"multi_pump_scenarios\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-generation",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "plan-generation"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"è®¡åˆ’ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // ä¿å­˜plan_idä¾›åç»­ä½¿ç”¨ï¼ˆplan_idåœ¨å“åº”æ ¹çº§åˆ«ï¼‰",
                  "    if (jsonData.plan_id) {",
                  "        pm.environment.set(\"plan_id\", jsonData.plan_id);",
                  "        console.log(\"âœ… plan_idå·²è‡ªåŠ¨è®¾ç½®: \" + jsonData.plan_id);",
                  "    } else {",
                  "        console.log(\"âš ï¸ å“åº”ä¸­æ²¡æœ‰æ‰¾åˆ°plan_id\");",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "ä¸Šä¼ å¹¶ç”Ÿæˆè®¡åˆ’",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "config_file",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}",
                  "type": "text"
                },
                {
                  "key": "scenario_name",
                  "value": "upload_test",
                  "type": "text"
                },
                {
                  "key": "multi_pump_scenarios",
                  "value": "true",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-with-upload",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "plan-with-upload"
              ]
            }
          }
        },
        {
          "name": "å¤šæ°´æ³µæ–¹æ¡ˆå¯¹æ¯”",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"config_file\": \"config.json\",\n  \"active_pumps\": null,\n  \"zone_ids\": null,\n  \"use_realtime_wl\": true,\n  \"min_fields_trigger\": {{min_fields_trigger}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/multi-pump-scenarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "multi-pump-scenarios"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"å¤šæ°´æ³µæ–¹æ¡ˆç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.scenarios).to.be.an('array');",
                  "    pm.expect(jsonData.analysis).to.be.an('object');",
                  "    pm.expect(jsonData.total_scenarios).to.be.a('number');",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«è§¦å‘æ¡ä»¶ä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.analysis) {",
                  "        pm.expect(jsonData.analysis).to.have.property('min_fields_trigger');",
                  "        console.log('è§¦å‘é˜ˆå€¼:', jsonData.analysis.min_fields_trigger);",
                  "        console.log('ä½äºé˜ˆå€¼çš„ç”°å—æ•°:', jsonData.analysis.total_fields_below_threshold);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "çŒæº‰è®¡åˆ’ä¼˜åŒ–",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"optimization_goals\": [\n    \"cost_minimization\",\n    \"time_minimization\",\n    \"balanced\",\n    \"off_peak\"\n  ],\n  \"constraints\": {\n    \"max_duration_hours\": 24,\n    \"electricity_price_schedule\": {\n      \"peak\": {\n        \"hours\": [8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],\n        \"price\": 1.0\n      },\n      \"valley\": {\n        \"hours\": [22, 23, 0, 1, 2, 3, 4, 5, 6, 7],\n        \"price\": 0.4\n      }\n    },\n    \"available_pumps\": [\"P1\", \"P2\"]\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-optimization",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "plan-optimization"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"ä¼˜åŒ–æ–¹æ¡ˆç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.total_scenarios).to.be.above(0);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«ä¼˜åŒ–æ–¹æ¡ˆ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.scenarios).to.be.an('array');",
                  "    pm.expect(jsonData.comparison).to.be.an('object');",
                  "    pm.expect(jsonData.base_plan_summary).to.be.an('object');",
                  "    ",
                  "    console.log('\\n=== ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯” ===');",
                  "    jsonData.scenarios.forEach(function(scenario) {",
                  "        console.log(scenario.name + ':');",
                  "        console.log('  - æ€»æ—¶é•¿: ' + scenario.total_eta_h.toFixed(1) + 'å°æ—¶');",
                  "        console.log('  - æ€»ç”µè´¹: Â¥' + scenario.total_electricity_cost.toFixed(2));",
                  "        console.log('  - è¯´æ˜: ' + scenario.description);",
                  "    });",
                  "    ",
                  "    console.log('\\næ¨èæ–¹æ¡ˆ: ' + jsonData.comparison.recommended);",
                  "    console.log('ç”µè´¹èŒƒå›´: Â¥' + jsonData.comparison.cost_range.min.toFixed(2) + ' - Â¥' + jsonData.comparison.cost_range.max.toFixed(2));",
                  "    console.log('æ—¶é•¿èŒƒå›´: ' + jsonData.comparison.time_range.min.toFixed(1) + 'h - ' + jsonData.comparison.time_range.max.toFixed(1) + 'h');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "7. Webå¯è§†åŒ–",
      "item": [
        {
          "name": "è·å–GeoJSONæ•°æ®",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/geojson/fields?farm_id={{farm_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "geojson",
                "fields"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–ç›‘æ§é¢æ¿æ•°æ®",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/monitoring/dashboard?farm_id={{farm_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "monitoring",
                "dashboard"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "ç¡¬ä»¶è®¾å¤‡ç®¡ç†",
      "item": [
        {
          "name": "æŸ¥è¯¢æ‰€æœ‰ç”°å—è®¾å¤‡çŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/hardware/fields-device-status?farm_id={{farm_id}}&timeout=30&verbose=false",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "hardware",
                "fields-device-status"
              ],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}",
                  "description": "å†œåœºIDï¼ˆå¦‚ï¼š13944136728576 æ¸¯ä¸­åªï¼Œ84911829811210 å²³éº“ï¼Œ47035753446400 å³¨æ¡¥ï¼‰"
                },
                {
                  "key": "app_id",
                  "value": "{{app_id}}",
                  "description": "åº”ç”¨IDï¼ˆå¯é€‰ï¼Œé»˜è®¤ä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰",
                  "disabled": true
                },
                {
                  "key": "secret",
                  "value": "{{secret}}",
                  "description": "å¯†é’¥ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰",
                  "disabled": true
                },
                {
                  "key": "timeout",
                  "value": "30",
                  "description": "è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰"
                },
                {
                  "key": "verbose",
                  "value": "false",
                  "description": "æ˜¯å¦æ‰“å°è¯¦ç»†ä¿¡æ¯"
                }
              ]
            },
            "description": "æ ¹æ®å†œåœºIDè·å–æ‰€æœ‰ç”°å—å¯¹åº”è®¾å¤‡çš„çŠ¶æ€\n\nå®Œæ•´æµç¨‹ï¼š\n1. æ ¹æ®å†œåœºIDè·å–å†œåœºåç§°ï¼ˆä» farm_id_mapping.jsonï¼‰\n2. æ ¹æ®å†œåœºåç§°æŸ¥æ‰¾CSVæ–‡ä»¶ï¼Œæå–ç”°å—IDåˆ—è¡¨\n3. å¯¹æ¯ä¸ªç”°å—IDï¼Œè·å–å…¶è®¾å¤‡æ˜ å°„ï¼ˆç”°å—ID -> è®¾å¤‡ç¼–ç  -> è®¾å¤‡ä¿¡æ¯ -> uniqueNoï¼‰\n4. å¯¹æ¯ä¸ªè®¾å¤‡çš„uniqueNoï¼ŒæŸ¥è¯¢è®¾å¤‡çŠ¶æ€ï¼ˆé—¸é—¨å¼€åº¦ç­‰ï¼‰"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success');",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«å†œåœºä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.success && jsonData.data) {",
                  "        pm.expect(jsonData.data).to.have.property('farm_id');",
                  "        pm.expect(jsonData.data).to.have.property('farm_name');",
                  "        pm.expect(jsonData.data).to.have.property('total_fields');",
                  "        pm.expect(jsonData.data).to.have.property('fields');",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"ç”°å—åŒ…å«section_codeå’Œgates_codeå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.success && jsonData.data && jsonData.data.fields.length > 0) {",
                  "        var firstField = jsonData.data.fields[0];",
                  "        pm.expect(firstField).to.have.property('field_id');",
                  "        pm.expect(firstField).to.have.property('field_name');",
                  "        ",
                  "        // æ£€æŸ¥section_codeå­—æ®µï¼ˆS-G-Fæ ¼å¼ï¼‰",
                  "        if (firstField.section_code) {",
                  "            pm.expect(firstField.section_code).to.match(/^S\\d+-G\\d+-F\\d+$/);",
                  "            ",
                  "            // æ£€æŸ¥gates_codeå­—æ®µï¼ˆS-Gæ ¼å¼ï¼‰",
                  "            if (firstField.gates_code) {",
                  "                pm.expect(firstField.gates_code).to.match(/^S\\d+-G\\d+$/);",
                  "                // éªŒè¯gates_codeæ˜¯section_codeçš„å‰ç¼€",
                  "                pm.expect(firstField.section_code).to.include(firstField.gates_code);",
                  "                console.log('âœ… ç¤ºä¾‹ç”°å—: ID=' + firstField.field_id + ', Name=' + firstField.field_name + ', SectionCode=' + firstField.section_code + ', GatesCode=' + firstField.gates_code);",
                  "            }",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è®¾å¤‡è‡ªæ£€å®Œæ•´å·¥ä½œæµ",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"wait_minutes\": 2,\n  \"enable_polling\": true,\n  \"max_polling_attempts\": 5,\n  \"polling_interval_seconds\": 30,\n  \"auto_regenerate\": false,\n  \"timeout\": 30\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/hardware/device-self-check-workflow",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "hardware",
                "device-self-check-workflow"
              ]
            },
            "description": "è®¾å¤‡è‡ªæ£€å®Œæ•´å·¥ä½œæµï¼ˆæ”¯æŒè½®è¯¢æ¨¡å¼ï¼‰\n\n**å·¥ä½œæµç¨‹**ï¼š\n1. ä»çŒæº‰è®¡åˆ’è·å–éœ€è¦çŒæº‰çš„ç”°å—\n2. è·å–ç”°å—å¯¹åº”çš„è®¾å¤‡unique_no\n3. è§¦å‘è®¾å¤‡è‡ªæ£€\n4. ç­‰å¾…æŒ‡å®šæ—¶é—´\n5. æŸ¥è¯¢è®¾å¤‡è‡ªæ£€çŠ¶æ€ï¼ˆè½®è¯¢æ¨¡å¼ï¼šæŒç»­æŸ¥è¯¢ç›´åˆ°å®Œæˆï¼‰\n6. è¿‡æ»¤è‡ªæ£€æˆåŠŸçš„è®¾å¤‡\n7. ç§»é™¤è‡ªæ£€å¤±è´¥çš„ç”°å—ï¼Œé‡æ–°ç”Ÿæˆè®¡åˆ’\n8. è¿”å›æ–°è®¡åˆ’ä¸­çš„è®¾å¤‡åˆ—è¡¨\n\n**æ³¨æ„**ï¼šå·²ç§»é™¤é¢„æ£€æŸ¥æ­¥éª¤ï¼Œç›´æ¥å¯¹æ‰€æœ‰iLandå¹³å°è¿”å›çš„è®¾å¤‡è§¦å‘è‡ªæ£€\n\n**å‚æ•°è¯´æ˜**ï¼š\n- farm_id: å†œåœºIDï¼ˆå¿…å¡«ï¼‰\n- plan_id: çŒæº‰è®¡åˆ’IDï¼ˆå¯é€‰ï¼Œç•™ç©ºä½¿ç”¨æœ€æ–°è®¡åˆ’ï¼‰\n- scenario_name: æ–¹æ¡ˆåç§°ï¼ˆå¯é€‰ï¼‰\n- wait_minutes: åˆæ¬¡ç­‰å¾…æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤5åˆ†é’Ÿ\n- enable_polling: æ˜¯å¦å¯ç”¨è½®è¯¢æ¨¡å¼ï¼ˆé»˜è®¤trueï¼Œæ¨èï¼‰\n- max_polling_attempts: æœ€å¤§è½®è¯¢æ¬¡æ•°ï¼ˆé»˜è®¤10æ¬¡ï¼‰\n- polling_interval_seconds: è½®è¯¢é—´éš”ï¼ˆé»˜è®¤30ç§’ï¼‰\n- auto_regenerate: æ˜¯å¦è‡ªåŠ¨é‡æ–°ç”Ÿæˆè®¡åˆ’\n- timeout: APIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰\n\n**è½®è¯¢æ¨¡å¼è¯´æ˜**ï¼š\n- å¯ç”¨åä¼šæŒç»­æŸ¥è¯¢è®¾å¤‡çŠ¶æ€ï¼Œç›´åˆ°æ‰€æœ‰è®¾å¤‡å®Œæˆè‡ªæ£€ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰\n- é¿å…å› è®¾å¤‡è‡ªæ£€æ—¶é—´é•¿è€Œè¢«è¯¯åˆ¤ä¸ºå¤±è´¥\n- æœ€å¤šæŸ¥è¯¢ max_polling_attempts æ¬¡ï¼Œæ¯æ¬¡é—´éš” polling_interval_seconds ç§’\n\n**è®¾å¤‡çŠ¶æ€**ï¼š\n- check_success: è‡ªæ£€æˆåŠŸ âœ…\n- check_failed: è‡ªæ£€å¤±è´¥ âŒ\n- checking: è‡ªæ£€ä¸­ ğŸ”„ï¼ˆè½®è¯¢æ¨¡å¼ä¼šç»§ç»­ç­‰å¾…ï¼‰\n- initialized/scheduled: åˆå§‹åŒ–/å·²è°ƒåº¦\n\n**æ³¨æ„äº‹é¡¹**ï¼š\n- æ€»è€—æ—¶ â‰ˆ wait_minutes + (max_polling_attempts Ã— polling_interval_seconds)\n- è¯·ç¡®ä¿APIç½‘å…³è¶…æ—¶è®¾ç½®è¶³å¤Ÿé•¿\n- æµ‹è¯•ç¯å¢ƒå»ºè®®ï¼šwait_minutes=1, max_polling_attempts=5\n- ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼šwait_minutes=5, max_polling_attempts=10\n- **è·¯å¾„æ ¼å¼**ï¼šplan_idç•™ç©ºä½¿ç”¨æœ€æ–°è®¡åˆ’ï¼Œæˆ–ä½¿ç”¨ç›¸å¯¹è·¯å¾„/æ­£æ–œæ è·¯å¾„ï¼Œé¿å…åæ–œæ å¯¼è‡´JSONè§£æé”™è¯¯"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"æ˜¾ç¤ºè‡ªæ£€ç»“æœ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data) {",
                  "        console.log('\\n=== è®¾å¤‡è‡ªæ£€ç»“æœ ===');",
                  "        console.log('æ€»è®¾å¤‡æ•°:', jsonData.data.total_devices);",
                  "        console.log('è‡ªæ£€æˆåŠŸ:', jsonData.data.successful_devices);",
                  "        console.log('è‡ªæ£€å¤±è´¥:', jsonData.data.failed_devices);",
                  "        ",
                  "        console.log('\\n=== ç”°å—å¤„ç†ç»“æœ ===');",
                  "        console.log('æ€»ç”°å—æ•°:', jsonData.data.total_fields);",
                  "        console.log('ä¿ç•™ç”°å—:', jsonData.data.successful_fields);",
                  "        console.log('ç§»é™¤ç”°å—:', jsonData.data.failed_fields);",
                  "        ",
                  "        if (jsonData.data.failed_field_ids && jsonData.data.failed_field_ids.length > 0) {",
                  "            console.log('å¤±è´¥ç”°å—ID:', jsonData.data.failed_field_ids.join(', '));",
                  "        }",
                  "        ",
                  "        if (jsonData.data.new_plan_file) {",
                  "            console.log('\\nâœ… æ–°è®¡åˆ’æ–‡ä»¶:', jsonData.data.new_plan_file);",
                  "            pm.environment.set('plan_id', jsonData.data.new_plan_file);",
                  "        }",
                  "        ",
                  "        console.log('\\n=== æœ€ç»ˆè®¾å¤‡åˆ—è¡¨ ===');",
                  "        console.log('éœ€è¦çŒæº‰çš„è®¾å¤‡æ•°:', jsonData.data.final_device_list.length);",
                  "        ",
                  "        if (jsonData.data.final_device_list.length > 0) {",
                  "            console.log('å‰5ä¸ªè®¾å¤‡:', jsonData.data.final_device_list.slice(0, 5).join(', '));",
                  "        }",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"éªŒè¯è®¾å¤‡çŠ¶æ€è¯¦æƒ…\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.device_status_details) {",
                  "        pm.expect(jsonData.data.device_status_details).to.be.an('array');",
                  "        ",
                  "        // ç»Ÿè®¡å„çŠ¶æ€è®¾å¤‡æ•°é‡",
                  "        var statusCount = {};",
                  "        jsonData.data.device_status_details.forEach(function(device) {",
                  "            var status = device.status || 'unknown';",
                  "            statusCount[status] = (statusCount[status] || 0) + 1;",
                  "        });",
                  "        ",
                  "        console.log('\\n=== è®¾å¤‡çŠ¶æ€åˆ†å¸ƒ ===');",
                  "        Object.keys(statusCount).forEach(function(status) {",
                  "            console.log(status + ':', statusCount[status] + 'ä¸ª');",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "8.æ™ºèƒ½å†³ç­–é›†æˆ",
      "item": [
        {
          "name": "æ£€æŸ¥æœåŠ¡çŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/irrigation/rice-status",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "rice-status"
              ],
              "query": []
            },
            "description": "æ£€æŸ¥ rice_smart_irrigation æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\n\n**ä½¿ç”¨åœºæ™¯**:\n- åœ¨ç”Ÿæˆè®¡åˆ’å‰éªŒè¯ Rice æœåŠ¡å¯ç”¨æ€§\n- ç›‘æ§æœåŠ¡å¥åº·çŠ¶æ€"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å« success å­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success');",
                  "});",
                  "",
                  "pm.test(\"Rice æœåŠ¡çŠ¶æ€æ£€æŸ¥\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.success) {",
                  "        console.log('âœ… Rice æœåŠ¡æ­£å¸¸');",
                  "    } else {",
                  "        console.log('âš ï¸ Rice æœåŠ¡å¼‚å¸¸:', jsonData.message);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ›´æ–°é…ç½®ï¼ˆconfig.jsonï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/update-config-from-rice",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "update-config-from-rice"
              ]
            },
            "description": "ã€ç‹¬ç«‹æ¥å£ã€‘ä» Rice è·å–å†³ç­–å¹¶æ›´æ–° config.json\n\n**è®¾è®¡ç†å¿µ**:\n- èŒè´£å•ä¸€ï¼šåªè´Ÿè´£é…ç½®æ›´æ–°ï¼Œä¸ç”Ÿæˆè®¡åˆ’\n- çµæ´»å¤ç”¨ï¼šæ›´æ–°åå¯è°ƒç”¨ä»»æ„æ¥å£\n- RESTful è®¾è®¡ï¼šç¬¦åˆå•ä¸€èŒè´£åŸåˆ™\n\n**å·¥ä½œæµç¨‹**:\n1. è°ƒç”¨ Rice API è·å–æ™ºèƒ½å†³ç­–\n2. æ˜ å°„ sectionID â†’ field_id\n3. å¤‡ä»½å½“å‰ config.json\n4. æ›´æ–° config.json ä¸­çš„æ°´ä½å‚æ•°\n5. è¿”å›æ›´æ–°è¯¦æƒ…å’Œå¤‡ä»½è·¯å¾„\n\n**åç»­ä½¿ç”¨**:\næ›´æ–°é…ç½®åï¼Œå¯ä»¥è°ƒç”¨ä»¥ä¸‹ä»»æ„æ¥å£ï¼š\n- /api/irrigation/plan-generationï¼ˆç”Ÿæˆè®¡åˆ’ï¼‰\n- /api/regeneration/batchï¼ˆæ‰¹æ¬¡é‡æ–°ç”Ÿæˆï¼‰\n- /api/water-levels/targetsï¼ˆæŸ¥çœ‹æ°´ä½ç›®æ ‡ï¼‰\n\n**ä½¿ç”¨åœºæ™¯**:\n1. åªæƒ³æ›´æ–°é…ç½®ï¼Œæš‚ä¸ç”Ÿæˆè®¡åˆ’\n2. éœ€è¦åŸºäº Rice é…ç½®è°ƒç”¨å¤šä¸ªæ¥å£\n3. éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµç¨‹"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"é…ç½®å·²æ›´æ–°\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.config_backup).to.be.a('string');",
                  "    console.log('âœ… é…ç½®å·²æ›´æ–°ï¼Œå¤‡ä»½æ–‡ä»¶:', jsonData.config_backup);",
                  "    console.log('ğŸ“Š Rice å†³ç­–ç»Ÿè®¡:');",
                  "    console.log('  - æ€»å†³ç­–æ•°:', jsonData.decision_count);",
                  "    console.log('  - éœ€è¦çŒæº‰:', jsonData.irrigate_count);",
                  "});",
                  "",
                  "pm.test(\"æ˜¾ç¤ºåç»­æ­¥éª¤\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.details && jsonData.details.next_steps) {",
                  "        console.log('ğŸ“‹ åç»­å¯æ‰§è¡Œçš„æ“ä½œ:');",
                  "        jsonData.details.next_steps.forEach((step, index) => {",
                  "            console.log(`  ${index + 1}. ${step}`);",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ™ºèƒ½å†³ç­–ç”ŸæˆçŒæº‰è®¡åˆ’ï¼ˆæµ‹è¯•ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"pumps\": \"P1,P2\",\n  \"time_constraints\": false,\n  \"auto_execute\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/generate-from-rice",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "generate-from-rice"
              ]
            },
            "description": "åŸºäº rice_smart_irrigation çš„æ™ºèƒ½å†³ç­–ç”ŸæˆçŒæº‰è®¡åˆ’\n\n**å·¥ä½œæµç¨‹**:\n1. è°ƒç”¨ Rice API è·å–æ™ºèƒ½å†³ç­–\n2. æ˜ å°„ section_id â†’ field_id\n3. ç”ŸæˆçŒæº‰è®¡åˆ’\n4. (å¯é€‰) è‡ªåŠ¨å¯åŠ¨æ‰§è¡Œ\n\n**å‚æ•°è¯´æ˜**:\n- `farm_id`: å†œåœºIDï¼ˆå¿…å¡«ï¼‰\n- `rice_api_url`: Rice API åœ°å€ï¼ˆé»˜è®¤: http://localhost:5000/v1/rice_irrigationï¼‰\n- `pumps`: å¯ç”¨çš„æ°´æ³µï¼ˆé»˜è®¤: P1,P2ï¼‰\n- `time_constraints`: æ˜¯å¦å¯ç”¨æ—¶é—´çº¦æŸï¼ˆé»˜è®¤: falseï¼‰\n- `auto_execute`: æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆçš„è®¡åˆ’ï¼ˆé»˜è®¤: falseï¼‰\n\n**ä¸ä¼ ç»Ÿæ–¹æ³•çš„åŒºåˆ«**:\n- ä¼ ç»Ÿ: åŸºäºå›ºå®šé˜ˆå€¼ (wl_low/wl_opt)\n- Riceé›†æˆ: åŸºäºç”Ÿè‚²æœŸã€å¤©æ°”ã€å†œäº‹æ“ä½œçš„åŠ¨æ€å†³ç­–"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"åŒ…å«è®¡åˆ’æ–‡ä»¶è·¯å¾„\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.plan_file) {",
                  "        pm.expect(jsonData.plan_file).to.be.a('string');",
                  "        pm.environment.set('plan_id', jsonData.plan_file);",
                  "        console.log('âœ… è®¡åˆ’å·²ç”Ÿæˆ:', jsonData.plan_file);",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"å†³ç­–ç»Ÿè®¡ä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('ğŸ“Š Rice å†³ç­–ç»Ÿè®¡:');",
                  "    console.log('  - æ€»å†³ç­–æ•°:', jsonData.decision_count);",
                  "    console.log('  - éœ€è¦çŒæº‰:', jsonData.irrigate_count);",
                  "    ",
                  "    if (jsonData.details) {",
                  "        console.log('  - æ˜ å°„æ€»æ•°:', jsonData.details.mapping_count);",
                  "        console.log('  - è½¬æ¢æˆåŠŸ:', jsonData.details.converted_count);",
                  "        if (jsonData.details.skipped_sections && jsonData.details.skipped_sections.length > 0) {",
                  "            console.log('  âš ï¸ è·³è¿‡çš„ç”°å—:', jsonData.details.skipped_sections);",
                  "        }",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"æ‰§è¡ŒçŠ¶æ€æ£€æŸ¥\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.execution_id) {",
                  "        console.log('âœ… å·²è‡ªåŠ¨å¯åŠ¨æ‰§è¡Œï¼Œæ‰§è¡ŒID:', jsonData.execution_id);",
                  "        pm.environment.set('execution_id', jsonData.execution_id);",
                  "    } else {",
                  "        console.log('â„¹ï¸ æœªè‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ™ºèƒ½å†³ç­–ç”Ÿæˆå¹¶è‡ªåŠ¨æ‰§è¡Œï¼ˆæµ‹è¯•ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"pumps\": \"P1,P2\",\n  \"time_constraints\": false,\n  \"auto_execute\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/generate-from-rice",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "generate-from-rice"
              ]
            },
            "description": "åŸºäº Rice æ™ºèƒ½å†³ç­–ç”ŸæˆçŒæº‰è®¡åˆ’å¹¶è‡ªåŠ¨æ‰§è¡Œ\n\n**æ³¨æ„**: \n- æ­¤è¯·æ±‚ä¼šè‡ªåŠ¨å¯åŠ¨æ‰§è¡Œ\n- å»ºè®®å…ˆä½¿ç”¨ä¸è‡ªåŠ¨æ‰§è¡Œçš„ç‰ˆæœ¬æ£€æŸ¥è®¡åˆ’\n- ç”Ÿäº§ç¯å¢ƒä¸­éœ€è°¨æ…ä½¿ç”¨\n- rice_api_url ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„é»˜è®¤å€¼ï¼ˆæœ¬åœ°: localhost:5000, ç”Ÿäº§: rice-backend:5000ï¼‰"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"å·²è‡ªåŠ¨å¯åŠ¨æ‰§è¡Œ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.execution_id).to.not.be.null;",
                  "    pm.environment.set('execution_id', jsonData.execution_id);",
                  "    console.log('âœ… æ‰§è¡Œå·²å¯åŠ¨ï¼Œæ‰§è¡ŒID:', jsonData.execution_id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "åˆ—å‡ºé…ç½®å¤‡ä»½",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/irrigation/list-backups",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "list-backups"
              ]
            },
            "description": "åˆ—å‡ºæ‰€æœ‰é…ç½®å¤‡ä»½æ–‡ä»¶\n\nç”¨äºæŸ¥çœ‹åœ¨ä½¿ç”¨ Rice å†³ç­–æ—¶è‡ªåŠ¨åˆ›å»ºçš„å¤‡ä»½æ–‡ä»¶ã€‚"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"åˆ—å‡ºå¤‡ä»½æ–‡ä»¶\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('ğŸ“¦ æ‰¾åˆ°', jsonData.total_backups, 'ä¸ªå¤‡ä»½æ–‡ä»¶');",
                  "    if (jsonData.backups && jsonData.backups.length > 0) {",
                  "        console.log('æœ€æ–°å¤‡ä»½:', jsonData.backups[0].filename);",
                  "        pm.environment.set('latest_backup', jsonData.backups[0].filename);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ¢å¤é…ç½®",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/irrigation/restore-config?backup_file={{latest_backup}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "irrigation",
                "restore-config"
              ],
              "query": [
                {
                  "key": "backup_file",
                  "value": "{{latest_backup}}",
                  "description": "å¤‡ä»½æ–‡ä»¶åï¼ˆå¦‚ config_backup_20251120_123456.jsonï¼‰"
                }
              ]
            },
            "description": "ä»å¤‡ä»½æ¢å¤ config.json\n\n**ä½¿ç”¨åœºæ™¯**:\n- åœ¨ä½¿ç”¨ Rice å†³ç­–åæƒ³æ¢å¤åˆ°åŸå§‹é…ç½®\n- å›æ»šåˆ°ä¹‹å‰çš„é…ç½®çŠ¶æ€\n\n**æ³¨æ„**:\n- éœ€è¦å…ˆè°ƒç”¨\"åˆ—å‡ºé…ç½®å¤‡ä»½\"è·å–å¤‡ä»½æ–‡ä»¶å\n- æˆ–æ‰‹åŠ¨æŒ‡å®šå¤‡ä»½æ–‡ä»¶å"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"é…ç½®å·²æ¢å¤\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('âœ… é…ç½®å·²ä»å¤‡ä»½æ¢å¤:', jsonData.restored_from);",
                  "    console.log('ğŸ“¦ å½“å‰é…ç½®å·²å¤‡ä»½ä¸º:', jsonData.current_config_backup);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€é¢„è¯·æ±‚è„šæœ¬",
          "console.log('å‘é€è¯·æ±‚åˆ°:', pm.request.url);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€æµ‹è¯•è„šæœ¬",
          "pm.test('å“åº”æ—¶é—´å°äº5ç§’', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});"
        ]
      }
    }
  ]
}