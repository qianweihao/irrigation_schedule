# rice â†’ farm æ™ºèƒ½çŒæº‰æ¡¥æ¥æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆè¯´æ˜

æœ¬æ–¹æ¡ˆå®ç°äº† **rice_smart_irrigation** å’Œ **farm_irrigation** çš„æ— ç¼é›†æˆï¼Œé‡‡ç”¨**é›¶ä¿®æ”¹**ç­–ç•¥ï¼š
- âœ… ä¸ä¿®æ”¹ rice_smart_irrigation çš„ä»»ä½•ä»£ç 
- âœ… ä¸ä¿®æ”¹ farm_irrigation çš„ä»»ä½•ä»£ç 
- âœ… åªæ·»åŠ ä¸€ä¸ªç‹¬ç«‹çš„æ¡¥æ¥è„šæœ¬

## ğŸ¯ æ ¸å¿ƒåŸç†

1. **rice_smart_irrigation** è´Ÿè´£æ™ºèƒ½å†³ç­–ï¼ˆè€ƒè™‘ç”Ÿè‚²æœŸã€å¤©æ°”ã€å†œäº‹ç­‰å› ç´ ï¼‰
2. **æ¡¥æ¥è„šæœ¬** è´Ÿè´£æ ¼å¼è½¬æ¢å’Œå‚æ•°è°ƒæ•´
3. **farm_irrigation** è´Ÿè´£ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼ˆæ‰¹æ¬¡è°ƒåº¦ã€è®¾å¤‡æ§åˆ¶ï¼‰

### å·¥ä½œæµç¨‹

```
rice API (æ™ºèƒ½å†³ç­–)
    â†“
æ¡¥æ¥è„šæœ¬ (æ ¼å¼è½¬æ¢)
    â†“ åˆ›å»ºä¸´æ—¶é…ç½®
    â†“ wl_low = current + 1
    â†“ wl_opt = rice_target
    â†“
farm_irrigation (ç”Ÿæˆè®¡åˆ’)
    â†“
çŒæº‰æ‰§è¡Œè®¡åˆ’
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **å¯åŠ¨ rice_smart_irrigation åç«¯**
```bash
cd E:\rice_smart_irrigation\rice_smart_irrigation\backend\src
set USE_EXTERNAL_DB=1
python app.py
```

2. **ç¡®ä¿ farm_irrigation é…ç½®å­˜åœ¨**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls E:\irrigation_schedule\farm_irrigation\config.json
```

### åŸºæœ¬ä½¿ç”¨

```bash
cd E:\irrigation_schedule

# åŸºæœ¬ç”¨æ³•ï¼ˆä½¿ç”¨é»˜è®¤æ°´æ³µ P1,P2ï¼‰
python rice_to_farm_bridge.py --farm-id 13944136728576

# æŒ‡å®šå•ä¸ªæ°´æ³µ
python rice_to_farm_bridge.py --farm-id 13944136728576 --pumps P1

# å¯ç”¨æ—¶é—´çº¦æŸ
python rice_to_farm_bridge.py --farm-id 13944136728576 --time-constraints

# ä¿ç•™ä¸´æ—¶é…ç½®ï¼ˆç”¨äºè°ƒè¯•ï¼‰
python rice_to_farm_bridge.py --farm-id 13944136728576 --keep-temp
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

```
======================================================================
rice â†’ farm æ™ºèƒ½çŒæº‰æ¡¥æ¥
é›¶ä¿®æ”¹æ–¹æ¡ˆï¼šä¸ä¿®æ”¹ä»»ä½•é¡¹ç›®ä»£ç 
å†œåœºID: 13944136728576
æ°´æ³µ: P1,P2
======================================================================

æ­£åœ¨è·å–å†œåœº 13944136728576 çš„æ™ºèƒ½å†³ç­–...
âœ“ å†³ç­–è·å–æˆåŠŸ
  éœ€è¦çŒæº‰: 42 ä¸ªç”°å—
  éœ€è¦æ’æ°´: 5 ä¸ªç”°å—
  æ— éœ€æ“ä½œ: 198 ä¸ªç”°å—

æ­£åœ¨åŠ è½½ farm_irrigation é…ç½®...
âœ“ é…ç½®åŠ è½½æˆåŠŸï¼Œæ‰¾åˆ° 245 ä¸ªç”°å—æ˜ å°„

æ­£åœ¨è½¬æ¢å†³ç­–æ ¼å¼...
âœ“ è½¬æ¢å®Œæˆ: 42 ä¸ªçŒæº‰ä»»åŠ¡

æ­£åœ¨åˆ›å»ºä¸´æ—¶é…ç½®...
âœ“ ä¸´æ—¶é…ç½®å·²åˆ›å»º: config_temp_rice.json
  å·²æ›´æ–° 42 ä¸ªç”°å—çš„é…ç½®

======================================================================
è°ƒç”¨ farm_irrigation ç”ŸæˆçŒæº‰è®¡åˆ’
======================================================================
  é…ç½®æ–‡ä»¶: config_temp_rice.json
  å¯ç”¨æ°´æ³µ: P1,P2
  è¾“å‡ºæ–‡ä»¶: plan_from_rice_20251120_153045.json
  æ—¶é—´çº¦æŸ: å¦

âœ“ çŒæº‰è®¡åˆ’ç”ŸæˆæˆåŠŸï¼

======================================================================
====== çŒæº‰å†³ç­–æ‘˜è¦ ======
æ€» ETA: 14.5 h
çŒæº‰æ‰¹æ¬¡: 3 æ‰¹
 - æ‰¹æ¬¡1 ETA=5.2h  ç”°å—æ•°=18
 - æ‰¹æ¬¡2 ETA=5.8h  ç”°å—æ•°=16
 - æ‰¹æ¬¡3 ETA=3.5h  ç”°å—æ•°=8
======================================================================

âœ“ å·²åˆ é™¤ä¸´æ—¶é…ç½®

======================================================================
âœ“ é›†æˆå®Œæˆ
======================================================================
  çŒæº‰è®¡åˆ’: E:\irrigation_schedule\farm_irrigation\plan_from_rice_20251120_153045.json
  åŸºäº rice_smart_irrigation çš„æ™ºèƒ½å†³ç­–
  farm_irrigation å®Œå…¨ä¿¡ä»»å¹¶æ‰§è¡Œå†³ç­–
======================================================================
```

## ğŸ”§ å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--farm-id` | âœ“ | - | å†œåœºID |
| `--pumps` | âœ— | P1,P2 | å¯ç”¨çš„æ°´æ³µï¼ˆé€—å·åˆ†éš”ï¼‰ |
| `--time-constraints` | âœ— | False | æ˜¯å¦å¯ç”¨æ³µæ—¶é—´çº¦æŸ |
| `--keep-temp` | âœ— | False | æ˜¯å¦ä¿ç•™ä¸´æ—¶é…ç½®ï¼ˆè°ƒè¯•ç”¨ï¼‰ |
| `--rice-api` | âœ— | http://localhost:5000/v1/rice_irrigation | rice API åœ°å€ |
| `--farm-dir` | âœ— | e:/irrigation_schedule/farm_irrigation | farm é¡¹ç›®ç›®å½• |

## âš™ï¸ æŠ€æœ¯ç»†èŠ‚

### ä¸´æ—¶é…ç½®ä¿®æ”¹ç­–ç•¥

å¯¹äºéœ€è¦çŒæº‰çš„ç”°å—ï¼š
```python
# åŸå§‹é…ç½®
{
  "wl_mm": null,      # æ— æ°´ä½æ•°æ®
  "wl_low": 30.0,     # å›ºå®šä½é˜ˆå€¼
  "wl_opt": 80.0      # å›ºå®šç›®æ ‡
}

# ä¿®æ”¹åï¼ˆä¸´æ—¶ï¼‰
{
  "wl_mm": 45.0,      # rice è·å–çš„å½“å‰æ°´ä½
  "wl_low": 46.0,     # current + 1ï¼ˆç¡®ä¿è§¦å‘ï¼‰
  "wl_opt": 90.0      # rice çš„æ™ºèƒ½ç›®æ ‡
}
```

### farm_irrigation çš„åˆ¤æ–­é€»è¾‘

```python
if field.wl_mm >= field.wl_low:  # 45 >= 46? False
    return 0  # ä¸çŒæº‰

# æ¡ä»¶ä¸æ»¡è¶³ï¼Œç»§ç»­çŒæº‰
deficit_mm = wl_opt - wl_mm  # 90 - 45 = 45mm
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ— æ³•è¿æ¥åˆ° rice åç«¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âœ— æ— æ³•è¿æ¥åˆ° rice åç«¯æœåŠ¡
```

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®ä¿ rice åç«¯æ­£åœ¨è¿è¡Œï¼š
```bash
cd E:\rice_smart_irrigation\rice_smart_irrigation\backend\src
python app.py
```

2. æ£€æŸ¥ API åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ http://localhost:5000ï¼‰

### é—®é¢˜2ï¼šæœªæ‰¾åˆ°ç”°å—æ˜ å°„

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âš  5 ä¸ªç”°å—æœªæ‰¾åˆ°æ˜ å°„ï¼Œå·²è·³è¿‡
```

**åŸå› **ï¼šrice è¿”å›çš„ `section_id` åœ¨ farm çš„ `config.json` ä¸­æ²¡æœ‰å¯¹åº”çš„ `sectionID`

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ä¸¤ä¸ªç³»ç»Ÿä½¿ç”¨çš„ç”°å—IDæ˜¯å¦ä¸€è‡´
- æ›´æ–° farm çš„ config.jsonï¼Œç¡®ä¿ `sectionID` å­—æ®µæ­£ç¡®

### é—®é¢˜3ï¼šç”Ÿæˆè®¡åˆ’å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. farm_irrigation é¡¹ç›®è·¯å¾„ä¸æ­£ç¡®
2. Python ç¯å¢ƒä¸ä¸€è‡´
3. ä¾èµ–åŒ…ç¼ºå¤±

**è§£å†³æ–¹æ³•**ï¼š
```bash
# å®‰è£…ä¾èµ–
cd E:\irrigation_schedule\farm_irrigation
pip install -r requirements.txt

# æŒ‡å®šæ­£ç¡®çš„é¡¹ç›®è·¯å¾„
python rice_to_farm_bridge.py --farm-id 13944136728576 --farm-dir /path/to/farm_irrigation
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

### ç”Ÿæˆçš„æ–‡ä»¶

1. **ä¸´æ—¶é…ç½®æ–‡ä»¶**ï¼ˆè‡ªåŠ¨åˆ é™¤ï¼‰
   - æ–‡ä»¶åï¼š`config_temp_rice.json`
   - ä½ç½®ï¼šfarm_irrigation ç›®å½•
   - ç”¨é€”ï¼šä¸´æ—¶ä¿®æ”¹æ°´ä½é˜ˆå€¼
   - åˆ é™¤ï¼šæ‰§è¡Œå®Œæˆåè‡ªåŠ¨åˆ é™¤ï¼ˆé™¤éä½¿ç”¨ `--keep-temp`ï¼‰

2. **çŒæº‰è®¡åˆ’æ–‡ä»¶**ï¼ˆä¿ç•™ï¼‰
   - æ–‡ä»¶åï¼š`plan_from_rice_YYYYMMDD_HHMMSS.json`
   - ä½ç½®ï¼šfarm_irrigation ç›®å½•
   - å†…å®¹ï¼šå®Œæ•´çš„çŒæº‰æ‰§è¡Œè®¡åˆ’ï¼ˆæ‰¹æ¬¡ã€è®¾å¤‡æ§åˆ¶æŒ‡ä»¤ç­‰ï¼‰

### ä¸ä¼šä¿®æ”¹çš„æ–‡ä»¶

- âœ… `farm_irrigation/config.json` - åŸå§‹é…ç½®ä¿æŒä¸å˜
- âœ… rice_smart_irrigation çš„æ‰€æœ‰æ–‡ä»¶
- âœ… farm_irrigation çš„æ‰€æœ‰æºä»£ç 

## ğŸ“ è¿›é˜¶ç”¨æ³•

### å¤šå†œåœºæ‰¹é‡å¤„ç†

```bash
# åˆ›å»ºæ‰¹å¤„ç†è„šæœ¬
for farm_id in 13944136728576 47035753446400 84911829811210
do
    python rice_to_farm_bridge.py --farm-id $farm_id
    echo "å†œåœº $farm_id å¤„ç†å®Œæˆ"
done
```

### å®šæ—¶ä»»åŠ¡

**Windows ä»»åŠ¡è®¡åˆ’ç¨‹åº**ï¼š
```batch
@echo off
cd E:\irrigation_schedule
python rice_to_farm_bridge.py --farm-id 13944136728576
```

**Linux Cron**ï¼š
```cron
# æ¯å¤©æ—©ä¸Š 6 ç‚¹æ‰§è¡Œ
0 6 * * * cd /path/to/irrigation_schedule && python rice_to_farm_bridge.py --farm-id 13944136728576
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. rice åç«¯æ˜¯å¦è¿è¡Œ
2. farm é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. ç”°å—IDæ˜ å°„æ˜¯å¦æ­£ç¡®
4. Python ä¾èµ–æ˜¯å¦å®Œæ•´

---

**ç‰ˆæœ¬**ï¼š1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-11-20

