2025-11-14 15:45:30,541 - INFO - pipeline模块导入成功
2025-11-14 15:45:30,541 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:45:30,541 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,542 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:45:30,542 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:45:30,542 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,542 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:45:30,542 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:45:30,543 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:45:30,543 - INFO - Pipeline实例创建成功
2025-11-14 15:45:30,543 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:45:30,543 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:45:30,543 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\gzp_farm
2025-11-14 15:45:30,543 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,543 - INFO - 检查依赖文件...
2025-11-14 15:45:30,544 - ERROR - 缺少必要文件: ['farmgis_convert.py', 'fix_farmgis_convert.py', 'auto_to_config.py']
2025-11-14 15:45:30,544 - INFO - Pipeline执行结果: success=False
2025-11-14 15:45:30,544 - ERROR - Pipeline执行失败
2025-11-14 15:46:23,207 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:46:23,207 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:49:02,394 - INFO - pipeline模块导入成功
2025-11-14 15:49:02,394 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:02,394 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,395 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:02,395 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:02,395 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,395 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:02,395 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:02,395 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:02,396 - INFO - Pipeline实例创建成功
2025-11-14 15:49:02,396 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:02,396 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:02,396 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:02,396 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,396 - INFO - 检查依赖文件...
2025-11-14 15:49:02,396 - INFO - 依赖文件检查通过
2025-11-14 15:49:02,397 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:02,397 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:02,397 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:02,398 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:02,398 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:02,398 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:02,429 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:02,429 - ERROR - 错误代码: 1
2025-11-14 15:49:02,429 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:02,429 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:02,429 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:02,429 - ERROR - Pipeline执行失败
2025-11-14 15:49:04,129 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-14 15:49:04,129 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-14 15:49:04,129 - INFO - 步骤1: 生成缓存键...
2025-11-14 15:49:04,129 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-14 15:49:04,129 - INFO - 步骤2: 检查缓存...
2025-11-14 15:49:04,129 - INFO - 缓存未命中，继续执行...
2025-11-14 15:49:04,129 - INFO - 步骤3: 导入pipeline模块...
2025-11-14 15:49:04,130 - INFO - pipeline模块导入成功
2025-11-14 15:49:04,130 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:04,130 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,130 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:04,130 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:04,130 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,130 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:04,131 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:04,131 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:04,131 - INFO - Pipeline实例创建成功
2025-11-14 15:49:04,131 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:04,131 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:04,131 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:04,131 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,131 - INFO - 检查依赖文件...
2025-11-14 15:49:04,132 - INFO - 依赖文件检查通过
2025-11-14 15:49:04,132 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:04,132 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:04,132 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:04,133 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:04,133 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:04,133 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:04,165 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:04,165 - ERROR - 错误代码: 1
2025-11-14 15:49:04,165 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:04,165 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:04,165 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:04,165 - ERROR - Pipeline执行失败
2025-11-14 15:49:32,792 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:49:32,792 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:49:49,449 - INFO - pipeline模块导入成功
2025-11-14 15:49:49,450 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:49,450 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,450 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:49,450 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:49,450 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,450 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:49,450 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:49,451 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:49,451 - INFO - Pipeline实例创建成功
2025-11-14 15:49:49,451 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:49,451 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:49,451 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:49,451 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,451 - INFO - 检查依赖文件...
2025-11-14 15:49:49,452 - INFO - 依赖文件检查通过
2025-11-14 15:49:49,452 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:49,452 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:49,452 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:49,453 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:49,453 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:49,453 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:49,484 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:49,485 - ERROR - 错误代码: 1
2025-11-14 15:49:49,485 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:49,485 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:49,485 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:49,485 - ERROR - Pipeline执行失败
2025-11-14 15:53:08,707 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:53:08,707 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:54:33,343 - INFO - pipeline模块导入成功
2025-11-14 15:54:33,343 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:54:33,343 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,343 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:54:33,343 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:54:33,343 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,343 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:54:33,344 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:54:33,344 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:54:33,344 - INFO - Pipeline实例创建成功
2025-11-14 15:54:33,344 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:54:33,344 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:54:33,344 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:54:33,344 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,344 - INFO - 检查依赖文件...
2025-11-14 15:54:33,345 - INFO - 依赖文件检查通过
2025-11-14 15:54:33,345 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:54:33,346 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:54:33,346 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:54:33,346 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:54:33,346 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:54:33,347 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:54:34,300 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 15:54:34,301 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 15:54:34,301 - INFO - 开始执行: GIS数据修复
2025-11-14 15:54:34,301 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 15:54:34,481 - INFO - 输出: 在 gzp_farm 文件夹中未找到任何 *_code.geojson 文件
请先运行 farmgis_convert.py 生成 geojson 文件
工作目录: e:\irrigation_schedule\farm_irrigation\gzp_farm

完成。请刷新前端页面验证。

2025-11-14 15:54:34,481 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 15:54:34,481 - INFO - === 步骤2: 配置生成 ===
2025-11-14 15:54:34,482 - INFO - 开始执行: 生成系统配置
2025-11-14 15:54:34,482 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 15:54:35,138 - ERROR - [FAIL] 生成系统配置 执行失败
2025-11-14 15:54:35,139 - ERROR - 错误代码: 1
2025-11-14 15:54:35,139 - ERROR - 错误输出: Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 659, in <module>
    convert(
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 281, in convert
    seg_raw = _read_any(segments_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 105, in _read_any
    raise FileNotFoundError(path)
FileNotFoundError: ����ƺˮ·_code.geojson

2025-11-14 15:54:35,139 - ERROR - 步骤2执行失败，流水线终止
2025-11-14 15:54:35,139 - INFO - Pipeline执行结果: success=False
2025-11-14 15:54:35,139 - ERROR - Pipeline执行失败
2025-11-14 15:55:52,442 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:55:52,442 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:58:59,453 - INFO - pipeline模块导入成功
2025-11-14 15:58:59,453 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:58:59,454 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,454 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:58:59,454 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:58:59,454 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,454 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:58:59,454 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:58:59,454 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:58:59,455 - INFO - Pipeline实例创建成功
2025-11-14 15:58:59,455 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:58:59,455 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:58:59,455 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:58:59,455 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,455 - INFO - 检查依赖文件...
2025-11-14 15:58:59,456 - INFO - 依赖文件检查通过
2025-11-14 15:58:59,456 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:58:59,457 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:58:59,457 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:58:59,457 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:58:59,457 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:58:59,457 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:59:00,121 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 15:59:00,121 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 15:59:00,122 - INFO - 开始执行: GIS数据修复
2025-11-14 15:59:00,122 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 15:59:00,295 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 15:59:00,295 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 15:59:00,296 - INFO - === 步骤2: 配置生成 ===
2025-11-14 15:59:00,296 - INFO - 开始执行: 生成系统配置
2025-11-14 15:59:00,296 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 15:59:01,103 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 15:59:01,103 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 15:59:01,103 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 15:59:01,104 - INFO - 开始执行: 生成灌溉计划
2025-11-14 15:59:01,104 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json --multi-pump --summary --realtime
2025-11-14 15:59:01,192 - INFO - 输出: [DEBUG] 实时水位API不可用
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 0
需要灌溉的段: []
有效水泵组合: []
生成方案数: 0
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json

2025-11-14 15:59:01,192 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 15:59:01,192 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.737505
2025-11-14 15:59:01,193 - INFO - 生成的文件:
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 15:59:01,195 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 15:59:01,195 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 15:59:01,195 - INFO - Pipeline执行结果: success=True
2025-11-14 15:59:01,196 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 15:59:01,196 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 15:59:01,196 - INFO - 开始生成多水泵方案对比
2025-11-14 15:59:01,197 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 15:59:01,197 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 15:59:01,197 - INFO - 灌溉计划生成完成
2025-11-14 16:07:02,275 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:07:02,275 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:09:09,261 - INFO - pipeline模块导入成功
2025-11-14 16:09:09,262 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:09:09,262 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,262 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:09:09,262 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:09:09,262 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,262 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:09:09,263 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:09:09,263 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:09:09,263 - INFO - Pipeline实例创建成功
2025-11-14 16:09:09,263 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:09:09,263 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:09:09,263 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:09:09,263 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,263 - INFO - 检查依赖文件...
2025-11-14 16:09:09,264 - INFO - 依赖文件检查通过
2025-11-14 16:09:09,264 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:09:09,265 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:09:09,265 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:09:09,265 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:09:09,265 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:09:09,265 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:09:09,968 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:09:09,969 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:09:09,969 - INFO - 开始执行: GIS数据修复
2025-11-14 16:09:09,969 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:09:10,152 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:09:10,152 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:09:10,153 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:09:10,153 - INFO - 开始执行: 生成系统配置
2025-11-14 16:09:10,153 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:09:10,932 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:09:10,933 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:09:10,933 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:09:10,933 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:09:10,933 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json --multi-pump --summary --realtime
2025-11-14 16:09:13,640 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json

2025-11-14 16:09:13,641 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:09:13,641 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.377191
2025-11-14 16:09:13,641 - INFO - 生成的文件:
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:09:13,644 - INFO - Pipeline执行结果: success=True
2025-11-14 16:09:13,645 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:09:13,686 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:09:13,687 - INFO - 开始生成多水泵方案对比
2025-11-14 16:09:13,687 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:09:13,687 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:09:13,688 - INFO - 灌溉计划生成完成
2025-11-14 16:09:21,954 - INFO - 手动更新水位数据 - 农场: 13944136728576
2025-11-14 16:09:21,955 - INFO - 加载了 36 个田块ID映射
2025-11-14 16:09:22,319 - INFO - 从API获取到 25 个有效水位读数
2025-11-14 16:09:22,320 - INFO - 生成水位摘要: 25/25 个田块有数据
2025-11-14 16:09:27,862 - INFO - 开始获取田块 S3-G2-F1 的水位历史，时间窗口: 24小时
2025-11-14 16:09:27,863 - INFO - 水位管理器获取成功，field_histories数量: 25
2025-11-14 16:09:27,863 - WARNING - 田块 S3-G2-F1 没有历史数据，尝试初始化...
2025-11-14 16:09:27,863 - INFO - 为田块 S3-G2-F1 创建了 24 条模拟历史数据
2025-11-14 16:09:27,863 - INFO - 田块 S3-G2-F1 水位历史获取成功: 24 条记录
2025-11-14 16:10:38,345 - INFO - 开始初始化系统组件...
2025-11-14 16:10:38,346 - INFO - 数据库初始化完成
2025-11-14 16:10:38,346 - INFO - 日志系统初始化完成
2025-11-14 16:10:38,347 - INFO - 执行状态管理器初始化完成
2025-11-14 16:10:38,347 - INFO - 加载了 36 个田块ID映射
2025-11-14 16:10:38,347 - INFO - 水位管理器初始化完成
2025-11-14 16:10:38,348 - INFO - 配置文件加载成功: config.json
2025-11-14 16:10:38,348 - INFO - 计划模板加载成功: irrigation_plan_template.json
2025-11-14 16:10:38,348 - INFO - 计划重新生成器初始化完成
2025-11-14 16:10:38,349 - INFO - 配置文件加载成功: config.json
2025-11-14 16:10:38,349 - INFO - 批次执行调度器初始化完成
2025-11-14 16:10:38,349 - INFO - 所有系统组件初始化成功
2025-11-14 16:10:53,555 - INFO - 生成水位摘要: 26/26 个田块有数据
2025-11-14 16:11:06,990 - INFO - 生成水位摘要: 26/26 个田块有数据
2025-11-14 16:11:13,347 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 16:11:13,349 - ERROR - 获取水位目标值失败: No module named 'farm_irr_full_device_modified'
2025-11-14 16:12:00,049 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:12:00,049 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:14:06,322 - INFO - pipeline模块导入成功
2025-11-14 16:14:06,323 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:14:06,323 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,323 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:14:06,323 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:14:06,323 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,323 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:14:06,323 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:14:06,324 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:14:06,324 - INFO - Pipeline实例创建成功
2025-11-14 16:14:06,324 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:14:06,324 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:14:06,324 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:14:06,324 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,324 - INFO - 检查依赖文件...
2025-11-14 16:14:06,325 - INFO - 依赖文件检查通过
2025-11-14 16:14:06,325 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:14:06,326 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:14:06,326 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:14:06,326 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:14:06,326 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:14:06,326 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:14:07,039 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:14:07,040 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:14:07,040 - INFO - 开始执行: GIS数据修复
2025-11-14 16:14:07,040 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:14:07,210 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:14:07,210 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:14:07,210 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:14:07,211 - INFO - 开始执行: 生成系统配置
2025-11-14 16:14:07,211 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:14:07,991 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:14:07,991 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:14:07,992 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:14:07,992 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:14:07,992 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json --multi-pump --summary --realtime
2025-11-14 16:14:10,403 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json

2025-11-14 16:14:10,403 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:14:10,404 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.080503
2025-11-14 16:14:10,404 - INFO - 生成的文件:
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:14:10,406 - INFO - Pipeline执行结果: success=True
2025-11-14 16:14:10,407 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:14:10,448 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:14:10,448 - INFO - 开始生成多水泵方案对比
2025-11-14 16:14:10,449 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:14:10,449 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:14:10,449 - INFO - 灌溉计划生成完成
2025-11-14 16:14:14,163 - INFO - 手动重新生成批次 1
2025-11-14 16:14:14,163 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 16:14:14,163 - WARNING - output目录中没有找到计划文件，尝试加载根目录的plan.json
2025-11-14 16:14:14,164 - ERROR - 计划文件不存在: plan.json
2025-11-14 16:15:04,031 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:15:04,031 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:16:31,388 - INFO - pipeline模块导入成功
2025-11-14 16:16:31,388 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:16:31,388 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,388 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:16:31,388 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:16:31,389 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,389 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:16:31,389 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:16:31,389 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:16:31,389 - INFO - Pipeline实例创建成功
2025-11-14 16:16:31,389 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:16:31,390 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:16:31,390 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:16:31,390 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,390 - INFO - 检查依赖文件...
2025-11-14 16:16:31,390 - INFO - 依赖文件检查通过
2025-11-14 16:16:31,390 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:16:31,391 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:16:31,391 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:16:31,392 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:16:31,392 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:16:31,392 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:16:32,111 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:16:32,111 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:16:32,111 - INFO - 开始执行: GIS数据修复
2025-11-14 16:16:32,111 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:16:32,291 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:16:32,292 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:16:32,292 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:16:32,293 - INFO - 开始执行: 生成系统配置
2025-11-14 16:16:32,293 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:16:33,102 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:16:33,102 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:16:33,103 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:16:33,103 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:16:33,103 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json --multi-pump --summary --realtime
2025-11-14 16:16:35,380 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json

2025-11-14 16:16:35,381 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:16:35,381 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.991320
2025-11-14 16:16:35,381 - INFO - 生成的文件:
2025-11-14 16:16:35,381 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:16:35,381 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:16:35,384 - INFO - Pipeline执行结果: success=True
2025-11-14 16:16:35,385 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:16:35,386 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:16:35,386 - INFO - 开始生成多水泵方案对比
2025-11-14 16:16:35,387 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:16:35,387 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:16:35,387 - INFO - 灌溉计划生成完成
2025-11-14 16:16:38,160 - INFO - 手动重新生成批次 1
2025-11-14 16:16:38,161 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 16:16:38,161 - WARNING - output目录中没有找到计划文件，尝试加载根目录的plan.json
2025-11-14 16:16:38,161 - ERROR - 计划文件不存在: plan.json
2025-11-14 16:18:11,770 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:18:11,770 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:21:23,783 - INFO - pipeline模块导入成功
2025-11-14 16:21:23,784 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:21:23,784 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,784 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:21:23,784 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:21:23,784 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,784 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:21:23,785 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:21:23,785 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:21:23,785 - INFO - Pipeline实例创建成功
2025-11-14 16:21:23,785 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:21:23,785 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:21:23,785 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:21:23,785 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,785 - INFO - 检查依赖文件...
2025-11-14 16:21:23,786 - INFO - 依赖文件检查通过
2025-11-14 16:21:23,786 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:21:23,787 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:21:23,787 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:21:23,787 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:21:23,787 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:21:23,788 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:21:24,540 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:21:24,541 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:21:24,541 - INFO - 开始执行: GIS数据修复
2025-11-14 16:21:24,541 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:21:24,714 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:21:24,715 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:21:24,715 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:21:24,716 - INFO - 开始执行: 生成系统配置
2025-11-14 16:21:24,716 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:21:25,486 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:21:25,486 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:21:25,487 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:21:25,487 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:21:25,487 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json --multi-pump --summary --realtime
2025-11-14 16:21:27,603 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json

2025-11-14 16:21:27,604 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:21:27,604 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.819358
2025-11-14 16:21:27,605 - INFO - 生成的文件:
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:21:27,607 - INFO - Pipeline执行结果: success=True
2025-11-14 16:21:27,608 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:21:27,610 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:21:27,610 - INFO - 开始生成多水泵方案对比
2025-11-14 16:21:27,610 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:21:27,610 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:21:27,610 - INFO - 灌溉计划生成完成
2025-11-14 16:21:32,167 - INFO - 开始灌溉计划优化 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_162125.json
2025-11-14 16:21:32,168 - INFO - 优化目标: ['cost_minimization', 'time_minimization', 'balanced', 'off_peak']
2025-11-14 16:21:32,172 - INFO - 计算得到低谷时段: [(0.0, 8.0), (22.0, 24.0)]
2025-11-14 16:21:32,172 - INFO - 保存缓存: f3c94434cb8fa3f660a176ee6dde84cf
2025-11-14 16:21:32,172 - INFO - 成功生成 4 个优化方案
2025-11-14 16:22:50,863 - INFO - pipeline模块导入成功
2025-11-14 16:22:50,863 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:22:50,863 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,863 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:22:50,863 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:22:50,863 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,864 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:22:50,864 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:22:50,864 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:22:50,864 - INFO - Pipeline实例创建成功
2025-11-14 16:22:50,864 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:22:50,864 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:22:50,864 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:22:50,864 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,865 - INFO - 检查依赖文件...
2025-11-14 16:22:50,865 - INFO - 依赖文件检查通过
2025-11-14 16:22:50,865 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:22:50,866 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:22:50,866 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:22:50,866 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:22:50,866 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:22:50,866 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:22:51,587 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:22:51,587 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:22:51,587 - INFO - 开始执行: GIS数据修复
2025-11-14 16:22:51,587 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:22:51,753 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:22:51,754 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:22:51,754 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:22:51,755 - INFO - 开始执行: 生成系统配置
2025-11-14 16:22:51,755 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:22:52,549 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:22:52,549 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:22:52,549 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:22:52,550 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:22:52,550 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json --multi-pump --summary --realtime
2025-11-14 16:22:54,714 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json

2025-11-14 16:22:54,714 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:22:54,714 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.849847
2025-11-14 16:22:54,715 - INFO - 生成的文件:
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:22:54,718 - INFO - Pipeline执行结果: success=True
2025-11-14 16:22:54,719 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:22:54,720 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:22:54,721 - INFO - 开始生成多水泵方案对比
2025-11-14 16:22:54,757 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:22:54,757 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:22:54,758 - INFO - 灌溉计划生成完成
2025-11-14 16:25:34,090 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:25:34,090 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:26:47,025 - INFO - pipeline模块导入成功
2025-11-14 16:26:47,026 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:26:47,026 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,026 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:26:47,026 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:26:47,026 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,026 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:26:47,026 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:26:47,027 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:26:47,027 - INFO - Pipeline实例创建成功
2025-11-14 16:26:47,027 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:26:47,027 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:26:47,027 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:26:47,027 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,027 - INFO - 检查依赖文件...
2025-11-14 16:26:47,028 - INFO - 依赖文件检查通过
2025-11-14 16:26:47,028 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:26:47,029 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:26:47,029 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:26:47,029 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:26:47,029 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:26:47,029 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:26:47,767 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:26:47,767 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:26:47,767 - INFO - 开始执行: GIS数据修复
2025-11-14 16:26:47,767 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:26:47,946 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:26:47,947 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:26:47,947 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:26:47,948 - INFO - 开始执行: 生成系统配置
2025-11-14 16:26:47,948 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:26:48,731 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:26:48,731 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:26:48,731 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:26:48,732 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:26:48,732 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json --multi-pump --summary --realtime
2025-11-14 16:26:51,031 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json

2025-11-14 16:26:51,031 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:26:51,031 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.004537
2025-11-14 16:26:51,032 - INFO - 生成的文件:
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:26:51,035 - INFO - Pipeline执行结果: success=True
2025-11-14 16:26:51,036 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 16:26:51,038 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:26:51,038 - INFO - 开始生成多水泵方案对比
2025-11-14 16:26:52,443 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 16:26:52,443 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:26:52,443 - INFO - 灌溉计划生成完成
2025-11-14 20:40:39,170 - INFO - pipeline模块导入成功
2025-11-14 20:40:39,170 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:40:39,170 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,170 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:40:39,170 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:40:39,171 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,171 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:40:39,171 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:40:39,171 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:40:39,171 - INFO - Pipeline实例创建成功
2025-11-14 20:40:39,171 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:40:39,172 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:40:39,172 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:40:39,172 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,172 - INFO - 检查依赖文件...
2025-11-14 20:40:39,172 - INFO - 依赖文件检查通过
2025-11-14 20:40:39,172 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:40:39,173 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:40:39,173 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:40:39,173 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:40:39,174 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:40:39,174 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:40:39,863 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:40:39,863 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:40:39,864 - INFO - 开始执行: GIS数据修复
2025-11-14 20:40:39,864 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:40:40,034 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:40:40,035 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:40:40,035 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:40:40,036 - INFO - 开始执行: 生成系统配置
2025-11-14 20:40:40,036 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:40:40,788 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:40:40,789 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:40:40,789 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:40:40,789 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:40:40,789 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json --multi-pump --summary --realtime
2025-11-14 20:40:43,060 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json

2025-11-14 20:40:43,061 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:40:43,061 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.890163
2025-11-14 20:40:43,062 - INFO - 生成的文件:
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:40:43,065 - INFO - Pipeline执行结果: success=True
2025-11-14 20:40:43,066 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:40:43,067 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:40:43,068 - INFO - 开始生成多水泵方案对比
2025-11-14 20:40:44,641 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:40:44,641 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:40:44,641 - INFO - 灌溉计划生成完成
2025-11-14 20:42:05,489 - INFO - 手动重新生成批次 1
2025-11-14 20:42:05,490 - INFO - 配置文件加载成功: config.json
2025-11-14 20:42:05,490 - INFO - 配置文件加载成功: config.json
2025-11-14 20:42:05,491 - INFO - 计划模板加载成功: irrigation_plan_template.json
2025-11-14 20:42:05,491 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 20:42:05,492 - INFO - 找到计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:42:05,494 - INFO - 使用scenarios格式，选择第一个scenario: 全部水泵(P1+P2)组合使用
2025-11-14 20:42:05,494 - INFO - 批次 1: 开始时间 0.00h, 持续时间 19.98h
2025-11-14 20:42:05,494 - INFO - 批次 2: 开始时间 19.98h, 持续时间 7.06h
2025-11-14 20:42:05,494 - INFO - 灌溉计划加载成功: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:42:05,494 - INFO - 共有 2 个批次
2025-11-14 20:42:05,494 - INFO - 当前计划包含 3 个scenarios，使用第一个scenario: '全部水泵(P1+P2)组合使用'
2025-11-14 20:42:05,494 - INFO - 开始重新生成批次 1 的计划
2025-11-14 20:42:05,504 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-14 20:42:05,504 - ERROR - 更新批次 1 计划失败: ExecutionStatusManager.update_execution_status() got an unexpected keyword argument 'batch_id'
2025-11-14 20:42:05,505 - INFO - 原始计划包含 3 个scenarios
2025-11-14 20:42:05,506 - INFO - 已更新scenario: 全部水泵(P1+P2)组合使用
2025-11-14 20:42:05,506 - INFO - 保留原始scenario: P2单独使用
2025-11-14 20:42:05,506 - INFO - 保留原始scenario: P1单独使用
2025-11-14 20:42:05,506 - INFO - 最终保存的计划包含 3 个scenarios
2025-11-14 20:42:05,512 - INFO - 修改后的计划已保存到: e:\irrigation_schedule\farm_irrigation\src\api\output\irrigation_plan_manual_regen_1763124125.json
2025-11-14 20:42:05,512 - INFO - 使用自定义水位标准：1 个田块
2025-11-14 20:42:10,727 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:42:10,727 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 20:49:38,968 - INFO - pipeline模块导入成功
2025-11-14 20:49:38,968 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:49:38,968 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,968 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:49:38,968 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:49:38,968 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,968 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:49:38,969 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:49:38,969 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:49:38,969 - INFO - Pipeline实例创建成功
2025-11-14 20:49:38,969 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:49:38,969 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:49:38,969 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:49:38,969 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,970 - INFO - 检查依赖文件...
2025-11-14 20:49:38,970 - INFO - 依赖文件检查通过
2025-11-14 20:49:38,970 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:49:38,971 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:49:38,971 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:49:38,971 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:49:38,971 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:49:38,972 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:49:39,688 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:49:39,689 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:49:39,689 - INFO - 开始执行: GIS数据修复
2025-11-14 20:49:39,689 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:49:39,857 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:49:39,858 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:49:39,858 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:49:39,858 - INFO - 开始执行: 生成系统配置
2025-11-14 20:49:39,859 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:49:40,610 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:49:40,610 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:49:40,610 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:49:40,611 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:49:40,611 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json --multi-pump --summary --realtime
2025-11-14 20:49:42,832 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json

2025-11-14 20:49:42,832 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:49:42,832 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.862471
2025-11-14 20:49:42,833 - INFO - 生成的文件:
2025-11-14 20:49:42,833 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:49:42,837 - INFO - Pipeline执行结果: success=True
2025-11-14 20:49:42,838 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:42,840 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:49:42,840 - INFO - 开始生成多水泵方案对比
2025-11-14 20:49:44,230 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:49:44,230 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:49:44,230 - INFO - 灌溉计划生成完成
2025-11-14 20:49:56,241 - INFO - 开始批次顺序调整 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_204940.json
2025-11-14 20:49:56,241 - INFO - 新顺序: None
2025-11-14 20:49:56,254 - INFO - 成功加载计划: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:56,256 - INFO - 成功重新排序批次: [2, 1, 3]
2025-11-14 20:49:56,256 - INFO - 已调整scenario 'P1单独使用' 的批次顺序
2025-11-14 20:49:56,257 - INFO - 成功重新排序批次: [3, 1, 2]
2025-11-14 20:49:56,257 - INFO - 已调整scenario 'P2单独使用' 的批次顺序
2025-11-14 20:49:56,257 - INFO - 成功重新排序批次: [2, 1]
2025-11-14 20:49:56,257 - INFO - 已调整scenario '全部水泵(P1+P2)组合使用' 的批次顺序
2025-11-14 20:49:56,262 - INFO - 重新排序后的计划已保存: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 20:49:56,263 - INFO - 批次顺序调整完成 - 成功调整3个scenario的批次顺序
2025-11-14 20:50:14,749 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:50:14,749 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 20:54:12,536 - INFO - pipeline模块导入成功
2025-11-14 20:54:12,536 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:54:12,536 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,536 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:54:12,536 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:54:12,536 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,537 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:54:12,537 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:54:12,537 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:54:12,537 - INFO - Pipeline实例创建成功
2025-11-14 20:54:12,537 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:54:12,537 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:54:12,537 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:54:12,537 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,537 - INFO - 检查依赖文件...
2025-11-14 20:54:12,538 - INFO - 依赖文件检查通过
2025-11-14 20:54:12,538 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:54:12,539 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:54:12,539 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:54:12,539 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:54:12,539 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:54:12,539 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:54:13,222 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:54:13,223 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:54:13,223 - INFO - 开始执行: GIS数据修复
2025-11-14 20:54:13,223 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:54:13,390 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:54:13,390 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:54:13,390 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:54:13,391 - INFO - 开始执行: 生成系统配置
2025-11-14 20:54:13,391 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:54:14,172 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:54:14,173 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:54:14,173 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:54:14,173 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:54:14,173 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json --multi-pump --summary --realtime
2025-11-14 20:54:16,468 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json

2025-11-14 20:54:16,469 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:54:16,469 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.931620
2025-11-14 20:54:16,470 - INFO - 生成的文件:
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:54:16,473 - INFO - Pipeline执行结果: success=True
2025-11-14 20:54:16,475 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:16,476 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:54:16,476 - INFO - 开始生成多水泵方案对比
2025-11-14 20:54:18,240 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:54:18,241 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:54:18,241 - INFO - 灌溉计划生成完成
2025-11-14 20:54:21,404 - INFO - 开始批次顺序调整 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_205414.json
2025-11-14 20:54:21,405 - INFO - 新顺序: None
2025-11-14 20:54:21,407 - INFO - 成功加载计划: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [2, 1, 3]
2025-11-14 20:54:21,409 - INFO - 已调整scenario 'P1单独使用' 的批次顺序
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [3, 1, 2]
2025-11-14 20:54:21,409 - INFO - 已调整scenario 'P2单独使用' 的批次顺序
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [2, 1]
2025-11-14 20:54:21,410 - INFO - 已调整scenario '全部水泵(P1+P2)组合使用' 的批次顺序
2025-11-14 20:54:21,415 - INFO - 重新排序后的计划已保存: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-14 20:54:21,415 - INFO - 批次顺序调整完成 - 成功调整3个scenario的批次顺序
2025-11-14 20:54:27,309 - INFO - 手动更新水位数据 - 农场: 13944136728576
2025-11-14 20:54:27,310 - INFO - 加载了 36 个田块ID映射
2025-11-14 20:54:27,311 - INFO - 从缓存加载了 29 个田块的水位历史
2025-11-14 20:54:27,713 - INFO - 从API获取到 23 个有效水位读数
2025-11-14 20:54:27,717 - INFO - 生成水位摘要: 29/29 个田块有数据
2025-11-14 20:54:30,939 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 20:54:30,940 - INFO - 成功获取 36 个田块的水位目标值
2025-11-14 20:55:04,801 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:55:04,801 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 22:03:57,744 - INFO - pipeline模块导入成功
2025-11-14 22:03:57,744 - INFO - 步骤4: 设置默认参数...
2025-11-14 22:03:57,744 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,744 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 22:03:57,744 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 22:03:57,745 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,745 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 22:03:57,745 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 22:03:57,745 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 22:03:57,745 - INFO - Pipeline实例创建成功
2025-11-14 22:03:57,745 - INFO - 步骤8: 运行Pipeline...
2025-11-14 22:03:57,746 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 22:03:57,746 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 22:03:57,746 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,746 - INFO - 检查依赖文件...
2025-11-14 22:03:57,746 - INFO - 依赖文件检查通过
2025-11-14 22:03:57,746 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 22:03:57,747 - INFO - 找到 6 个GIS数据文件
2025-11-14 22:03:57,747 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 22:03:57,748 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 22:03:57,748 - INFO - 开始执行: GIS数据格式转换
2025-11-14 22:03:57,748 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 22:03:58,493 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 22:03:58,494 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 22:03:58,494 - INFO - 开始执行: GIS数据修复
2025-11-14 22:03:58,494 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 22:03:58,658 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 22:03:58,659 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 22:03:58,659 - INFO - === 步骤2: 配置生成 ===
2025-11-14 22:03:58,659 - INFO - 开始执行: 生成系统配置
2025-11-14 22:03:58,660 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 22:03:59,390 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 22:03:59,391 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 22:03:59,391 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 22:03:59,391 - INFO - 开始执行: 生成灌溉计划
2025-11-14 22:03:59,391 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json --multi-pump --summary --realtime
2025-11-14 22:04:01,666 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行54.17h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行54.17h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行27.08h
推荐方案: 水泵['P1', 'P2'] (电费: 1949.97元, 运行时间: 27.08h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json

2025-11-14 22:04:01,667 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 22:04:01,667 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.922869
2025-11-14 22:04:01,668 - INFO - 生成的文件:
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 22:04:01,671 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 22:04:01,671 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 22:04:01,671 - INFO - Pipeline执行结果: success=True
2025-11-14 22:04:01,672 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-14 22:04:01,673 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 22:04:01,674 - INFO - 开始生成多水泵方案对比
2025-11-14 22:04:03,293 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 22:04:03,293 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 22:04:03,293 - INFO - 灌溉计划生成完成
2025-11-14 22:04:16,065 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 22:04:16,066 - INFO - 成功获取 36 个田块的水位目标值
2025-11-14 22:04:27,281 - INFO - 开始查询农场 13944136728576 的所有田块设备状态
2025-11-14 22:04:27,281 - INFO - 使用 app_id: YJY... (已隐藏)
2025-11-14 22:04:36,015 - INFO - ✅ 成功查询农场 13944136728576 的设备状态，共 42 个田块
2025-11-14 22:05:16,254 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 22:05:16,254 - INFO - 智能灌溉动态执行系统已关闭
2025-11-16 00:25:13,633 - INFO - pipeline模块导入成功
2025-11-16 00:25:13,634 - INFO - 步骤4: 设置默认参数...
2025-11-16 00:25:13,635 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,635 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-16 00:25:13,635 - INFO - 步骤5: 确保输出目录存在...
2025-11-16 00:25:13,636 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,636 - INFO - 步骤6: 构建pipeline参数...
2025-11-16 00:25:13,639 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-16 00:25:13,640 - INFO - 步骤7: 创建Pipeline实例...
2025-11-16 00:25:13,640 - INFO - Pipeline实例创建成功
2025-11-16 00:25:13,641 - INFO - 步骤8: 运行Pipeline...
2025-11-16 00:25:13,641 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-16 00:25:13,641 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-16 00:25:13,641 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,642 - INFO - 检查依赖文件...
2025-11-16 00:25:13,643 - INFO - 依赖文件检查通过
2025-11-16 00:25:13,643 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-16 00:25:13,644 - INFO - 找到 6 个GIS数据文件
2025-11-16 00:25:13,644 - INFO - === 步骤1: 数据预处理 ===
2025-11-16 00:25:13,645 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-16 00:25:13,645 - INFO - 开始执行: GIS数据格式转换
2025-11-16 00:25:13,645 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-16 00:25:14,717 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-16 00:25:14,717 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-16 00:25:14,717 - INFO - 开始执行: GIS数据修复
2025-11-16 00:25:14,717 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-16 00:25:14,902 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-16 00:25:14,903 - INFO - [OK] GIS数据修复 执行成功
2025-11-16 00:25:14,904 - INFO - === 步骤2: 配置生成 ===
2025-11-16 00:25:14,904 - INFO - 开始执行: 生成系统配置
2025-11-16 00:25:14,905 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-16 00:25:15,765 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-16 00:25:15,765 - INFO - [OK] 生成系统配置 执行成功
2025-11-16 00:25:15,765 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-16 00:25:15,765 - INFO - 开始执行: 生成灌溉计划
2025-11-16 00:25:15,766 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json --multi-pump --summary --realtime
2025-11-16 00:25:17,984 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=17, 无水位数据=19, 低于阈值=17
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 17
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行25.40h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行25.40h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行12.70h
推荐方案: 水泵['P1', 'P2'] (电费: 914.41元, 运行时间: 12.70h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json

2025-11-16 00:25:17,984 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-16 00:25:17,985 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.345319
2025-11-16 00:25:17,985 - INFO - 生成的文件:
2025-11-16 00:25:17,985 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-16 00:25:17,985 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-16 00:25:17,989 - INFO - Pipeline执行结果: success=True
2025-11-16 00:25:17,991 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-16 00:25:17,992 - INFO - 成功读取计划数据，包含 3 项
2025-11-16 00:25:17,992 - INFO - 开始生成多水泵方案对比
2025-11-16 00:25:19,358 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-16 00:25:19,358 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-16 00:25:19,358 - INFO - 灌溉计划生成完成
2025-11-20 12:27:59,662 - INFO - pipeline模块导入成功
2025-11-20 12:27:59,662 - INFO - 步骤4: 设置默认参数...
2025-11-20 12:27:59,663 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,663 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config_rice_20251120_122759.json
2025-11-20 12:27:59,663 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 12:27:59,663 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,663 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 12:27:59,663 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config_rice_20251120_122759.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 12:27:59,664 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 12:27:59,664 - INFO - Pipeline实例创建成功
2025-11-20 12:27:59,664 - INFO - 步骤8: 运行Pipeline...
2025-11-20 12:27:59,664 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 12:27:59,664 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 12:27:59,664 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,664 - INFO - 检查依赖文件...
2025-11-20 12:27:59,664 - INFO - 依赖文件检查通过
2025-11-20 12:27:59,665 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 12:27:59,665 - INFO - 找到 6 个GIS数据文件
2025-11-20 12:27:59,666 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 12:27:59,666 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 12:27:59,666 - INFO - 开始执行: GIS数据格式转换
2025-11-20 12:27:59,666 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 12:28:00,664 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 12:28:00,665 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 12:28:00,665 - INFO - 开始执行: GIS数据修复
2025-11-20 12:28:00,665 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 12:28:00,845 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 12:28:00,846 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 12:28:00,846 - INFO - === 步骤2: 配置生成 ===
2025-11-20 12:28:00,847 - INFO - 开始执行: 生成系统配置
2025-11-20 12:28:00,847 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 12:28:01,641 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 12:28:01,641 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 12:28:01,641 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 12:28:01,642 - INFO - 开始执行: 生成灌溉计划
2025-11-20 12:28:01,642 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json --summary --realtime
2025-11-20 12:28:02,412 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.95 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.88h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json

2025-11-20 12:28:02,413 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 12:28:02,413 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.748388
2025-11-20 12:28:02,413 - INFO - 生成的文件:
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 12:28:02,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 12:28:02,419 - INFO - Pipeline执行结果: success=True
2025-11-20 12:28:02,420 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 12:28:02,421 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 12:28:02,421 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 12:28:02,421 - INFO - 灌溉计划生成完成
2025-11-20 12:28:02,422 - INFO - ✓ 临时配置已清理
2025-11-20 12:35:51,920 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 12:35:51,921 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 12:46:33,794 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 12:46:33,795 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:14:17,933 - INFO - pipeline模块导入成功
2025-11-20 13:14:17,934 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:14:17,934 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,934 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:14:17,934 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:14:17,934 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,935 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:14:17,935 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:14:17,935 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:14:17,935 - INFO - Pipeline实例创建成功
2025-11-20 13:14:17,935 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:14:17,936 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:14:17,936 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:14:17,936 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,936 - INFO - 检查依赖文件...
2025-11-20 13:14:17,936 - INFO - 依赖文件检查通过
2025-11-20 13:14:17,936 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:14:17,937 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:14:17,937 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:14:17,938 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:14:17,938 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:14:17,938 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:14:18,640 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:14:18,640 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:14:18,640 - INFO - 开始执行: GIS数据修复
2025-11-20 13:14:18,641 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:14:18,813 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:14:18,814 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:14:18,815 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:14:18,815 - INFO - 开始执行: 生成系统配置
2025-11-20 13:14:18,815 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:14:19,580 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:14:19,580 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:14:19,580 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:14:19,580 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:14:19,581 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json --summary --realtime
2025-11-20 13:14:20,330 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json

2025-11-20 13:14:20,330 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:14:20,331 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.396489
2025-11-20 13:14:20,331 - INFO - 生成的文件:
2025-11-20 13:14:20,331 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:14:20,337 - INFO - Pipeline执行结果: success=True
2025-11-20 13:14:20,338 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:14:20,339 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:14:20,339 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:14:20,339 - INFO - 灌溉计划生成完成
2025-11-20 13:14:28,894 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:14:28,895 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:14:48,274 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:14:48,275 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:17:04,816 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:17:04,816 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:19:34,863 - INFO - pipeline模块导入成功
2025-11-20 13:19:34,864 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:19:34,864 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,864 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:19:34,864 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:19:34,864 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,864 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:19:34,865 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:19:34,865 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:19:34,865 - INFO - Pipeline实例创建成功
2025-11-20 13:19:34,865 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:19:34,865 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:19:34,865 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:19:34,866 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,866 - INFO - 检查依赖文件...
2025-11-20 13:19:34,866 - INFO - 依赖文件检查通过
2025-11-20 13:19:34,866 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:19:34,867 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:19:34,867 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:19:34,868 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:19:34,868 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:19:34,868 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:19:35,595 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:19:35,596 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:19:35,596 - INFO - 开始执行: GIS数据修复
2025-11-20 13:19:35,596 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:19:35,762 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:19:35,763 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:19:35,763 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:19:35,764 - INFO - 开始执行: 生成系统配置
2025-11-20 13:19:35,764 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:19:36,607 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:19:36,608 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:19:36,608 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:19:36,608 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:19:36,608 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json --summary --realtime
2025-11-20 13:19:37,373 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json

2025-11-20 13:19:37,373 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:19:37,373 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.508176
2025-11-20 13:19:37,374 - INFO - 生成的文件:
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:19:37,379 - INFO - Pipeline执行结果: success=True
2025-11-20 13:19:37,381 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:19:37,381 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:19:37,381 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:19:37,382 - INFO - 灌溉计划生成完成
2025-11-20 13:22:15,162 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:22:15,163 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:22:46,272 - INFO - pipeline模块导入成功
2025-11-20 13:22:46,272 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:22:46,272 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,272 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:22:46,272 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:22:46,273 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,273 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:22:46,273 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:22:46,273 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:22:46,273 - INFO - Pipeline实例创建成功
2025-11-20 13:22:46,273 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:22:46,273 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:22:46,274 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:22:46,274 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,274 - INFO - 检查依赖文件...
2025-11-20 13:22:46,274 - INFO - 依赖文件检查通过
2025-11-20 13:22:46,274 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:22:46,275 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:22:46,275 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:22:46,275 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:22:46,276 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:22:46,276 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:22:46,979 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:22:46,979 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:22:46,980 - INFO - 开始执行: GIS数据修复
2025-11-20 13:22:46,980 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:22:47,156 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:22:47,157 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:22:47,157 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:22:47,158 - INFO - 开始执行: 生成系统配置
2025-11-20 13:22:47,158 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:22:47,965 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:22:47,965 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:22:47,966 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:22:47,966 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:22:47,966 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json --summary --realtime
2025-11-20 13:22:48,734 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json

2025-11-20 13:22:48,734 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:22:48,735 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.461523
2025-11-20 13:22:48,735 - INFO - 生成的文件:
2025-11-20 13:22:48,735 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:22:48,735 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:22:48,741 - INFO - Pipeline执行结果: success=True
2025-11-20 13:22:48,744 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:22:48,744 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:22:48,745 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:22:48,745 - INFO - 灌溉计划生成完成
2025-11-20 13:26:31,739 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:26:31,739 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:27:09,095 - INFO - pipeline模块导入成功
2025-11-20 13:27:09,095 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:27:09,096 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,096 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:27:09,096 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:27:09,096 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,096 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:27:09,096 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:27:09,097 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:27:09,097 - INFO - Pipeline实例创建成功
2025-11-20 13:27:09,097 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:27:09,097 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:27:09,097 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:27:09,097 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,097 - INFO - 检查依赖文件...
2025-11-20 13:27:09,098 - INFO - 依赖文件检查通过
2025-11-20 13:27:09,098 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:27:09,099 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:27:09,099 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:27:09,100 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:27:09,100 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:27:09,100 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:27:09,792 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:27:09,792 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:27:09,793 - INFO - 开始执行: GIS数据修复
2025-11-20 13:27:09,793 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:27:09,965 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:27:09,966 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:27:09,966 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:27:09,967 - INFO - 开始执行: 生成系统配置
2025-11-20 13:27:09,967 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:27:10,757 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:27:10,757 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:27:10,757 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:27:10,758 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:27:10,758 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json --summary --realtime
2025-11-20 13:27:11,506 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json

2025-11-20 13:27:11,507 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:27:11,507 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.410217
2025-11-20 13:27:11,508 - INFO - 生成的文件:
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:27:11,514 - INFO - Pipeline执行结果: success=True
2025-11-20 13:27:11,515 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:27:11,516 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:27:11,516 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:27:11,516 - INFO - 灌溉计划生成完成
2025-11-20 13:27:11,516 - INFO - 计划生成完成，再次写入 Rice 配置...
2025-11-20 13:27:11,519 - INFO - ✓ Rice 配置已再次写入（确保不被覆盖）
2025-11-20 13:27:11,520 - INFO - ✓ 最终验证成功: config.json 包含 Rice 配置
2025-11-20 13:27:11,520 - INFO - ✓ 田块验证成功: S3-G2-F1 wl_opt=50.0
2025-11-20 13:27:56,778 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:27:56,779 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:29:54,280 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:29:54,280 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:58:07,685 - INFO - pipeline模块导入成功
2025-11-20 13:58:07,685 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:58:07,685 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,685 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:07,686 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:58:07,686 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,686 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:58:07,686 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:58:07,687 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:58:07,687 - INFO - Pipeline实例创建成功
2025-11-20 13:58:07,687 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:58:07,687 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:58:07,687 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:07,688 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,688 - INFO - 检查依赖文件...
2025-11-20 13:58:07,688 - INFO - 依赖文件检查通过
2025-11-20 13:58:07,688 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:07,689 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:58:07,689 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:07,690 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-20 13:58:07,690 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:58:07,690 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:58:07,690 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:58:07,690 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:58:08,415 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:58:08,415 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:58:08,416 - INFO - 开始执行: GIS数据修复
2025-11-20 13:58:08,416 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:58:08,595 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:58:08,596 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:58:08,596 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:58:08,596 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:58:08,596 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json --summary --realtime
2025-11-20 13:58:09,354 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 17.52 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 1 批
 - 批次1 ETA=17.52h  田块数=36
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json

2025-11-20 13:58:09,354 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:58:09,355 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.668511
2025-11-20 13:58:09,356 - INFO - 生成的文件:
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:58:09,362 - INFO - Pipeline执行结果: success=True
2025-11-20 13:58:09,364 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:09,364 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:58:09,364 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:58:09,364 - INFO - 灌溉计划生成完成
2025-11-20 13:58:09,365 - INFO - 计划生成完成，再次写入 Rice 配置...
2025-11-20 13:58:09,367 - INFO - ✓ Rice 配置已再次写入（确保不被覆盖）
2025-11-20 13:58:09,368 - INFO - ✓ 最终验证成功: config.json 包含 Rice 配置
2025-11-20 13:58:09,368 - INFO - ✓ 田块验证成功: S3-G2-F1 wl_opt=50.0
2025-11-20 13:58:31,600 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-20 13:58:31,600 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-20 13:58:31,600 - INFO - 步骤1: 生成缓存键...
2025-11-20 13:58:31,600 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-20 13:58:31,600 - INFO - 步骤2: 检查缓存...
2025-11-20 13:58:31,601 - INFO - 缓存未命中，继续执行...
2025-11-20 13:58:31,601 - INFO - 步骤3: 导入pipeline模块...
2025-11-20 13:58:31,601 - INFO - pipeline模块导入成功
2025-11-20 13:58:31,601 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:58:31,601 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,601 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:31,601 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:58:31,602 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,602 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:58:31,602 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-20 13:58:31,602 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:58:31,602 - INFO - Pipeline实例创建成功
2025-11-20 13:58:31,602 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:58:31,602 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:58:31,602 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:31,602 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,603 - INFO - 检查依赖文件...
2025-11-20 13:58:31,603 - INFO - 依赖文件检查通过
2025-11-20 13:58:31,603 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:31,604 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:58:31,604 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:31,604 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-20 13:58:31,604 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:58:31,605 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:58:31,605 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:58:31,605 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:58:32,302 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:58:32,302 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:58:32,302 - INFO - 开始执行: GIS数据修复
2025-11-20 13:58:32,303 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:58:32,476 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:58:32,477 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:58:32,477 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:58:32,477 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:58:32,478 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json --multi-pump --summary --realtime
2025-11-20 13:58:34,472 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行35.04h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行35.04h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行17.52h
推荐方案: 水泵['P1', 'P2'] (电费: 1261.51元, 运行时间: 17.52h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json

2025-11-20 13:58:34,473 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:58:34,473 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.871153
2025-11-20 13:58:34,474 - INFO - 生成的文件:
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:58:34,479 - INFO - Pipeline执行结果: success=True
2025-11-20 13:58:34,481 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-20 13:58:34,482 - INFO - 成功读取计划数据，包含 3 项
2025-11-20 13:58:34,482 - INFO - 开始生成多水泵方案对比
2025-11-20 13:58:35,809 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-20 13:58:35,809 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-20 13:58:35,809 - INFO - 灌溉计划生成完成
2025-11-20 14:03:36,342 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 14:03:36,342 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 11:45:34,777 - INFO - pipeline模块导入成功
2025-11-21 11:45:34,777 - INFO - 步骤4: 设置默认参数...
2025-11-21 11:45:34,777 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,777 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:45:34,778 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 11:45:34,778 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,778 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 11:45:34,778 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 11:45:34,778 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 11:45:34,778 - INFO - Pipeline实例创建成功
2025-11-21 11:45:34,779 - INFO - 步骤8: 运行Pipeline...
2025-11-21 11:45:34,779 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 11:45:34,779 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:45:34,779 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,779 - INFO - 检查依赖文件...
2025-11-21 11:45:34,780 - INFO - 依赖文件检查通过
2025-11-21 11:45:34,780 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:45:34,781 - INFO - 找到 6 个GIS数据文件
2025-11-21 11:45:34,781 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:45:34,781 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 11:45:34,781 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 11:45:34,781 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 11:45:34,782 - INFO - 开始执行: GIS数据格式转换
2025-11-21 11:45:34,782 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 11:45:35,787 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 11:45:35,787 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 11:45:35,788 - INFO - 开始执行: GIS数据修复
2025-11-21 11:45:35,788 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 11:45:35,978 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 11:45:35,979 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 11:45:35,979 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 11:45:35,979 - INFO - 开始执行: 生成灌溉计划
2025-11-21 11:45:35,979 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json --multi-pump --summary --realtime
2025-11-21 11:45:37,964 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=33
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 33
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行15.80h
推荐方案: 水泵['P1', 'P2'] (电费: 1137.31元, 运行时间: 15.80h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json

2025-11-21 11:45:37,965 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 11:45:37,965 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.186788
2025-11-21 11:45:37,966 - INFO - 生成的文件:
2025-11-21 11:45:37,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 11:45:37,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 11:45:37,973 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 11:45:37,973 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 11:45:37,973 - INFO - Pipeline执行结果: success=True
2025-11-21 11:45:37,975 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:45:37,976 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 11:45:37,976 - INFO - 开始生成多水泵方案对比
2025-11-21 11:45:39,129 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 11:45:39,129 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:45:39,129 - INFO - 灌溉计划生成完成
2025-11-21 11:47:05,067 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114535.json
2025-11-21 11:47:05,071 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:47:05,071 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:47:05,071 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:47:05,071 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:47:05,072 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:47:05,072 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:47:05,072 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:47:05,072 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:47:05,072 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:47:05,072 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:47:05,073 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:47:05,073 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:47:05,073 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:47:05,073 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:47:05,078 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 11:47:05,078 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 47b54063cf7830cc8eae54699e3c891a
2025-11-21 11:47:05,079 - INFO - 批次重新生成完成
2025-11-21 11:49:03,165 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114535.json
2025-11-21 11:49:03,169 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:03,169 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:03,169 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:49:03,170 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:49:03,170 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:03,170 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:49:03,170 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:49:03,171 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:49:03,171 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:49:03,171 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:49:03,171 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:49:03,176 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 11:49:03,176 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 6c901fbb760c8f7234f1017f22857b2c
2025-11-21 11:49:03,176 - INFO - 批次重新生成完成
2025-11-21 11:49:12,004 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 11:49:12,004 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 11:49:12,004 - INFO - 步骤1: 生成缓存键...
2025-11-21 11:49:12,004 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:12,005 - INFO - 步骤2: 检查缓存...
2025-11-21 11:49:12,005 - INFO - 从缓存返回灌溉计划结果 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:17,090 - INFO - 所有缓存已清除
2025-11-21 11:49:21,476 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 11:49:21,477 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 11:49:21,477 - INFO - 步骤1: 生成缓存键...
2025-11-21 11:49:21,477 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:21,477 - INFO - 步骤2: 检查缓存...
2025-11-21 11:49:21,477 - INFO - 缓存未命中，继续执行...
2025-11-21 11:49:21,477 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 11:49:21,478 - INFO - pipeline模块导入成功
2025-11-21 11:49:21,478 - INFO - 步骤4: 设置默认参数...
2025-11-21 11:49:21,478 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,478 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:49:21,478 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 11:49:21,478 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,478 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 11:49:21,478 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 11:49:21,479 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 11:49:21,479 - INFO - Pipeline实例创建成功
2025-11-21 11:49:21,479 - INFO - 步骤8: 运行Pipeline...
2025-11-21 11:49:21,479 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 11:49:21,479 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:49:21,479 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,479 - INFO - 检查依赖文件...
2025-11-21 11:49:21,480 - INFO - 依赖文件检查通过
2025-11-21 11:49:21,480 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:49:21,481 - INFO - 找到 6 个GIS数据文件
2025-11-21 11:49:21,481 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:49:21,481 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 11:49:21,481 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 11:49:21,481 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 11:49:21,481 - INFO - 开始执行: GIS数据格式转换
2025-11-21 11:49:21,481 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 11:49:22,230 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 11:49:22,230 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 11:49:22,230 - INFO - 开始执行: GIS数据修复
2025-11-21 11:49:22,231 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 11:49:22,410 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 11:49:22,410 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 11:49:22,411 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 11:49:22,411 - INFO - 开始执行: 生成灌溉计划
2025-11-21 11:49:22,411 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json --multi-pump --summary --realtime
2025-11-21 11:49:24,371 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=33
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 33
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行15.80h
推荐方案: 水泵['P1', 'P2'] (电费: 1137.31元, 运行时间: 15.80h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json

2025-11-21 11:49:24,371 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 11:49:24,372 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.892699
2025-11-21 11:49:24,373 - INFO - 生成的文件:
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 11:49:24,379 - INFO - Pipeline执行结果: success=True
2025-11-21 11:49:24,381 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 11:49:24,382 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 11:49:24,382 - INFO - 开始生成多水泵方案对比
2025-11-21 11:49:25,545 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 11:49:25,545 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:25,546 - INFO - 灌溉计划生成完成
2025-11-21 11:49:37,787 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 11:49:37,792 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:37,793 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:37,793 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:49:37,794 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:49:37,794 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:49:37,794 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:37,795 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:37,795 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:49:37,795 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:49:37,795 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:49:37,796 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:49:37,796 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:49:37,796 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:49:37,796 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:49:37,804 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696977.json
2025-11-21 11:49:37,805 - INFO - 批次重新生成结果已保存到缓存 - cache_key: feac38f3ba1ab8bfacb0bfc70e6798c4
2025-11-21 11:49:37,805 - INFO - 批次重新生成完成
2025-11-21 12:15:43,756 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:15:43,760 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:15:43,760 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:15:43,760 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 12:15:43,761 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 12:15:43,761 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:15:43,761 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 12:15:43,762 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 12:15:43,762 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:15:43,762 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:15:43,762 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:15:43,762 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:15:43,767 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698543.json
2025-11-21 12:15:43,768 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:15:43,768 - INFO - 批次重新生成完成
2025-11-21 12:15:54,077 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:15:54,077 - INFO - 从缓存返回批次重新生成结果 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:18:16,580 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 12:18:16,580 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 12:19:04,005 - INFO - pipeline模块导入成功
2025-11-21 12:19:04,005 - INFO - 步骤4: 设置默认参数...
2025-11-21 12:19:04,005 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,005 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:19:04,006 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 12:19:04,006 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,006 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 12:19:04,006 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 12:19:04,007 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 12:19:04,007 - INFO - Pipeline实例创建成功
2025-11-21 12:19:04,007 - INFO - 步骤8: 运行Pipeline...
2025-11-21 12:19:04,007 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 12:19:04,007 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:19:04,007 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,008 - INFO - 检查依赖文件...
2025-11-21 12:19:04,008 - INFO - 依赖文件检查通过
2025-11-21 12:19:04,008 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:19:04,009 - INFO - 找到 6 个GIS数据文件
2025-11-21 12:19:04,009 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:19:04,009 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 12:19:04,010 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 12:19:04,010 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 12:19:04,010 - INFO - 开始执行: GIS数据格式转换
2025-11-21 12:19:04,010 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 12:19:04,749 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 12:19:04,749 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 12:19:04,749 - INFO - 开始执行: GIS数据修复
2025-11-21 12:19:04,749 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 12:19:04,916 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 12:19:04,917 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 12:19:04,917 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 12:19:04,918 - INFO - 开始执行: 生成灌溉计划
2025-11-21 12:19:04,918 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json --multi-pump --summary --realtime
2025-11-21 12:19:06,961 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行16.90h
推荐方案: 水泵['P1', 'P2'] (电费: 1217.10元, 运行时间: 16.90h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json

2025-11-21 12:19:06,962 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 12:19:06,962 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.955210
2025-11-21 12:19:06,963 - INFO - 生成的文件:
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696977.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698543.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 12:19:06,969 - INFO - Pipeline执行结果: success=True
2025-11-21 12:19:06,971 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json
2025-11-21 12:19:06,972 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 12:19:06,973 - INFO - 开始生成多水泵方案对比
2025-11-21 12:19:08,122 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 12:19:08,122 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:19:08,122 - INFO - 灌溉计划生成完成
2025-11-21 12:19:12,890 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:19:12,894 - INFO - [时间修改] 批次 1 时长调整: 36.77h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:19:12,894 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:19:12,894 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:19:12,894 - INFO - [时间修改]   批次 2: 时长=23.57h, 水泵=['P2']
2025-11-21 12:19:12,894 - INFO - [时间修改] 计算完成 - total_duration=33.57h, total_deficit=8056.15m³, pump_runtime={'P2': 33.56727775000001}
2025-11-21 12:19:12,894 - INFO - [时间修改] 批次 1 时长调整: 36.77h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:19:12,895 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 2: 时长=23.57h, 水泵=['P1']
2025-11-21 12:19:12,895 - INFO - [时间修改] 计算完成 - total_duration=33.57h, total_deficit=8056.15m³, pump_runtime={'P1': 33.56727775000001}
2025-11-21 12:19:12,895 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:19:12,895 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:19:12,896 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:19:12,901 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698752.json
2025-11-21 12:19:12,901 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:19:12,901 - INFO - 批次重新生成完成
2025-11-21 12:20:55,628 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 12:20:55,629 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 12:20:55,629 - INFO - 步骤1: 生成缓存键...
2025-11-21 12:20:55,629 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:20:55,629 - INFO - 步骤2: 检查缓存...
2025-11-21 12:20:55,629 - INFO - 从缓存返回灌溉计划结果 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:03,253 - INFO - 所有缓存已清除
2025-11-21 12:21:08,146 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 12:21:08,146 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 12:21:08,146 - INFO - 步骤1: 生成缓存键...
2025-11-21 12:21:08,147 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:08,147 - INFO - 步骤2: 检查缓存...
2025-11-21 12:21:08,147 - INFO - 缓存未命中，继续执行...
2025-11-21 12:21:08,147 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 12:21:08,147 - INFO - pipeline模块导入成功
2025-11-21 12:21:08,147 - INFO - 步骤4: 设置默认参数...
2025-11-21 12:21:08,147 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,147 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:21:08,148 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 12:21:08,148 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,148 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 12:21:08,148 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 12:21:08,148 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 12:21:08,149 - INFO - Pipeline实例创建成功
2025-11-21 12:21:08,149 - INFO - 步骤8: 运行Pipeline...
2025-11-21 12:21:08,149 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 12:21:08,149 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:21:08,149 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,149 - INFO - 检查依赖文件...
2025-11-21 12:21:08,150 - INFO - 依赖文件检查通过
2025-11-21 12:21:08,150 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:21:08,151 - INFO - 找到 6 个GIS数据文件
2025-11-21 12:21:08,151 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:21:08,151 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 12:21:08,151 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 12:21:08,152 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 12:21:08,152 - INFO - 开始执行: GIS数据格式转换
2025-11-21 12:21:08,152 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 12:21:08,902 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 12:21:08,903 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 12:21:08,903 - INFO - 开始执行: GIS数据修复
2025-11-21 12:21:08,903 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 12:21:09,090 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 12:21:09,091 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 12:21:09,091 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 12:21:09,091 - INFO - 开始执行: 生成灌溉计划
2025-11-21 12:21:09,091 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json --multi-pump --summary --realtime
2025-11-21 12:21:11,010 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行16.90h
推荐方案: 水泵['P1', 'P2'] (电费: 1217.10元, 运行时间: 16.90h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json

2025-11-21 12:21:11,010 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 12:21:11,011 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.862057
2025-11-21 12:21:11,011 - INFO - 生成的文件:
2025-11-21 12:21:11,011 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 12:21:11,017 - INFO - Pipeline执行结果: success=True
2025-11-21 12:21:11,019 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 12:21:11,020 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 12:21:11,020 - INFO - 开始生成多水泵方案对比
2025-11-21 12:21:12,203 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 12:21:12,203 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:12,203 - INFO - 灌溉计划生成完成
2025-11-21 12:22:41,734 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_122109.json
2025-11-21 12:22:41,738 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:22:41,738 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:22:41,738 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:22:41,738 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 12:22:41,738 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 12:22:41,739 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:22:41,739 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:22:41,739 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:22:41,739 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 12:22:41,739 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 12:22:41,739 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:22:41,740 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:22:41,740 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:22:41,740 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:22:41,745 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 12:22:41,746 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 82435f3a933d3ec915402573ccd557d8
2025-11-21 12:22:41,746 - INFO - 批次重新生成完成
2025-11-21 13:09:38,955 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_122109.json
2025-11-21 13:09:38,959 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:09:38,959 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:09:38,959 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:09:38,959 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:09:38,959 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:09:38,960 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:09:38,960 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:09:38,960 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:09:38,960 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:09:38,960 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:09:38,961 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:09:38,961 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:09:38,961 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:09:38,961 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:09:38,966 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 13:09:38,967 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 82435f3a933d3ec915402573ccd557d8
2025-11-21 13:09:38,967 - INFO - 批次重新生成完成
2025-11-21 13:14:23,408 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 13:14:23,408 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 13:14:23,408 - INFO - 步骤1: 生成缓存键...
2025-11-21 13:14:23,409 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 13:14:23,409 - INFO - 步骤2: 检查缓存...
2025-11-21 13:14:23,409 - INFO - 缓存未命中，继续执行...
2025-11-21 13:14:23,409 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 13:14:23,409 - INFO - pipeline模块导入成功
2025-11-21 13:14:23,410 - INFO - 步骤4: 设置默认参数...
2025-11-21 13:14:23,410 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,410 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 13:14:23,410 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 13:14:23,410 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,410 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 13:14:23,410 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 13:14:23,411 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 13:14:23,411 - INFO - Pipeline实例创建成功
2025-11-21 13:14:23,411 - INFO - 步骤8: 运行Pipeline...
2025-11-21 13:14:23,411 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 13:14:23,411 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 13:14:23,411 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,412 - INFO - 检查依赖文件...
2025-11-21 13:14:23,412 - INFO - 依赖文件检查通过
2025-11-21 13:14:23,412 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 13:14:23,413 - INFO - 找到 6 个GIS数据文件
2025-11-21 13:14:23,413 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 13:14:23,413 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 13:14:23,413 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 13:14:23,413 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 13:14:23,413 - INFO - 开始执行: GIS数据格式转换
2025-11-21 13:14:23,414 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 13:14:24,130 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 13:14:24,131 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 13:14:24,131 - INFO - 开始执行: GIS数据修复
2025-11-21 13:14:24,131 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 13:14:24,312 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 13:14:24,313 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 13:14:24,313 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 13:14:24,313 - INFO - 开始执行: 生成灌溉计划
2025-11-21 13:14:24,313 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json --multi-pump --summary --realtime
2025-11-21 13:14:26,358 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行33.78h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行33.78h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行16.89h
推荐方案: 水泵['P1', 'P2'] (电费: 1216.14元, 运行时间: 16.89h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json

2025-11-21 13:14:26,358 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 13:14:26,358 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.947396
2025-11-21 13:14:26,359 - INFO - 生成的文件:
2025-11-21 13:14:26,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 13:14:26,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 13:14:26,366 - INFO - Pipeline执行结果: success=True
2025-11-21 13:14:26,368 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 13:14:26,369 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 13:14:26,369 - INFO - 开始生成多水泵方案对比
2025-11-21 13:14:27,534 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 13:14:27,534 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 13:14:27,534 - INFO - 灌溉计划生成完成
2025-11-21 13:14:40,187 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_131424.json
2025-11-21 13:14:40,190 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:40,190 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:40,190 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:14:40,191 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:14:40,191 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:40,191 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:14:40,192 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:14:40,192 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:14:40,192 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:14:40,192 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:14:40,192 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:14:40,198 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 13:14:40,198 - INFO - 批次重新生成结果已保存到缓存 - cache_key: fa9746c2b879c72934314d246ac04db4
2025-11-21 13:14:40,198 - INFO - 批次重新生成完成
2025-11-21 13:14:52,149 - INFO - 所有缓存已清除
2025-11-21 13:14:55,335 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_131424.json
2025-11-21 13:14:55,339 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:55,339 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:55,339 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:14:55,340 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:14:55,340 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:55,340 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:14:55,341 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:14:55,341 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:14:55,341 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:14:55,341 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:14:55,341 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:14:55,347 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 13:14:55,347 - INFO - 批次重新生成结果已保存到缓存 - cache_key: fa9746c2b879c72934314d246ac04db4
2025-11-21 13:14:55,347 - INFO - 批次重新生成完成
2025-11-21 14:48:32,838 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 14:48:32,839 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 16:02:12,959 - INFO - pipeline模块导入成功
2025-11-21 16:02:12,959 - INFO - 步骤4: 设置默认参数...
2025-11-21 16:02:12,959 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,959 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:02:12,959 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 16:02:12,960 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,960 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 16:02:12,960 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 16:02:12,960 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 16:02:12,960 - INFO - Pipeline实例创建成功
2025-11-21 16:02:12,960 - INFO - 步骤8: 运行Pipeline...
2025-11-21 16:02:12,960 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 16:02:12,961 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:02:12,961 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,961 - INFO - 检查依赖文件...
2025-11-21 16:02:12,961 - INFO - 依赖文件检查通过
2025-11-21 16:02:12,961 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:02:12,962 - INFO - 找到 15 个GIS数据文件
2025-11-21 16:02:12,962 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:02:12,962 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 16:02:12,962 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 16:02:12,962 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 16:02:12,963 - INFO - 开始执行: GIS数据格式转换
2025-11-21 16:02:12,963 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 16:02:13,744 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 16:02:13,745 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 16:02:13,745 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 16:02:13,745 - INFO - 开始执行: GIS数据修复
2025-11-21 16:02:13,745 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 16:02:13,945 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 16:02:13,946 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 16:02:13,946 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 16:02:13,946 - INFO - 开始执行: 生成灌溉计划
2025-11-21 16:02:13,947 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json --summary --realtime
2025-11-21 16:02:14,804 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 30.29 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=16.84h  田块数=11
 - 批次2 ETA=13.45h  田块数=3
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json

2025-11-21 16:02:14,805 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 16:02:14,805 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.845081
2025-11-21 16:02:14,806 - INFO - 生成的文件:
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 16:02:14,813 - INFO - Pipeline执行结果: success=True
2025-11-21 16:02:14,815 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:02:14,816 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 16:02:14,816 - INFO - 灌溉计划结果已保存到缓存 - cache_key: c0cc3c6198d2babde967fc760ec8457a
2025-11-21 16:02:14,816 - INFO - 灌溉计划生成完成
2025-11-21 16:02:14,817 - INFO - 灌溉计划生成完成: 灌溉计划生成成功
2025-11-21 16:03:34,024 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 16:03:34,024 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 16:18:29,209 - INFO - pipeline模块导入成功
2025-11-21 16:18:29,209 - INFO - 步骤4: 设置默认参数...
2025-11-21 16:18:29,209 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,209 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:18:29,209 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 16:18:29,210 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,210 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 16:18:29,210 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 16:18:29,210 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 16:18:29,210 - INFO - Pipeline实例创建成功
2025-11-21 16:18:29,210 - INFO - 步骤8: 运行Pipeline...
2025-11-21 16:18:29,210 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 16:18:29,211 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:18:29,211 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,211 - INFO - 检查依赖文件...
2025-11-21 16:18:29,211 - INFO - 依赖文件检查通过
2025-11-21 16:18:29,211 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:18:29,212 - INFO - 找到 15 个GIS数据文件
2025-11-21 16:18:29,212 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:18:29,212 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 16:18:29,212 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 16:18:29,212 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 16:18:29,212 - INFO - 开始执行: GIS数据格式转换
2025-11-21 16:18:29,213 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 16:18:30,040 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 16:18:30,041 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 16:18:30,041 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 16:18:30,041 - INFO - 开始执行: GIS数据修复
2025-11-21 16:18:30,042 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 16:18:30,230 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 16:18:30,231 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 16:18:30,231 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 16:18:30,231 - INFO - 开始执行: 生成灌溉计划
2025-11-21 16:18:30,232 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json --summary --realtime
2025-11-21 16:18:31,020 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 30.29 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=16.84h  田块数=11
 - 批次2 ETA=13.45h  田块数=3
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json

2025-11-21 16:18:31,021 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 16:18:31,021 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.811414
2025-11-21 16:18:31,022 - INFO - 生成的文件:
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 16:18:31,029 - INFO - Pipeline执行结果: success=True
2025-11-21 16:18:31,032 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 16:18:31,033 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 16:18:31,033 - INFO - 灌溉计划结果已保存到缓存 - cache_key: c0cc3c6198d2babde967fc760ec8457a
2025-11-21 16:18:31,033 - INFO - 灌溉计划生成完成
2025-11-21 16:18:31,034 - INFO - 灌溉计划生成完成: 灌溉计划生成成功
2025-11-21 16:22:52,310 - INFO - 手动更新水位数据 - 农场: 84911829811210
2025-11-21 16:22:52,311 - INFO - 加载了 25 个田块ID映射
2025-11-21 16:22:52,312 - INFO - 从缓存加载了 29 个田块的水位历史
2025-11-21 16:22:52,662 - INFO - 从API获取到 14 个有效水位读数
2025-11-21 16:22:52,666 - INFO - 生成水位摘要: 43/43 个田块有数据
2025-11-21 20:20:44,053 - INFO - pipeline模块导入成功
2025-11-21 20:20:44,053 - INFO - 步骤4: 设置默认参数...
2025-11-21 20:20:44,053 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:20:44,053 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 20:20:44,053 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 20:20:44,053 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:20:44,054 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 20:20:44,054 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 20:20:44,054 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 20:20:44,054 - INFO - Pipeline实例创建成功
2025-11-21 20:20:44,054 - INFO - 步骤8: 运行Pipeline...
2025-11-21 20:20:44,054 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 20:20:44,054 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 20:20:44,055 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:20:44,055 - INFO - 检查依赖文件...
2025-11-21 20:20:44,055 - INFO - 依赖文件检查通过
2025-11-21 20:20:44,055 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 20:20:44,056 - INFO - 找到 15 个GIS数据文件
2025-11-21 20:20:44,056 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 20:20:44,057 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 20:20:44,057 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 20:20:44,057 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 20:20:44,057 - INFO - 开始执行: GIS数据格式转换
2025-11-21 20:20:44,057 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 20:20:44,759 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 20:20:44,759 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 20:20:44,760 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 20:20:44,760 - INFO - 开始执行: GIS数据修复
2025-11-21 20:20:44,760 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 20:20:44,953 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 20:20:44,955 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 20:20:44,955 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 20:20:44,956 - INFO - 开始执行: 生成灌溉计划
2025-11-21 20:20:44,956 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json --summary --realtime
2025-11-21 20:20:45,756 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 33.95 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=17.17h  田块数=9
 - 批次2 ETA=16.78h  田块数=5
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json

2025-11-21 20:20:45,756 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 20:20:45,757 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.703520
2025-11-21 20:20:45,757 - INFO - 生成的文件:
2025-11-21 20:20:45,757 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 20:20:45,757 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 20:20:45,757 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-21 20:20:45,758 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 20:20:45,758 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 20:20:45,758 - INFO - Pipeline执行结果: success=True
2025-11-21 20:20:45,758 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-21 20:20:45,759 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 20:20:45,759 - INFO - 灌溉计划结果已保存到缓存 - cache_key: c0cc3c6198d2babde967fc760ec8457a
2025-11-21 20:20:45,759 - INFO - 灌溉计划生成完成
2025-11-21 20:20:45,759 - INFO - 灌溉计划生成完成: 灌溉计划生成成功
2025-11-21 20:52:11,140 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 20:52:11,141 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 20:55:24,757 - INFO - pipeline模块导入成功
2025-11-21 20:55:24,757 - INFO - 步骤4: 设置默认参数...
2025-11-21 20:55:24,757 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:55:24,757 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 20:55:24,757 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 20:55:24,757 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:55:24,758 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 20:55:24,758 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 20:55:24,758 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 20:55:24,758 - INFO - Pipeline实例创建成功
2025-11-21 20:55:24,758 - INFO - 步骤8: 运行Pipeline...
2025-11-21 20:55:24,758 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 20:55:24,758 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 20:55:24,759 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 20:55:24,759 - INFO - 检查依赖文件...
2025-11-21 20:55:24,759 - INFO - 依赖文件检查通过
2025-11-21 20:55:24,759 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 20:55:24,760 - INFO - 找到 15 个GIS数据文件
2025-11-21 20:55:24,760 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 20:55:24,760 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 20:55:24,760 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 20:55:24,761 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 20:55:24,761 - INFO - 开始执行: GIS数据格式转换
2025-11-21 20:55:24,761 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 20:55:25,451 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 20:55:25,451 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 20:55:25,452 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 20:55:25,452 - INFO - 开始执行: GIS数据修复
2025-11-21 20:55:25,452 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 20:55:25,649 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 20:55:25,650 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 20:55:25,651 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 20:55:25,651 - INFO - 开始执行: 生成灌溉计划
2025-11-21 20:55:25,651 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json --summary --realtime
2025-11-21 20:55:26,630 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 33.95 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=17.17h  田块数=9
 - 批次2 ETA=16.78h  田块数=5
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json

2025-11-21 20:55:26,631 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 20:55:26,631 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.873632
2025-11-21 20:55:26,632 - INFO - 生成的文件:
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 20:55:26,632 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 20:55:26,633 - INFO - Pipeline执行结果: success=True
2025-11-21 20:55:26,633 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-21 20:55:26,633 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 20:55:26,634 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-21 20:55:26,634 - INFO - 灌溉计划生成完成
2025-11-21 20:55:28,676 - INFO - ========== 开始获取计划中的设备列表 ==========
2025-11-21 20:55:28,676 - INFO - 农场ID: 13944136728576, 计划ID: 最新
2025-11-21 20:55:28,676 - INFO - 步骤1: 获取灌溉计划...
2025-11-21 20:55:28,677 - INFO - 使用计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-21 20:55:28,677 - INFO - 步骤2: 提取需要灌溉的田块...
2025-11-21 21:02:20,307 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 21:02:20,307 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 21:04:07,433 - INFO - pipeline模块导入成功
2025-11-21 21:04:07,433 - INFO - 步骤4: 设置默认参数...
2025-11-21 21:04:07,433 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 21:04:07,433 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 21:04:07,433 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 21:04:07,433 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 21:04:07,434 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 21:04:07,434 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 21:04:07,434 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 21:04:07,435 - INFO - Pipeline实例创建成功
2025-11-21 21:04:07,435 - INFO - 步骤8: 运行Pipeline...
2025-11-21 21:04:07,435 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 21:04:07,435 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 21:04:07,435 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 21:04:07,435 - INFO - 检查依赖文件...
2025-11-21 21:04:07,436 - INFO - 依赖文件检查通过
2025-11-21 21:04:07,436 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 21:04:07,437 - INFO - 找到 15 个GIS数据文件
2025-11-21 21:04:07,437 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 21:04:07,437 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 21:04:07,437 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 21:04:07,437 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 21:04:07,438 - INFO - 开始执行: GIS数据格式转换
2025-11-21 21:04:07,438 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 21:04:08,169 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 21:04:08,169 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 21:04:08,170 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 21:04:08,170 - INFO - 开始执行: GIS数据修复
2025-11-21 21:04:08,170 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 21:04:08,391 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 21:04:08,392 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 21:04:08,393 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 21:04:08,393 - INFO - 开始执行: 生成灌溉计划
2025-11-21 21:04:08,393 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json --multi-pump --summary --realtime
2025-11-21 21:04:09,798 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=14, 无水位数据=11, 低于阈值=11
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 11
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1216.55元 - 运行33.79h
推荐方案: 水泵['P1'] (电费: 1216.55元, 运行时间: 33.79h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json

2025-11-21 21:04:09,799 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 21:04:09,799 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.363140
2025-11-21 21:04:09,800 - INFO - 生成的文件:
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 21:04:09,800 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 21:04:09,801 - INFO - Pipeline执行结果: success=True
2025-11-21 21:04:09,801 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-21 21:04:09,802 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 21:04:09,802 - INFO - 开始生成多水泵方案对比
2025-11-21 21:04:10,379 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-21 21:04:10,379 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-21 21:04:10,379 - INFO - 灌溉计划生成完成
2025-11-21 21:04:22,346 - INFO - ========== 开始获取计划中的设备列表 ==========
2025-11-21 21:04:22,346 - INFO - 农场ID: 84911829811210, 计划ID: 最新
2025-11-21 21:04:22,346 - INFO - 步骤1: 获取灌溉计划...
2025-11-21 21:04:22,347 - INFO - 使用计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-21 21:04:22,347 - INFO - 步骤2: 提取需要灌溉的田块...
2025-11-21 21:04:22,348 - INFO - 找到需要灌溉的田块: 14 个
2025-11-21 21:04:22,348 - INFO - 步骤3: 查询田块对应的设备...
2025-11-21 21:04:58,412 - INFO - 步骤4: 筛选设备...
2025-11-21 21:04:58,412 - INFO - ✅ 成功获取 14 个田块对应的 11 个设备
2025-11-21 21:04:58,412 - INFO - ========== 获取设备列表完成 ==========
2025-11-21 22:12:06,283 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 22:12:06,283 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 10:02:26,181 - INFO - pipeline模块导入成功
2025-11-22 10:02:26,182 - INFO - 步骤4: 设置默认参数...
2025-11-22 10:02:26,182 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:02:26,182 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:02:26,182 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 10:02:26,182 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:02:26,182 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 10:02:26,183 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 10:02:26,183 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 10:02:26,183 - INFO - Pipeline实例创建成功
2025-11-22 10:02:26,183 - INFO - 步骤8: 运行Pipeline...
2025-11-22 10:02:26,183 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 10:02:26,183 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 10:02:26,183 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:02:26,183 - INFO - 检查依赖文件...
2025-11-22 10:02:26,184 - INFO - 依赖文件检查通过
2025-11-22 10:02:26,184 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 10:02:26,185 - INFO - 找到 15 个GIS数据文件
2025-11-22 10:02:26,186 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:02:26,186 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 10:02:26,186 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 10:02:26,186 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 10:02:26,186 - INFO - 开始执行: GIS数据格式转换
2025-11-22 10:02:26,187 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 10:02:27,190 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 10:02:27,191 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 10:02:27,191 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 10:02:27,192 - INFO - 开始执行: GIS数据修复
2025-11-22 10:02:27,192 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 10:02:27,385 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 10:02:27,387 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 10:02:27,387 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 10:02:27,388 - INFO - 开始执行: 生成灌溉计划
2025-11-22 10:02:27,388 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json --multi-pump --summary --realtime
2025-11-22 10:02:28,836 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1102.07元 - 运行30.61h
推荐方案: 水泵['P1'] (电费: 1102.07元, 运行时间: 30.61h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json

2025-11-22 10:02:28,836 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 10:02:28,837 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.653814
2025-11-22 10:02:28,837 - INFO - 生成的文件:
2025-11-22 10:02:28,837 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 10:02:28,837 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 10:02:28,838 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 10:02:28,838 - INFO - Pipeline执行结果: success=True
2025-11-22 10:02:28,839 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 10:02:28,839 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 10:02:28,839 - INFO - 开始生成多水泵方案对比
2025-11-22 10:02:29,398 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 10:02:29,398 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 10:02:29,398 - INFO - 灌溉计划生成完成
2025-11-22 10:03:41,977 - INFO - ========== 开始获取计划中的设备列表 ==========
2025-11-22 10:03:41,977 - INFO - 农场ID: 84911829811210, 计划ID: 最新
2025-11-22 10:03:41,978 - INFO - 步骤1: 获取灌溉计划...
2025-11-22 10:03:41,978 - INFO - 使用计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 10:03:41,979 - INFO - 步骤2: 提取需要灌溉的田块...
2025-11-22 10:03:41,979 - INFO - 找到需要灌溉的田块: 13 个
2025-11-22 10:03:41,979 - INFO - 步骤3: 查询田块对应的设备...
2025-11-22 10:04:18,554 - INFO - 步骤4: 筛选设备...
2025-11-22 10:04:18,554 - INFO - ✅ 成功获取 13 个田块对应的 10 个设备
2025-11-22 10:04:18,554 - INFO - ========== 获取设备列表完成 ==========
2025-11-22 10:06:00,265 - INFO - ========== 开始设备自检工作流 ==========
2025-11-22 10:06:00,265 - INFO - 农场ID: 84911829811210, 等待时间: 5分钟
2025-11-22 10:06:00,265 - INFO - 步骤1: 获取当前灌溉计划...
2025-11-22 10:06:00,266 - INFO - 使用计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 10:06:00,266 - INFO - 找到需要灌溉的田块: 13 个
2025-11-22 10:06:00,266 - INFO - 步骤2: 获取田块对应的设备unique_no...
2025-11-22 10:06:37,774 - INFO - 需要自检的设备总数: 10
2025-11-22 10:06:37,774 - INFO - 步骤3: 触发设备自检...
2025-11-22 10:06:37,774 - INFO - 触发设备自检，设备数量: 10
2025-11-22 10:06:37,774 - INFO - 📋 请求URL: http://101.201.78.54:8100/device_self_check
2025-11-22 10:06:37,774 - INFO - 📋 前5个设备示例: ['480887123677298688', '477379421064159242', '477379421064159255', '202511140931130001', '477379421064159243']
2025-11-22 10:06:40,712 - INFO - ✅ 设备自检触发成功: 5/10 Task(s) accepted, starting self checking
2025-11-22 10:06:40,713 - INFO - 📋 硬件API返回的完整数据: {'code': 200, 'message': '5/10 Task(s) accepted, starting self checking', 'trigger_result': {'accepted_no_list': ['477379421064159242', '477379421064159255', '477379421064159243', '477379421064159232', '477379421064159246'], 'unaccepted_no_list': {'202511140930590001': "操作失败：'data'", '202511140931130001': "操作失败：'data'", '480887123677298688': 'Trigger failed！Get device open rate failed!', '480892188113780736': 'Trigger failed！Get device open rate failed!', '480911695752478720': 'Trigger failed！Get device open rate failed!'}}}
2025-11-22 10:06:40,713 - INFO - 📋 接受的设备列表: [], 数量: 0
2025-11-22 10:06:40,713 - INFO - ✅ 自检任务已接受，设备数: 0
2025-11-22 10:06:40,713 - INFO - 步骤4: 等待 5 分钟，让设备完成自检...
2025-11-22 10:11:40,715 - INFO - 步骤5: 查询设备自检状态...
2025-11-22 10:11:40,715 - INFO - 🔄 启用轮询模式，最多尝试 5 次，间隔 30 秒
2025-11-22 10:11:40,715 - INFO - 📊 第 1/5 次查询...
2025-11-22 10:11:40,715 - INFO - 查询设备状态，设备数量: 10
2025-11-22 10:11:40,716 - INFO - 📋 请求URL: http://101.201.78.54:8100/devices_status
2025-11-22 10:11:40,716 - INFO - 📋 前5个设备示例: ['480887123677298688', '477379421064159242', '477379421064159255', '202511140931130001', '477379421064159243']
2025-11-22 10:11:40,818 - INFO - ✅ 设备状态查询成功，共 5 个设备
2025-11-22 10:11:40,819 - INFO - 📋 硬件API返回的完整数据: {'code': 200, 'data': [{'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159255', 'status': 'check_success'}, {'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159242', 'status': 'check_success'}, {'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159243', 'status': 'check_success'}, {'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159232', 'status': 'check_success'}, {'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159246', 'status': 'check_success'}], 'message': 'ok'}
2025-11-22 10:11:40,819 - INFO - 📋 设备状态示例: {'least_check_time': None, 'message': '完成/归零,打开,关闭,恢复到初始开度,完成', 'no': '477379421064159255', 'status': 'check_success'}
2025-11-22 10:11:40,819 - INFO - 状态统计: 成功=5, 自检中=0, 失败=0
2025-11-22 10:11:40,820 - INFO - ✅ 所有设备已完成自检（成功+失败）
2025-11-22 10:11:40,820 - INFO - 步骤6: 过滤自检成功的设备...
2025-11-22 10:11:40,820 - INFO - 设备状态统计: 成功=5, 自检中=0, 失败=0, 总数=5
2025-11-22 10:11:40,820 - INFO - 自检成功: 5 个设备, 失败: 0 个设备
2025-11-22 10:11:40,820 - INFO - 需要移除的田块（设备自检失败）: 0 个
2025-11-22 10:11:40,820 - INFO - 步骤8: 整理结果...
2025-11-22 10:11:40,820 - INFO - ========== 设备自检工作流完成 ==========
2025-11-22 10:11:40,820 - INFO - 总设备: 10, 成功: 5, 失败: 0
2025-11-22 10:11:40,821 - INFO - 总田块: 13, 保留: 13, 移除: 0
2025-11-22 10:13:34,779 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:13:34,780 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:13:34,781 - INFO - 配置文件加载成功: config.json
2025-11-22 10:13:34,781 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 10:13:34,781 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.37h
2025-11-22 10:13:34,781 - INFO - 批次 2: 开始时间 17.37h, 持续时间 13.25h
2025-11-22 10:13:34,781 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:13:34,782 - INFO - 共有 2 个批次
2025-11-22 10:13:34,796 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 10:13:34,799 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_101334
2025-11-22 10:13:34,801 - INFO - [scheduler] 执行开始时间: 2025-11-22 10:13:34.782905
2025-11-22 10:13:34,806 - INFO - 开始准备批次 1
2025-11-22 10:13:34,806 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:13:35,163 - INFO - 批次 1 计划重新生成完成
2025-11-22 10:13:35,163 - INFO - 开始执行批次 1
2025-11-22 10:13:35,164 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 10:13:35,164 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 10:13:35,164 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 10:13:35,164 - INFO - 添加指令: cmd_0002 - 启动P1泵站
2025-11-22 10:13:35,165 - INFO - 添加指令: cmd_0003 - 开启S1-G27节制闸(100%)
2025-11-22 10:13:35,165 - INFO - 添加指令: cmd_0004 - 开启S2-G10节制闸(100%)
2025-11-22 10:13:35,165 - INFO - 添加指令: cmd_0005 - 开启S2-G12节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0006 - 开启S2-G13节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0007 - 开启S2-G14节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0008 - 开启S3-G18节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0009 - 开启S3-G19节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0010 - 开启S3-G20节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0011 - 开启S3-G21节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0012 - 开启S1-G27节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0013 - 开启S3-G23节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0014 - 开启S3-G25节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 添加指令: cmd_0015 - 开启S5-G29节制闸(100%)
2025-11-22 10:13:35,166 - INFO - 批次 1 已生成 15 条启动指令
2025-11-22 10:13:35,173 - INFO - 初始化批次监控: 0 个田块, 13 个节制闸, 1 个泵站
2025-11-22 10:13:35,173 - ERROR - 执行批次 1 失败: 'FieldCompletionMonitor' object has no attribute 'regulators'
2025-11-22 10:14:17,014 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:18:52,222 - INFO - 指令状态更新: cmd_0001 sent → executed
2025-11-22 10:18:52,223 - INFO -   反馈: P1泵站已成功启动
2025-11-22 10:18:52,223 - INFO - 收到指令反馈: cmd_0001 - executed
2025-11-22 10:30:29,542 - INFO - 手动重新生成批次 1
2025-11-22 10:30:29,543 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:30:29,543 - INFO - 计划模板加载成功: E:\irrigation_schedule\farm_irrigation\irrigation_plan_template.json
2025-11-22 10:30:29,543 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 10:30:29,544 - INFO - 开始重新生成批次 1 的计划
2025-11-22 10:30:29,546 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 10:30:29,546 - ERROR - 批次 1 状态为 failed，无法更新
2025-11-22 10:30:29,547 - INFO - 原始计划包含 1 个scenarios
2025-11-22 10:30:29,547 - INFO - 已更新scenario: P1单独使用
2025-11-22 10:30:29,547 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 10:30:29,549 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 10:30:29,549 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 10:30:29,549 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 10:30:29,550 - INFO - ============================================================
2025-11-22 10:30:29,550 - INFO - 开始检查水位和设备状态
2025-11-22 10:30:29,550 - INFO - ============================================================
2025-11-22 10:30:29,550 - INFO - ============================================================
2025-11-22 10:30:29,550 - INFO - 检查完成: 田块完成 0, 节制闸关闭 0, 泵站停止 0
2025-11-22 10:30:29,550 - INFO - ============================================================
2025-11-22 10:33:29,535 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 10:33:29,535 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 10:49:38,531 - INFO - pipeline模块导入成功
2025-11-22 10:49:38,532 - INFO - 步骤4: 设置默认参数...
2025-11-22 10:49:38,532 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:49:38,532 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:49:38,532 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 10:49:38,532 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:49:38,532 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 10:49:38,533 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 10:49:38,533 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 10:49:38,533 - INFO - Pipeline实例创建成功
2025-11-22 10:49:38,533 - INFO - 步骤8: 运行Pipeline...
2025-11-22 10:49:38,533 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 10:49:38,533 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 10:49:38,533 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 10:49:38,534 - INFO - 检查依赖文件...
2025-11-22 10:49:38,534 - INFO - 依赖文件检查通过
2025-11-22 10:49:38,534 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 10:49:38,535 - INFO - 找到 15 个GIS数据文件
2025-11-22 10:49:38,535 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:49:38,536 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 10:49:38,536 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 10:49:38,536 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 10:49:38,536 - INFO - 开始执行: GIS数据格式转换
2025-11-22 10:49:38,536 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 10:49:39,239 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 10:49:39,239 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 10:49:39,240 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 10:49:39,240 - INFO - 开始执行: GIS数据修复
2025-11-22 10:49:39,240 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 10:49:39,427 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 10:49:39,429 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 10:49:39,429 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 10:49:39,430 - INFO - 开始执行: 生成灌溉计划
2025-11-22 10:49:39,430 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json --multi-pump --summary --realtime
2025-11-22 10:49:40,789 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1108.13元 - 运行30.78h
推荐方案: 水泵['P1'] (电费: 1108.13元, 运行时间: 30.78h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json

2025-11-22 10:49:40,790 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 10:49:40,790 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.256934
2025-11-22 10:49:40,791 - INFO - 生成的文件:
2025-11-22 10:49:40,791 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 10:49:40,791 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 10:49:40,791 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 10:49:40,791 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 10:49:40,792 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 10:49:40,793 - INFO - Pipeline执行结果: success=True
2025-11-22 10:49:40,793 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 10:49:40,794 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 10:49:40,794 - INFO - 开始生成多水泵方案对比
2025-11-22 10:49:41,366 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 10:49:41,366 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 10:49:41,366 - INFO - 灌溉计划生成完成
2025-11-22 10:50:08,447 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:50:08,447 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 10:50:08,448 - INFO - 配置文件加载成功: config.json
2025-11-22 10:50:08,448 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 10:50:08,448 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.37h
2025-11-22 10:50:08,449 - INFO - 批次 2: 开始时间 17.37h, 持续时间 13.25h
2025-11-22 10:50:08,449 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:50:08,449 - INFO - 共有 2 个批次
2025-11-22 10:50:08,451 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 10:50:08,454 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_105008
2025-11-22 10:50:08,456 - INFO - [scheduler] 执行开始时间: 2025-11-22 10:50:08.449611
2025-11-22 10:50:08,457 - INFO - 开始准备批次 1
2025-11-22 10:50:08,457 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:50:08,750 - INFO - 批次 1 计划重新生成完成
2025-11-22 10:50:08,750 - INFO - 开始执行批次 1
2025-11-22 10:50:08,750 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 10:50:08,751 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0002 - 启动P1泵站
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0003 - 开启S1-G27节制闸(100%)
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0004 - 开启S2-G10节制闸(100%)
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0005 - 开启S2-G12节制闸(100%)
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0006 - 开启S2-G13节制闸(100%)
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0007 - 开启S2-G14节制闸(100%)
2025-11-22 10:50:08,751 - INFO - 添加指令: cmd_0008 - 开启S3-G18节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0009 - 开启S3-G19节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0010 - 开启S3-G20节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0011 - 开启S3-G21节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0012 - 开启S1-G27节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0013 - 开启S3-G23节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0014 - 开启S3-G25节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 添加指令: cmd_0015 - 开启S5-G29节制闸(100%)
2025-11-22 10:50:08,752 - INFO - 批次 1 已生成 15 条启动指令
2025-11-22 10:50:08,759 - INFO - 初始化批次监控: 0 个田块, 13 个节制闸, 1 个泵站
2025-11-22 10:50:08,759 - INFO - ✅ 监控初始化完成
2025-11-22 10:50:08,760 - INFO - 批次 1 监控初始化完成: 0田块, 13节制闸, 1泵站
2025-11-22 10:50:08,760 - INFO - 批次 1 开始实时监控（预计 17.37h）
2025-11-22 10:50:08,760 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:50:08,760 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:50:38,751 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:50:38,751 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:50:59,451 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_100227.json
2025-11-22 10:51:08,750 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:51:08,750 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:51:38,747 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:51:38,747 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:52:08,745 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:52:08,745 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:52:38,748 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:52:38,748 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:53:08,746 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:53:08,746 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:53:38,745 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:53:38,745 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:54:08,755 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:54:08,755 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:54:38,756 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:54:38,756 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:55:08,761 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:55:08,761 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:55:38,756 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:55:38,756 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:56:08,770 - ERROR - 获取水位数据异常: fetch_waterlevels() got an unexpected keyword argument 'app_id'
2025-11-22 10:56:08,771 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 10:56:34,935 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 10:56:34,935 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 11:03:50,462 - INFO - pipeline模块导入成功
2025-11-22 11:03:50,462 - INFO - 步骤4: 设置默认参数...
2025-11-22 11:03:50,463 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:03:50,463 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:03:50,463 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 11:03:50,463 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:03:50,463 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 11:03:50,463 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 11:03:50,464 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 11:03:50,464 - INFO - Pipeline实例创建成功
2025-11-22 11:03:50,464 - INFO - 步骤8: 运行Pipeline...
2025-11-22 11:03:50,464 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 11:03:50,464 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:03:50,464 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:03:50,464 - INFO - 检查依赖文件...
2025-11-22 11:03:50,465 - INFO - 依赖文件检查通过
2025-11-22 11:03:50,465 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:03:50,466 - INFO - 找到 15 个GIS数据文件
2025-11-22 11:03:50,466 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:03:50,466 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 11:03:50,466 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 11:03:50,466 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 11:03:50,466 - INFO - 开始执行: GIS数据格式转换
2025-11-22 11:03:50,467 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 11:03:51,210 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 11:03:51,211 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 11:03:51,211 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 11:03:51,212 - INFO - 开始执行: GIS数据修复
2025-11-22 11:03:51,212 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 11:03:51,395 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 11:03:51,397 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 11:03:51,397 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 11:03:51,397 - INFO - 开始执行: 生成灌溉计划
2025-11-22 11:03:51,397 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json --multi-pump --summary --realtime
2025-11-22 11:03:52,774 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1108.13元 - 运行30.78h
推荐方案: 水泵['P1'] (电费: 1108.13元, 运行时间: 30.78h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json

2025-11-22 11:03:52,775 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 11:03:52,775 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.310868
2025-11-22 11:03:52,776 - INFO - 生成的文件:
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 11:03:52,776 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 11:03:52,777 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 11:03:52,778 - INFO - Pipeline执行结果: success=True
2025-11-22 11:03:52,778 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 11:03:52,779 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 11:03:52,779 - INFO - 开始生成多水泵方案对比
2025-11-22 11:03:53,319 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 11:03:53,319 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 11:03:53,319 - INFO - 灌溉计划生成完成
2025-11-22 11:04:09,742 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:04:09,743 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:04:09,743 - INFO - 配置文件加载成功: config.json
2025-11-22 11:04:09,744 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 11:04:09,744 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.40h
2025-11-22 11:04:09,744 - INFO - 批次 2: 开始时间 17.40h, 持续时间 13.38h
2025-11-22 11:04:09,744 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:04:09,744 - INFO - 共有 2 个批次
2025-11-22 11:04:09,747 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 11:04:09,749 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_110409
2025-11-22 11:04:09,751 - INFO - [scheduler] 执行开始时间: 2025-11-22 11:04:09.744869
2025-11-22 11:04:09,752 - INFO - 开始准备批次 1
2025-11-22 11:04:10,072 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:04:10,362 - INFO - 批次 1 计划重新生成完成
2025-11-22 11:04:10,362 - INFO - 开始执行批次 1
2025-11-22 11:04:10,362 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 11:04:10,362 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 11:04:10,363 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 11:04:10,364 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 11:04:10,365 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 11:04:10,365 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 11:04:10,365 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 11:04:10,366 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 11:04:10,367 - INFO - ✅ 监控初始化完成
2025-11-22 11:04:10,367 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 11:04:10,367 - INFO - 批次 1 开始实时监控（预计 17.40h）
2025-11-22 11:04:10,608 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:04:10,608 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:04:40,924 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:04:40,924 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:05:11,234 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:05:11,234 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:05:41,545 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:05:41,545 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:06:11,858 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:06:11,858 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:06:42,434 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:06:42,434 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:07:12,727 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:07:12,727 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:07:43,032 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:07:43,032 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:08:13,315 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:08:13,315 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:08:43,818 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:08:43,818 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:09:14,142 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:09:14,142 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:09:44,487 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:09:44,487 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:10:14,795 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:10:14,795 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:10:45,167 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:10:45,167 - WARNING - 第 14 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:11:15,491 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:11:15,491 - WARNING - 第 15 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:11:45,856 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:11:45,856 - WARNING - 第 16 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:12:16,166 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:12:16,166 - WARNING - 第 17 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:12:46,464 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:12:46,464 - WARNING - 第 18 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:13:16,779 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:13:16,779 - WARNING - 第 19 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:13:47,070 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:13:47,070 - WARNING - 第 20 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:14:17,397 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:14:17,397 - WARNING - 第 21 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:14:47,772 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:14:47,772 - WARNING - 第 22 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:15:18,305 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:15:18,305 - WARNING - 第 23 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:15:48,821 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:15:48,821 - WARNING - 第 24 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:16:19,188 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:16:19,188 - WARNING - 第 25 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:16:49,449 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:16:49,449 - WARNING - 第 26 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:17:19,759 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:17:19,759 - WARNING - 第 27 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:17:50,068 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:17:50,068 - WARNING - 第 28 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:18:20,366 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:18:20,366 - WARNING - 第 29 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:18:50,688 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:18:50,688 - WARNING - 第 30 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:19:20,997 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:19:20,997 - WARNING - 第 31 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:19:51,291 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:19:51,291 - WARNING - 第 32 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:20:21,562 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:20:21,562 - WARNING - 第 33 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:20:51,869 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:20:51,869 - WARNING - 第 34 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:21:22,180 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:21:22,180 - WARNING - 第 35 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:21:52,468 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:21:52,468 - WARNING - 第 36 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:22:22,753 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:22:22,753 - WARNING - 第 37 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:22:53,080 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:22:53,080 - WARNING - 第 38 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:23:23,413 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:23:23,413 - WARNING - 第 39 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:23:53,715 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:23:53,715 - WARNING - 第 40 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:24:24,010 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:24:24,010 - WARNING - 第 41 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:24:54,298 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:24:54,298 - WARNING - 第 42 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:25:24,599 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:25:24,599 - WARNING - 第 43 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:25:54,929 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:25:54,929 - WARNING - 第 44 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:26:25,330 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:26:25,330 - WARNING - 第 45 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:26:55,673 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:26:55,673 - WARNING - 第 46 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:27:25,996 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:27:25,996 - WARNING - 第 47 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:27:56,497 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:27:56,497 - WARNING - 第 48 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:28:26,799 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:28:26,799 - WARNING - 第 49 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:28:51,845 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 11:28:51,845 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 11:29:50,500 - INFO - pipeline模块导入成功
2025-11-22 11:29:50,500 - INFO - 步骤4: 设置默认参数...
2025-11-22 11:29:50,501 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:29:50,501 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:29:50,501 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 11:29:50,501 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:29:50,502 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 11:29:50,502 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 11:29:50,502 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 11:29:50,502 - INFO - Pipeline实例创建成功
2025-11-22 11:29:50,502 - INFO - 步骤8: 运行Pipeline...
2025-11-22 11:29:50,503 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 11:29:50,503 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:29:50,503 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:29:50,503 - INFO - 检查依赖文件...
2025-11-22 11:29:50,503 - INFO - 依赖文件检查通过
2025-11-22 11:29:50,503 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:29:50,504 - INFO - 找到 15 个GIS数据文件
2025-11-22 11:29:50,504 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:29:50,504 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 11:29:50,505 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 11:29:50,505 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 11:29:50,505 - INFO - 开始执行: GIS数据格式转换
2025-11-22 11:29:50,505 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 11:29:51,218 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 11:29:51,218 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 11:29:51,219 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 11:29:51,219 - INFO - 开始执行: GIS数据修复
2025-11-22 11:29:51,219 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 11:29:51,413 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 11:29:51,415 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 11:29:51,416 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 11:29:51,416 - INFO - 开始执行: 生成灌溉计划
2025-11-22 11:29:51,416 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json --multi-pump --summary --realtime
2025-11-22 11:29:53,040 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1110.91元 - 运行30.86h
推荐方案: 水泵['P1'] (电费: 1110.91元, 运行时间: 30.86h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json

2025-11-22 11:29:53,040 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 11:29:53,040 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.538433
2025-11-22 11:29:53,041 - INFO - 生成的文件:
2025-11-22 11:29:53,041 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 11:29:53,041 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 11:29:53,041 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 11:29:53,041 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 11:29:53,042 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 11:29:53,043 - INFO - Pipeline执行结果: success=True
2025-11-22 11:29:53,043 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 11:29:53,044 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 11:29:53,044 - INFO - 开始生成多水泵方案对比
2025-11-22 11:29:53,877 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 11:29:53,877 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 11:29:53,877 - INFO - 灌溉计划生成完成
2025-11-22 11:30:41,719 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:30:41,720 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:30:41,720 - INFO - 配置文件加载成功: config.json
2025-11-22 11:30:41,721 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 11:30:41,721 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.40h
2025-11-22 11:30:41,721 - INFO - 批次 2: 开始时间 17.40h, 持续时间 13.38h
2025-11-22 11:30:41,721 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:30:41,721 - INFO - 共有 2 个批次
2025-11-22 11:30:41,724 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 11:30:41,727 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_113041
2025-11-22 11:30:41,729 - INFO - [scheduler] 执行开始时间: 2025-11-22 11:30:41.722257
2025-11-22 11:30:41,730 - INFO - 开始准备批次 1
2025-11-22 11:30:42,034 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:30:42,327 - INFO - 批次 1 计划重新生成完成
2025-11-22 11:30:42,327 - INFO - 开始执行批次 1
2025-11-22 11:30:42,327 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 11:30:42,328 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 11:30:42,329 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 11:30:42,330 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 11:30:42,330 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 11:30:42,330 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 11:30:42,330 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 11:30:42,330 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 11:30:42,332 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 11:30:42,332 - INFO - ✅ 监控初始化完成
2025-11-22 11:30:42,332 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 11:30:42,332 - INFO - 批次 1 开始实时监控（预计 17.40h）
2025-11-22 11:30:42,591 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:30:42,591 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:31:12,869 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:31:12,869 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:31:40,648 - INFO - 手动重新生成批次 1
2025-11-22 11:31:40,649 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:31:40,649 - INFO - 计划模板加载成功: E:\irrigation_schedule\farm_irrigation\irrigation_plan_template.json
2025-11-22 11:31:40,650 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 11:31:40,650 - INFO - 开始重新生成批次 1 的计划
2025-11-22 11:31:40,652 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 11:31:40,652 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 11:31:40,653 - INFO - 原始计划包含 1 个scenarios
2025-11-22 11:31:40,653 - INFO - 已更新scenario: P1单独使用
2025-11-22 11:31:40,653 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 11:31:40,655 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782300.json
2025-11-22 11:31:40,656 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 11:31:40,656 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 11:31:40,656 - INFO - 更新 S1-G3-F2 水位: 100.0mm
2025-11-22 11:31:40,656 - INFO - ============================================================
2025-11-22 11:31:40,656 - INFO - 开始检查水位和设备状态
2025-11-22 11:31:40,656 - INFO - ============================================================
2025-11-22 11:31:40,656 - WARNING - 🚨 田块 S1-G3-F2 水位过高: 100.0mm > 80.0mm，紧急排水
2025-11-22 11:31:40,744 - ERROR -   └─ 关闭进水阀失败: S1-G3-F2 - 未知错误
2025-11-22 11:31:40,744 - INFO - ============================================================
2025-11-22 11:31:40,744 - INFO - 检查完成: 田块完成 0, 节制闸关闭 0, 泵站停止 0
2025-11-22 11:31:40,744 - INFO - ============================================================
2025-11-22 11:31:43,175 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:31:43,175 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:32:13,479 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:32:13,479 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:32:43,777 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:32:43,777 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:33:14,072 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:33:14,072 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:33:30,965 - INFO - 手动重新生成批次 1
2025-11-22 11:33:30,965 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 11:33:30,965 - INFO - 开始重新生成批次 1 的计划
2025-11-22 11:33:30,968 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 11:33:30,968 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 11:33:30,968 - INFO - 原始计划包含 1 个scenarios
2025-11-22 11:33:30,969 - INFO - 已更新scenario: P1单独使用
2025-11-22 11:33:30,969 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 11:33:30,971 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782410.json
2025-11-22 11:33:30,971 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 11:33:30,971 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 11:33:30,971 - INFO - 更新 S1-G3-F2 水位: 75.0mm
2025-11-22 11:33:30,971 - INFO - ============================================================
2025-11-22 11:33:30,971 - INFO - 开始检查水位和设备状态
2025-11-22 11:33:30,971 - INFO - ============================================================
2025-11-22 11:33:30,972 - INFO - ============================================================
2025-11-22 11:33:30,972 - INFO - 检查完成: 田块完成 0, 节制闸关闭 0, 泵站停止 0
2025-11-22 11:33:30,972 - INFO - ============================================================
2025-11-22 11:33:44,378 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:33:44,378 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:34:14,671 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:34:14,671 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:34:15,150 - INFO - 手动重新生成批次 1
2025-11-22 11:34:15,151 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 11:34:15,151 - INFO - 开始重新生成批次 1 的计划
2025-11-22 11:34:15,153 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 11:34:15,153 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 11:34:15,154 - INFO - 原始计划包含 1 个scenarios
2025-11-22 11:34:15,154 - INFO - 已更新scenario: P1单独使用
2025-11-22 11:34:15,154 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 11:34:15,156 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782455.json
2025-11-22 11:34:15,156 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 11:34:15,156 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 11:34:15,156 - INFO - 更新 S1-G4-F3 水位: 75.0mm
2025-11-22 11:34:15,157 - INFO - ============================================================
2025-11-22 11:34:15,157 - INFO - 开始检查水位和设备状态
2025-11-22 11:34:15,157 - INFO - ============================================================
2025-11-22 11:34:15,157 - INFO - ✅ 田块 S1-G4-F3 水位达标: 75.0mm (目标: 50.0mm)
2025-11-22 11:34:15,199 - ERROR -   └─ 关闭进水阀失败: S1-G4-F3 - 未知错误
2025-11-22 11:34:15,199 - INFO - 本轮完成田块数: 1
2025-11-22 11:34:15,200 - WARNING -   └─ 节制闸 S3-G23 无 unique_no，跳过
2025-11-22 11:34:15,200 - WARNING -   └─ 节制闸 S3-G25 无 unique_no，跳过
2025-11-22 11:34:15,200 - WARNING -   └─ 节制闸 S5-G29 无 unique_no，跳过
2025-11-22 11:34:15,200 - INFO - ✅ 本轮关闭节制闸: S3-G23, S3-G25, S5-G29
2025-11-22 11:34:15,200 - INFO - ============================================================
2025-11-22 11:34:15,200 - INFO - 检查完成: 田块完成 1, 节制闸关闭 3, 泵站停止 0
2025-11-22 11:34:15,200 - INFO - ============================================================
2025-11-22 11:34:15,200 - INFO - 人工调整后，1个田块达标
2025-11-22 11:34:15,201 - INFO - 添加指令: cmd_0021 - 关闭S1-G4-F3进水阀(人工调整触发)
2025-11-22 11:34:15,201 - INFO - 人工调整后，3个节制闸需关闭
2025-11-22 11:34:15,201 - INFO - 添加指令: cmd_0022 - 关闭S3-G23节制闸(人工调整触发)
2025-11-22 11:34:15,201 - INFO - 添加指令: cmd_0023 - 关闭S3-G25节制闸(人工调整触发)
2025-11-22 11:34:15,201 - INFO - 添加指令: cmd_0024 - 关闭S5-G29节制闸(人工调整触发)
2025-11-22 11:34:44,989 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:34:44,989 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:35:15,284 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:35:15,284 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:35:45,586 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:35:45,586 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:36:15,905 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:36:15,905 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:36:46,211 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:36:46,211 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:37:16,520 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:37:16,520 - WARNING - 第 14 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:37:46,867 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:37:46,867 - WARNING - 第 15 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:38:17,244 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:38:17,244 - WARNING - 第 16 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:38:47,623 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:38:47,623 - WARNING - 第 17 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:39:17,925 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:39:17,925 - WARNING - 第 18 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:39:48,300 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:39:48,300 - WARNING - 第 19 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:40:18,594 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:40:18,594 - WARNING - 第 20 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:40:48,932 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:40:48,932 - WARNING - 第 21 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:41:19,256 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:41:19,256 - WARNING - 第 22 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:41:49,709 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:41:49,709 - WARNING - 第 23 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:42:20,017 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:42:20,017 - WARNING - 第 24 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:42:50,315 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:42:50,315 - WARNING - 第 25 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:43:20,750 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:43:20,750 - WARNING - 第 26 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:43:45,738 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 11:43:45,739 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 11:49:50,508 - INFO - pipeline模块导入成功
2025-11-22 11:49:50,509 - INFO - 步骤4: 设置默认参数...
2025-11-22 11:49:50,509 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:49:50,509 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:49:50,509 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 11:49:50,509 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:49:50,509 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 11:49:50,509 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 11:49:50,510 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 11:49:50,510 - INFO - Pipeline实例创建成功
2025-11-22 11:49:50,510 - INFO - 步骤8: 运行Pipeline...
2025-11-22 11:49:50,510 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 11:49:50,510 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:49:50,510 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 11:49:50,510 - INFO - 检查依赖文件...
2025-11-22 11:49:50,511 - INFO - 依赖文件检查通过
2025-11-22 11:49:50,511 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 11:49:50,512 - INFO - 找到 15 个GIS数据文件
2025-11-22 11:49:50,512 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:49:50,512 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 11:49:50,512 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 11:49:50,512 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 11:49:50,512 - INFO - 开始执行: GIS数据格式转换
2025-11-22 11:49:50,513 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 11:49:51,261 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 11:49:51,262 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 11:49:51,262 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 11:49:51,263 - INFO - 开始执行: GIS数据修复
2025-11-22 11:49:51,263 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 11:49:51,450 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 11:49:51,452 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 11:49:51,453 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 11:49:51,453 - INFO - 开始执行: 生成灌溉计划
2025-11-22 11:49:51,453 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json --multi-pump --summary --realtime
2025-11-22 11:49:52,751 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1114.85元 - 运行30.97h
推荐方案: 水泵['P1'] (电费: 1114.85元, 运行时间: 30.97h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json

2025-11-22 11:49:52,752 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 11:49:52,753 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.243567
2025-11-22 11:49:52,753 - INFO - 生成的文件:
2025-11-22 11:49:52,753 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 11:49:52,753 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 11:49:52,754 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782300.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782410.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782455.json
2025-11-22 11:49:52,755 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 11:49:52,756 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 11:49:52,756 - INFO - Pipeline执行结果: success=True
2025-11-22 11:49:52,757 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json
2025-11-22 11:49:52,757 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 11:49:52,757 - INFO - 开始生成多水泵方案对比
2025-11-22 11:49:53,311 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 11:49:53,311 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 11:49:53,311 - INFO - 灌溉计划生成完成
2025-11-22 11:50:07,679 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:50:07,680 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:50:07,680 - INFO - 配置文件加载成功: config.json
2025-11-22 11:50:07,680 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 11:50:07,681 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.40h
2025-11-22 11:50:07,682 - INFO - 批次 2: 开始时间 17.40h, 持续时间 13.38h
2025-11-22 11:50:07,682 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_110351.json
2025-11-22 11:50:07,682 - INFO - 共有 2 个批次
2025-11-22 11:50:07,684 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 11:50:07,687 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_115007
2025-11-22 11:50:07,689 - INFO - [scheduler] 执行开始时间: 2025-11-22 11:50:07.682510
2025-11-22 11:50:07,690 - INFO - 开始准备批次 1
2025-11-22 11:50:08,051 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:50:08,319 - INFO - 批次 1 计划重新生成完成
2025-11-22 11:50:08,319 - INFO - 开始执行批次 1
2025-11-22 11:50:08,319 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 11:50:08,319 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 11:50:08,320 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 11:50:08,321 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 11:50:08,322 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 11:50:08,322 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 11:50:08,327 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 11:50:08,327 - INFO - ✅ 监控初始化完成
2025-11-22 11:50:08,327 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 11:50:08,328 - INFO - 批次 1 开始实时监控（预计 17.40h）
2025-11-22 11:50:08,596 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:50:08,596 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:50:33,429 - INFO - 手动重新生成批次 1
2025-11-22 11:50:33,430 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 11:50:33,430 - INFO - 计划模板加载成功: E:\irrigation_schedule\farm_irrigation\irrigation_plan_template.json
2025-11-22 11:50:33,430 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 11:50:33,430 - INFO - 开始重新生成批次 1 的计划
2025-11-22 11:50:33,433 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 11:50:33,433 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 11:50:33,433 - INFO - 原始计划包含 1 个scenarios
2025-11-22 11:50:33,434 - INFO - 已更新scenario: P1单独使用
2025-11-22 11:50:33,434 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 11:50:33,436 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763783433.json
2025-11-22 11:50:33,436 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 11:50:33,436 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 11:50:33,436 - INFO - 更新 S1-G4-F3 水位: 75.0mm
2025-11-22 11:50:33,437 - INFO - ============================================================
2025-11-22 11:50:33,437 - INFO - 开始检查水位和设备状态
2025-11-22 11:50:33,437 - INFO - ============================================================
2025-11-22 11:50:33,437 - INFO - ✅ 田块 S1-G4-F3 水位达标: 75.0mm (目标: 50.0mm)
2025-11-22 11:50:33,437 - INFO -   └─ 标记关闭进水阀: S1-G4-F3
2025-11-22 11:50:33,437 - INFO - 本轮完成田块数: 1
2025-11-22 11:50:33,437 - WARNING -   └─ 节制闸 S3-G23 无 unique_no（配置中缺失）
2025-11-22 11:50:33,438 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G23 (支渠S3)
2025-11-22 11:50:33,438 - WARNING -   └─ 节制闸 S3-G25 无 unique_no（配置中缺失）
2025-11-22 11:50:33,438 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G25 (支渠S3)
2025-11-22 11:50:33,438 - WARNING -   └─ 节制闸 S5-G29 无 unique_no（配置中缺失）
2025-11-22 11:50:33,438 - INFO -   └─ 标记关闭inlet-g节制闸: S5-G29 (支渠S5)
2025-11-22 11:50:33,438 - INFO - ✅ 本轮关闭节制闸: S3-G23, S3-G25, S5-G29
2025-11-22 11:50:33,438 - INFO - ============================================================
2025-11-22 11:50:33,438 - INFO - 检查完成: 田块完成 1, 节制闸关闭 3, 泵站停止 0
2025-11-22 11:50:33,439 - INFO - ============================================================
2025-11-22 11:50:33,439 - INFO - 人工调整后，1个田块达标
2025-11-22 11:50:33,439 - INFO - 添加指令: cmd_0021 - 关闭S1-G4-F3进水阀(人工调整触发)
2025-11-22 11:50:33,439 - INFO - 人工调整后，3个节制闸需关闭
2025-11-22 11:50:33,439 - INFO - 添加指令: cmd_0022 - 关闭S3-G23节制闸(人工调整触发)
2025-11-22 11:50:33,439 - INFO - 添加指令: cmd_0023 - 关闭S3-G25节制闸(人工调整触发)
2025-11-22 11:50:33,439 - INFO - 添加指令: cmd_0024 - 关闭S5-G29节制闸(人工调整触发)
2025-11-22 11:50:38,920 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:50:38,920 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:51:09,265 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:51:09,265 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:51:39,545 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:51:39,545 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:52:09,852 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:52:09,852 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:52:40,157 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:52:40,157 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:53:10,501 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:53:10,501 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:53:40,880 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:53:40,880 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:54:11,244 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:54:11,244 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:54:41,550 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:54:41,550 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:55:11,910 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:55:11,910 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:55:42,248 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:55:42,248 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:56:12,559 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:56:12,559 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:56:42,880 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:56:42,880 - WARNING - 第 14 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:57:13,171 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:57:13,171 - WARNING - 第 15 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:57:43,488 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:57:43,488 - WARNING - 第 16 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:58:13,795 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:58:13,795 - WARNING - 第 17 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:58:44,103 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:58:44,103 - WARNING - 第 18 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:59:14,392 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:59:14,392 - WARNING - 第 19 次检查：未获取到水位数据，30秒后重试
2025-11-22 11:59:44,664 - WARNING - 获取水位数据失败：返回为空
2025-11-22 11:59:44,664 - WARNING - 第 20 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:00:14,987 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:00:14,987 - WARNING - 第 21 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:00:45,316 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:00:45,316 - WARNING - 第 22 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:01:15,665 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:01:15,665 - WARNING - 第 23 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:01:45,967 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:01:45,967 - WARNING - 第 24 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:02:16,263 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:02:16,263 - WARNING - 第 25 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:02:46,560 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:02:46,560 - WARNING - 第 26 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:03:16,833 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:03:16,833 - WARNING - 第 27 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:03:47,139 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:03:47,139 - WARNING - 第 28 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:04:17,403 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:04:17,403 - WARNING - 第 29 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:04:47,698 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:04:47,698 - WARNING - 第 30 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:05:18,004 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:05:18,004 - WARNING - 第 31 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:05:48,360 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:05:48,360 - WARNING - 第 32 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:06:18,649 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:06:18,649 - WARNING - 第 33 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:06:48,937 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:06:48,937 - WARNING - 第 34 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:07:19,349 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:07:19,349 - WARNING - 第 35 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:07:33,746 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 12:07:33,746 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 12:09:00,622 - INFO - pipeline模块导入成功
2025-11-22 12:09:00,622 - INFO - 步骤4: 设置默认参数...
2025-11-22 12:09:00,623 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:09:00,623 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:09:00,623 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 12:09:00,623 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:09:00,623 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 12:09:00,624 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 12:09:00,624 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 12:09:00,624 - INFO - Pipeline实例创建成功
2025-11-22 12:09:00,624 - INFO - 步骤8: 运行Pipeline...
2025-11-22 12:09:00,624 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 12:09:00,624 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:09:00,625 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:09:00,625 - INFO - 检查依赖文件...
2025-11-22 12:09:00,625 - INFO - 依赖文件检查通过
2025-11-22 12:09:00,625 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:09:00,627 - INFO - 找到 15 个GIS数据文件
2025-11-22 12:09:00,627 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:09:00,627 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 12:09:00,628 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 12:09:00,628 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 12:09:00,628 - INFO - 开始执行: GIS数据格式转换
2025-11-22 12:09:00,628 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 12:09:01,354 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 12:09:01,354 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 12:09:01,355 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 12:09:01,355 - INFO - 开始执行: GIS数据修复
2025-11-22 12:09:01,355 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 12:09:01,545 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 12:09:01,546 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 12:09:01,547 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 12:09:01,547 - INFO - 开始执行: 生成灌溉计划
2025-11-22 12:09:01,547 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json --multi-pump --summary --realtime
2025-11-22 12:09:02,883 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1126.63元 - 运行31.30h
推荐方案: 水泵['P1'] (电费: 1126.63元, 运行时间: 31.30h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json

2025-11-22 12:09:02,884 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 12:09:02,884 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.260728
2025-11-22 12:09:02,884 - INFO - 生成的文件:
2025-11-22 12:09:02,884 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 12:09:02,885 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782300.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782410.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782455.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763783433.json
2025-11-22 12:09:02,886 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 12:09:02,887 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 12:09:02,887 - INFO - Pipeline执行结果: success=True
2025-11-22 12:09:02,888 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json
2025-11-22 12:09:02,888 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 12:09:02,889 - INFO - 开始生成多水泵方案对比
2025-11-22 12:09:03,535 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 12:09:03,535 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 12:09:03,535 - INFO - 灌溉计划生成完成
2025-11-22 12:09:50,850 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_120901.json
2025-11-22 12:09:50,851 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:09:50,852 - INFO - 配置文件加载成功: config.json
2025-11-22 12:09:50,852 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 12:09:50,852 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.85h
2025-11-22 12:09:50,852 - INFO - 批次 2: 开始时间 17.85h, 持续时间 13.45h
2025-11-22 12:09:50,852 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_120901.json
2025-11-22 12:09:50,853 - INFO - 共有 2 个批次
2025-11-22 12:09:50,855 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 12:09:50,857 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_120950
2025-11-22 12:09:50,860 - INFO - [scheduler] 执行开始时间: 2025-11-22 12:09:50.853342
2025-11-22 12:09:50,861 - INFO - 开始准备批次 1
2025-11-22 12:09:51,166 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:09:51,501 - INFO - 批次 1 计划重新生成完成
2025-11-22 12:09:51,501 - INFO - 开始执行批次 1
2025-11-22 12:09:51,501 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 12:09:51,502 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 12:09:51,503 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 12:09:51,504 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 12:09:51,504 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 12:09:51,504 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 12:09:51,504 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 12:09:51,504 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 12:09:51,506 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 12:09:51,506 - INFO - ✅ 监控初始化完成
2025-11-22 12:09:51,506 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 12:09:51,507 - INFO - 批次 1 开始实时监控（预计 17.85h）
2025-11-22 12:09:51,769 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:09:51,769 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:10:22,107 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:10:22,107 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:10:52,454 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:10:52,454 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:11:22,760 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:11:22,760 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:11:53,081 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:11:53,081 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:12:23,430 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:12:23,430 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:12:53,752 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:12:53,752 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:13:24,074 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:13:24,074 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:13:54,372 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:13:54,372 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:14:05,460 - INFO - 指令状态更新: cmd_0001 sent → executed
2025-11-22 12:14:05,460 - INFO -   反馈: P1泵站已成功启动，运行正常
2025-11-22 12:14:05,460 - INFO - 收到指令反馈: cmd_0001 - executed
2025-11-22 12:14:24,739 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:14:24,739 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:14:55,047 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:14:55,047 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:15:25,392 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:15:25,392 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:15:28,416 - INFO - 指令状态更新: cmd_0002 sent → executed
2025-11-22 12:15:28,417 - INFO -   反馈: S1-G27节制闸已开启至100%
2025-11-22 12:15:28,417 - INFO - 收到指令反馈: cmd_0002 - executed
2025-11-22 12:15:47,618 - INFO - 指令状态更新: cmd_0003 sent → executed
2025-11-22 12:15:47,618 - INFO -   反馈: S1-G3-F2进水阀已开启
2025-11-22 12:15:47,618 - INFO - 收到指令反馈: cmd_0003 - executed
2025-11-22 12:15:55,697 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:15:55,697 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:16:26,038 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:16:26,038 - WARNING - 第 14 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:16:56,385 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:16:56,385 - WARNING - 第 15 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:17:26,686 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:17:26,686 - WARNING - 第 16 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:17:56,950 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:17:56,950 - WARNING - 第 17 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:18:27,285 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:18:27,285 - WARNING - 第 18 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:18:57,623 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:18:57,623 - WARNING - 第 19 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:19:08,816 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 12:19:08,816 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 12:20:57,576 - INFO - pipeline模块导入成功
2025-11-22 12:20:57,577 - INFO - 步骤4: 设置默认参数...
2025-11-22 12:20:57,577 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:20:57,577 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:20:57,577 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 12:20:57,578 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:20:57,578 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 12:20:57,578 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 12:20:57,578 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 12:20:57,578 - INFO - Pipeline实例创建成功
2025-11-22 12:20:57,578 - INFO - 步骤8: 运行Pipeline...
2025-11-22 12:20:57,579 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 12:20:57,579 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:20:57,579 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:20:57,579 - INFO - 检查依赖文件...
2025-11-22 12:20:57,579 - INFO - 依赖文件检查通过
2025-11-22 12:20:57,579 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:20:57,580 - INFO - 找到 15 个GIS数据文件
2025-11-22 12:20:57,580 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:20:57,580 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 12:20:57,581 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 12:20:57,581 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 12:20:57,581 - INFO - 开始执行: GIS数据格式转换
2025-11-22 12:20:57,581 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 12:20:58,317 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 12:20:58,318 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 12:20:58,319 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 12:20:58,319 - INFO - 开始执行: GIS数据修复
2025-11-22 12:20:58,319 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 12:20:58,508 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 12:20:58,510 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 12:20:58,511 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 12:20:58,511 - INFO - 开始执行: 生成灌溉计划
2025-11-22 12:20:58,511 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_122058.json --multi-pump --summary --realtime
2025-11-22 12:21:00,417 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1126.63元 - 运行31.30h
推荐方案: 水泵['P1'] (电费: 1126.63元, 运行时间: 31.30h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_122058.json

2025-11-22 12:21:00,417 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 12:21:00,417 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.839366
2025-11-22 12:21:00,418 - INFO - 生成的文件:
2025-11-22 12:21:00,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 12:21:00,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 12:21:00,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 12:21:00,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_122058.json
2025-11-22 12:21:00,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782300.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782410.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782455.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763783433.json
2025-11-22 12:21:00,420 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 12:21:00,421 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 12:21:00,421 - INFO - Pipeline执行结果: success=True
2025-11-22 12:21:00,422 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_122058.json
2025-11-22 12:21:00,422 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 12:21:00,422 - INFO - 开始生成多水泵方案对比
2025-11-22 12:21:01,477 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 12:21:01,477 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 12:21:01,477 - INFO - 灌溉计划生成完成
2025-11-22 12:21:12,138 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_122058.json
2025-11-22 12:21:12,139 - INFO - 配置文件加载成功: config.json
2025-11-22 12:21:12,140 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 12:21:12,140 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.85h
2025-11-22 12:21:12,140 - INFO - 批次 2: 开始时间 17.85h, 持续时间 13.45h
2025-11-22 12:21:12,141 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_122058.json
2025-11-22 12:21:12,141 - INFO - 共有 2 个批次
2025-11-22 12:21:12,144 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 12:21:12,147 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_122112
2025-11-22 12:21:12,150 - INFO - [scheduler] 执行开始时间: 2025-11-22 12:21:12.141592
2025-11-22 12:21:12,151 - INFO - 开始准备批次 1
2025-11-22 12:21:12,448 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:21:13,060 - INFO - 批次 1 计划重新生成完成
2025-11-22 12:21:13,060 - INFO - 开始执行批次 1
2025-11-22 12:21:13,060 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 12:21:13,060 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 12:21:13,060 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 12:21:13,061 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 12:21:13,062 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 12:21:13,063 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 12:21:13,063 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 12:21:13,063 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 12:21:13,063 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 12:21:13,064 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 12:21:13,065 - INFO - ✅ 监控初始化完成
2025-11-22 12:21:13,065 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 12:21:13,065 - INFO - 批次 1 开始实时监控（预计 17.85h）
2025-11-22 12:21:13,356 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:21:13,356 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:21:26,626 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_122058.json
2025-11-22 12:21:43,651 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:21:43,651 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:22:13,942 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:22:13,942 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:22:38,269 - INFO - 指令状态更新: cmd_0001 sent → executed
2025-11-22 12:22:38,269 - INFO -   反馈: P1泵站已成功启动，运行正常
2025-11-22 12:22:38,269 - INFO - 收到指令反馈: cmd_0001 - executed
2025-11-22 12:22:44,263 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:22:44,263 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:22:59,433 - INFO - 指令状态更新: cmd_0002 sent → executed
2025-11-22 12:22:59,434 - INFO -   反馈: S1-G27节制闸已开启至100%
2025-11-22 12:22:59,434 - INFO - 收到指令反馈: cmd_0002 - executed
2025-11-22 12:23:14,592 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:23:14,592 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:23:17,223 - INFO - 指令状态更新: cmd_0003 sent → executed
2025-11-22 12:23:17,223 - INFO -   反馈: S1-G3-F2进水阀已开启
2025-11-22 12:23:17,223 - INFO - 收到指令反馈: cmd_0003 - executed
2025-11-22 12:23:44,892 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:23:44,892 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:24:15,185 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:24:15,185 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:24:18,605 - INFO - 手动重新生成批次 1
2025-11-22 12:24:18,605 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:24:18,606 - INFO - 计划模板加载成功: E:\irrigation_schedule\farm_irrigation\irrigation_plan_template.json
2025-11-22 12:24:18,606 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 12:24:18,606 - INFO - 开始重新生成批次 1 的计划
2025-11-22 12:24:18,608 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 12:24:18,608 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 12:24:18,609 - INFO - 原始计划包含 1 个scenarios
2025-11-22 12:24:18,609 - INFO - 已更新scenario: P1单独使用
2025-11-22 12:24:18,609 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 12:24:18,611 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763785458.json
2025-11-22 12:24:18,611 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 12:24:18,611 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 12:24:18,612 - INFO - 更新 S1-G3-F2 水位: 75.0mm
2025-11-22 12:24:18,612 - INFO - ============================================================
2025-11-22 12:24:18,612 - INFO - 开始检查水位和设备状态
2025-11-22 12:24:18,612 - INFO - ============================================================
2025-11-22 12:24:18,612 - INFO - ✅ 田块 S1-G3-F2 水位达标: 75.0mm (目标: 50.0mm)
2025-11-22 12:24:18,612 - INFO -   └─ 标记关闭进水阀: S1-G3-F2
2025-11-22 12:24:18,612 - INFO - 本轮完成田块数: 1
2025-11-22 12:24:18,613 - WARNING -   └─ 节制闸 S3-G23 无 unique_no（配置中缺失）
2025-11-22 12:24:18,613 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G23 (支渠S3)
2025-11-22 12:24:18,613 - WARNING -   └─ 节制闸 S3-G25 无 unique_no（配置中缺失）
2025-11-22 12:24:18,613 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G25 (支渠S3)
2025-11-22 12:24:18,613 - WARNING -   └─ 节制闸 S5-G29 无 unique_no（配置中缺失）
2025-11-22 12:24:18,613 - INFO -   └─ 标记关闭inlet-g节制闸: S5-G29 (支渠S5)
2025-11-22 12:24:18,613 - INFO - ✅ 本轮关闭节制闸: S3-G23, S3-G25, S5-G29
2025-11-22 12:24:18,613 - INFO - ============================================================
2025-11-22 12:24:18,613 - INFO - 检查完成: 田块完成 1, 节制闸关闭 3, 泵站停止 0
2025-11-22 12:24:18,614 - INFO - ============================================================
2025-11-22 12:24:18,614 - INFO - 人工调整后，1个田块达标
2025-11-22 12:24:18,614 - INFO - 添加指令: cmd_0021 - 关闭S1-G3-F2进水阀(人工调整触发)
2025-11-22 12:24:18,614 - INFO - 人工调整后，3个节制闸需关闭
2025-11-22 12:24:18,614 - INFO - 添加指令: cmd_0022 - 关闭S3-G23节制闸(人工调整触发)
2025-11-22 12:24:18,614 - INFO - 添加指令: cmd_0023 - 关闭S3-G25节制闸(人工调整触发)
2025-11-22 12:24:18,614 - INFO - 添加指令: cmd_0024 - 关闭S5-G29节制闸(人工调整触发)
2025-11-22 12:24:45,490 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:24:45,490 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:25:15,769 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:25:15,769 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:25:46,092 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:25:46,092 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:26:16,387 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:26:16,387 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:26:46,718 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:26:46,718 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:27:17,024 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:27:17,024 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:27:47,330 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:27:47,330 - WARNING - 第 14 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:28:17,665 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:28:17,665 - WARNING - 第 15 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:28:47,972 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:28:47,972 - WARNING - 第 16 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:29:07,453 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 12:29:07,453 - INFO - 智能灌溉动态执行系统已关闭
2025-11-22 12:31:15,377 - INFO - pipeline模块导入成功
2025-11-22 12:31:15,377 - INFO - 步骤4: 设置默认参数...
2025-11-22 12:31:15,377 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:31:15,377 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:31:15,377 - INFO - 步骤5: 确保输出目录存在...
2025-11-22 12:31:15,378 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:31:15,378 - INFO - 步骤6: 构建pipeline参数...
2025-11-22 12:31:15,378 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-22 12:31:15,378 - INFO - 步骤7: 创建Pipeline实例...
2025-11-22 12:31:15,378 - INFO - Pipeline实例创建成功
2025-11-22 12:31:15,379 - INFO - 步骤8: 运行Pipeline...
2025-11-22 12:31:15,379 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-22 12:31:15,379 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:31:15,379 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-22 12:31:15,379 - INFO - 检查依赖文件...
2025-11-22 12:31:15,380 - INFO - 依赖文件检查通过
2025-11-22 12:31:15,380 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-22 12:31:15,381 - INFO - 找到 15 个GIS数据文件
2025-11-22 12:31:15,381 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:31:15,381 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-22 12:31:15,381 - INFO - === 步骤1: 数据预处理 ===
2025-11-22 12:31:15,381 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-22 12:31:15,381 - INFO - 开始执行: GIS数据格式转换
2025-11-22 12:31:15,382 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-22 12:31:16,071 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-22 12:31:16,071 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-22 12:31:16,072 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-22 12:31:16,072 - INFO - 开始执行: GIS数据修复
2025-11-22 12:31:16,072 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-22 12:31:16,257 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-22 12:31:16,259 - INFO - [OK] GIS数据修复 执行成功
2025-11-22 12:31:16,260 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-22 12:31:16,260 - INFO - 开始执行: 生成灌溉计划
2025-11-22 12:31:16,260 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_123116.json --multi-pump --summary --realtime
2025-11-22 12:31:17,537 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=25, 有水位数据=13, 无水位数据=12, 低于阈值=10
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 10
需要灌溉的段: ['S1', 'S2', 'S3', 'S5']
有效水泵组合: [['P1']]
生成方案数: 1
方案 1: 水泵['P1'] - 覆盖段4个['S1', 'S2', 'S3', 'S5'] - 电费1126.63元 - 运行31.30h
推荐方案: 水泵['P1'] (电费: 1126.63元, 运行时间: 31.30h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_123116.json

2025-11-22 12:31:17,537 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-22 12:31:17,537 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.159575
2025-11-22 12:31:17,538 - INFO - 生成的文件:
2025-11-22 12:31:17,538 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-22 12:31:17,538 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-22 12:31:17,538 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_202044.json
2025-11-22 12:31:17,538 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_205525.json
2025-11-22 12:31:17,538 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_210408.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_100227.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_104939.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_110351.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_112951.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_114951.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_120901.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_122058.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_123116.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763778629.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779004.json
2025-11-22 12:31:17,539 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779079.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779211.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763779236.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782300.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782410.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763782455.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763783433.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763785458.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-22 12:31:17,540 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-22 12:31:17,540 - INFO - Pipeline执行结果: success=True
2025-11-22 12:31:17,542 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251122_123116.json
2025-11-22 12:31:17,542 - INFO - 成功读取计划数据，包含 3 项
2025-11-22 12:31:17,542 - INFO - 开始生成多水泵方案对比
2025-11-22 12:31:18,097 - INFO - 多水泵方案生成成功，共 1 个方案（触发阈值: 1个田块）
2025-11-22 12:31:18,097 - INFO - 灌溉计划结果已保存到缓存 - cache_key: efc0b01b4bed2458a3cfa18852d27fd8
2025-11-22 12:31:18,097 - INFO - 灌溉计划生成完成
2025-11-22 12:31:30,131 - INFO - 启动动态执行 - 计划文件: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_123116.json
2025-11-22 12:31:30,132 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:31:30,132 - INFO - 配置文件加载成功: config.json
2025-11-22 12:31:30,133 - INFO - 使用scenarios格式，选择第一个scenario: P1单独使用
2025-11-22 12:31:30,133 - INFO - 批次 1: 开始时间 0.00h, 持续时间 17.85h
2025-11-22 12:31:30,133 - INFO - 批次 2: 开始时间 17.85h, 持续时间 13.45h
2025-11-22 12:31:30,133 - INFO - 灌溉计划加载成功: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251122_123116.json
2025-11-22 12:31:30,133 - INFO - 共有 2 个批次
2025-11-22 12:31:30,137 - ERROR - 记录事件日志失败: NOT NULL constraint failed: execution_logs.category
2025-11-22 12:31:30,139 - INFO - [scheduler] 开始执行灌溉计划，执行ID: exec_20251122_123130
2025-11-22 12:31:30,141 - INFO - [scheduler] 执行开始时间: 2025-11-22 12:31:30.134461
2025-11-22 12:31:30,142 - INFO - 开始准备批次 1
2025-11-22 12:31:30,424 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:31:30,708 - INFO - 批次 1 计划重新生成完成
2025-11-22 12:31:30,708 - INFO - 开始执行批次 1
2025-11-22 12:31:30,708 - WARNING - 未找到泵站 P1 的unique_no
2025-11-22 12:31:30,708 - INFO - 添加指令: cmd_0001 - 启动P1泵站
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0002 - 开启S1-G27节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0003 - 开启S2-G10节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0004 - 开启S2-G12节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0005 - 开启S2-G13节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0006 - 开启S2-G14节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0007 - 开启S3-G18节制闸(100%)
2025-11-22 12:31:30,709 - INFO - 添加指令: cmd_0008 - 开启S3-G19节制闸(100%)
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0009 - 开启S3-G20节制闸(100%)
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0010 - 开启S3-G21节制闸(100%)
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0011 - 开启S1-G3-F2进水阀
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0012 - 开启S1-G4-F3进水阀
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0013 - 开启S2-G10-F7进水阀
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0014 - 开启S2-G12-F9进水阀
2025-11-22 12:31:30,710 - INFO - 添加指令: cmd_0015 - 开启S2-G13-F10进水阀
2025-11-22 12:31:30,711 - INFO - 添加指令: cmd_0016 - 开启S2-G14-F11进水阀
2025-11-22 12:31:30,711 - INFO - 添加指令: cmd_0017 - 开启S3-G18-F15进水阀
2025-11-22 12:31:30,711 - INFO - 添加指令: cmd_0018 - 开启S3-G19-F16进水阀
2025-11-22 12:31:30,711 - INFO - 添加指令: cmd_0019 - 开启S3-G20-F17进水阀
2025-11-22 12:31:30,711 - INFO - 添加指令: cmd_0020 - 开启S3-G21-F18进水阀
2025-11-22 12:31:30,711 - INFO - 批次 1 已生成 20 条启动指令
2025-11-22 12:31:30,713 - INFO - 初始化批次监控: 10 个田块, 13 个节制闸, 1 个泵站
2025-11-22 12:31:30,713 - INFO - ✅ 监控初始化完成
2025-11-22 12:31:30,713 - INFO - 批次 1 监控初始化完成: 10田块, 13节制闸, 1泵站
2025-11-22 12:31:30,713 - INFO - 批次 1 开始实时监控（预计 17.85h）
2025-11-22 12:31:31,032 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:31:31,032 - WARNING - 第 1 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:32:01,320 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:32:01,320 - WARNING - 第 2 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:32:31,619 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:32:31,619 - WARNING - 第 3 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:33:01,945 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:33:01,945 - WARNING - 第 4 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:33:32,414 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:33:32,414 - WARNING - 第 5 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:34:02,741 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:34:02,741 - WARNING - 第 6 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:34:05,442 - INFO - 指令状态更新: cmd_0001 pending → executed
2025-11-22 12:34:05,443 - INFO -   反馈: P1泵站已成功启动，运行正常
2025-11-22 12:34:05,443 - INFO - 收到指令反馈: cmd_0001 - executed
2025-11-22 12:34:20,236 - INFO - 指令状态更新: cmd_0002 pending → executed
2025-11-22 12:34:20,236 - INFO -   反馈: S1-G27节制闸已开启至100%
2025-11-22 12:34:20,236 - INFO - 收到指令反馈: cmd_0002 - executed
2025-11-22 12:34:33,072 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:34:33,072 - WARNING - 第 7 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:34:34,865 - INFO - 指令状态更新: cmd_0003 pending → executed
2025-11-22 12:34:34,866 - INFO -   反馈: S1-G3-F2进水阀已开启
2025-11-22 12:34:34,866 - INFO - 收到指令反馈: cmd_0003 - executed
2025-11-22 12:35:03,425 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:35:03,425 - WARNING - 第 8 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:35:22,625 - INFO - 手动重新生成批次 1
2025-11-22 12:35:22,626 - INFO - 配置文件加载成功: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-22 12:35:22,626 - INFO - 计划模板加载成功: E:\irrigation_schedule\farm_irrigation\irrigation_plan_template.json
2025-11-22 12:35:22,626 - INFO - 当前计划包含 1 个scenarios，使用第一个scenario: 'P1单独使用'
2025-11-22 12:35:22,626 - INFO - 开始重新生成批次 1 的计划
2025-11-22 12:35:22,629 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-22 12:35:22,629 - ERROR - 批次 1 状态为 executing，无法更新
2025-11-22 12:35:22,629 - INFO - 原始计划包含 1 个scenarios
2025-11-22 12:35:22,629 - INFO - 已更新scenario: P1单独使用
2025-11-22 12:35:22,629 - INFO - 最终保存的计划包含 1 个scenarios
2025-11-22 12:35:22,631 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1763786122.json
2025-11-22 12:35:22,631 - INFO - 使用自定义水位标准：1 个田块
2025-11-22 12:35:22,631 - INFO - 人工调整水位，更新监控器并触发设备检查
2025-11-22 12:35:22,631 - INFO - 更新 S1-G3-F2 水位: 75.0mm
2025-11-22 12:35:22,632 - INFO - ============================================================
2025-11-22 12:35:22,632 - INFO - 开始检查水位和设备状态
2025-11-22 12:35:22,632 - INFO - ============================================================
2025-11-22 12:35:22,632 - INFO - ✅ 田块 S1-G3-F2 水位达标: 75.0mm (目标: 50.0mm)
2025-11-22 12:35:22,632 - INFO -   └─ 标记关闭进水阀: S1-G3-F2
2025-11-22 12:35:22,632 - INFO - 本轮完成田块数: 1
2025-11-22 12:35:22,633 - WARNING -   └─ 节制闸 S3-G23 无 unique_no（配置中缺失）
2025-11-22 12:35:22,633 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G23 (支渠S3)
2025-11-22 12:35:22,633 - WARNING -   └─ 节制闸 S3-G25 无 unique_no（配置中缺失）
2025-11-22 12:35:22,633 - INFO -   └─ 标记关闭inlet-g节制闸: S3-G25 (支渠S3)
2025-11-22 12:35:22,633 - WARNING -   └─ 节制闸 S5-G29 无 unique_no（配置中缺失）
2025-11-22 12:35:22,633 - INFO -   └─ 标记关闭inlet-g节制闸: S5-G29 (支渠S5)
2025-11-22 12:35:22,634 - INFO - ✅ 本轮关闭节制闸: S3-G23, S3-G25, S5-G29
2025-11-22 12:35:22,634 - INFO - ============================================================
2025-11-22 12:35:22,634 - INFO - 检查完成: 田块完成 1, 节制闸关闭 3, 泵站停止 0
2025-11-22 12:35:22,634 - INFO - ============================================================
2025-11-22 12:35:22,634 - INFO - 人工调整后，1个田块达标
2025-11-22 12:35:22,634 - INFO - 添加指令: cmd_0021 - 关闭S1-G3-F2进水阀(人工调整触发)
2025-11-22 12:35:22,635 - INFO - 人工调整后，3个节制闸需关闭
2025-11-22 12:35:22,635 - INFO - 添加指令: cmd_0022 - 关闭S3-G23节制闸(人工调整触发)
2025-11-22 12:35:22,635 - INFO - 添加指令: cmd_0023 - 关闭S3-G25节制闸(人工调整触发)
2025-11-22 12:35:22,635 - INFO - 添加指令: cmd_0024 - 关闭S5-G29节制闸(人工调整触发)
2025-11-22 12:35:33,738 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:35:33,738 - WARNING - 第 9 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:36:04,046 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:36:04,046 - WARNING - 第 10 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:36:34,357 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:36:34,357 - WARNING - 第 11 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:37:04,674 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:37:04,674 - WARNING - 第 12 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:37:34,999 - WARNING - 获取水位数据失败：返回为空
2025-11-22 12:37:34,999 - WARNING - 第 13 次检查：未获取到水位数据，30秒后重试
2025-11-22 12:37:41,773 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-22 12:37:41,773 - INFO - 智能灌溉动态执行系统已关闭
