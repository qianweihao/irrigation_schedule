2025-11-14 15:45:30,541 - INFO - pipeline模块导入成功
2025-11-14 15:45:30,541 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:45:30,541 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,542 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:45:30,542 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:45:30,542 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,542 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:45:30,542 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:45:30,543 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:45:30,543 - INFO - Pipeline实例创建成功
2025-11-14 15:45:30,543 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:45:30,543 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:45:30,543 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\gzp_farm
2025-11-14 15:45:30,543 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\output
2025-11-14 15:45:30,543 - INFO - 检查依赖文件...
2025-11-14 15:45:30,544 - ERROR - 缺少必要文件: ['farmgis_convert.py', 'fix_farmgis_convert.py', 'auto_to_config.py']
2025-11-14 15:45:30,544 - INFO - Pipeline执行结果: success=False
2025-11-14 15:45:30,544 - ERROR - Pipeline执行失败
2025-11-14 15:46:23,207 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:46:23,207 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:49:02,394 - INFO - pipeline模块导入成功
2025-11-14 15:49:02,394 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:02,394 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,395 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:02,395 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:02,395 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,395 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:02,395 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:02,395 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:02,396 - INFO - Pipeline实例创建成功
2025-11-14 15:49:02,396 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:02,396 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:02,396 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:02,396 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:02,396 - INFO - 检查依赖文件...
2025-11-14 15:49:02,396 - INFO - 依赖文件检查通过
2025-11-14 15:49:02,397 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:02,397 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:02,397 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:02,398 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:02,398 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:02,398 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:02,429 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:02,429 - ERROR - 错误代码: 1
2025-11-14 15:49:02,429 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:02,429 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:02,429 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:02,429 - ERROR - Pipeline执行失败
2025-11-14 15:49:04,129 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-14 15:49:04,129 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-14 15:49:04,129 - INFO - 步骤1: 生成缓存键...
2025-11-14 15:49:04,129 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-14 15:49:04,129 - INFO - 步骤2: 检查缓存...
2025-11-14 15:49:04,129 - INFO - 缓存未命中，继续执行...
2025-11-14 15:49:04,129 - INFO - 步骤3: 导入pipeline模块...
2025-11-14 15:49:04,130 - INFO - pipeline模块导入成功
2025-11-14 15:49:04,130 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:04,130 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,130 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:04,130 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:04,130 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,130 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:04,131 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:04,131 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:04,131 - INFO - Pipeline实例创建成功
2025-11-14 15:49:04,131 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:04,131 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:04,131 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:04,131 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:04,131 - INFO - 检查依赖文件...
2025-11-14 15:49:04,132 - INFO - 依赖文件检查通过
2025-11-14 15:49:04,132 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:04,132 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:04,132 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:04,133 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:04,133 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:04,133 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:04,165 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:04,165 - ERROR - 错误代码: 1
2025-11-14 15:49:04,165 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:04,165 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:04,165 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:04,165 - ERROR - Pipeline执行失败
2025-11-14 15:49:32,792 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:49:32,792 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:49:49,449 - INFO - pipeline模块导入成功
2025-11-14 15:49:49,450 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:49:49,450 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,450 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:49:49,450 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:49:49,450 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,450 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:49:49,450 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:49:49,451 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:49:49,451 - INFO - Pipeline实例创建成功
2025-11-14 15:49:49,451 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:49:49,451 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:49:49,451 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:49,451 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:49:49,451 - INFO - 检查依赖文件...
2025-11-14 15:49:49,452 - INFO - 依赖文件检查通过
2025-11-14 15:49:49,452 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:49:49,452 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:49:49,452 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:49:49,453 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:49:49,453 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:49:49,453 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:49:49,484 - ERROR - [FAIL] GIS数据格式转换 执行失败
2025-11-14 15:49:49,485 - ERROR - 错误代码: 1
2025-11-14 15:49:49,485 - ERROR - 错误输出: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe: Error while finding module specification for 'src.converter.farmgis_convert' (ModuleNotFoundError: No module named 'src')

2025-11-14 15:49:49,485 - ERROR - 步骤1执行失败，流水线终止
2025-11-14 15:49:49,485 - INFO - Pipeline执行结果: success=False
2025-11-14 15:49:49,485 - ERROR - Pipeline执行失败
2025-11-14 15:53:08,707 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:53:08,707 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:54:33,343 - INFO - pipeline模块导入成功
2025-11-14 15:54:33,343 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:54:33,343 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,343 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:54:33,343 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:54:33,343 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,343 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:54:33,344 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:54:33,344 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:54:33,344 - INFO - Pipeline实例创建成功
2025-11-14 15:54:33,344 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:54:33,344 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:54:33,344 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:54:33,344 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:54:33,344 - INFO - 检查依赖文件...
2025-11-14 15:54:33,345 - INFO - 依赖文件检查通过
2025-11-14 15:54:33,345 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:54:33,346 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:54:33,346 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:54:33,346 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:54:33,346 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:54:33,347 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:54:34,300 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 15:54:34,301 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 15:54:34,301 - INFO - 开始执行: GIS数据修复
2025-11-14 15:54:34,301 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 15:54:34,481 - INFO - 输出: 在 gzp_farm 文件夹中未找到任何 *_code.geojson 文件
请先运行 farmgis_convert.py 生成 geojson 文件
工作目录: e:\irrigation_schedule\farm_irrigation\gzp_farm

完成。请刷新前端页面验证。

2025-11-14 15:54:34,481 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 15:54:34,481 - INFO - === 步骤2: 配置生成 ===
2025-11-14 15:54:34,482 - INFO - 开始执行: 生成系统配置
2025-11-14 15:54:34,482 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 15:54:35,138 - ERROR - [FAIL] 生成系统配置 执行失败
2025-11-14 15:54:35,139 - ERROR - 错误代码: 1
2025-11-14 15:54:35,139 - ERROR - 错误输出: Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 659, in <module>
    convert(
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 281, in convert
    seg_raw = _read_any(segments_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py", line 105, in _read_any
    raise FileNotFoundError(path)
FileNotFoundError: ����ƺˮ·_code.geojson

2025-11-14 15:54:35,139 - ERROR - 步骤2执行失败，流水线终止
2025-11-14 15:54:35,139 - INFO - Pipeline执行结果: success=False
2025-11-14 15:54:35,139 - ERROR - Pipeline执行失败
2025-11-14 15:55:52,442 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 15:55:52,442 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 15:58:59,453 - INFO - pipeline模块导入成功
2025-11-14 15:58:59,453 - INFO - 步骤4: 设置默认参数...
2025-11-14 15:58:59,454 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,454 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 15:58:59,454 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 15:58:59,454 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,454 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 15:58:59,454 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 15:58:59,454 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 15:58:59,455 - INFO - Pipeline实例创建成功
2025-11-14 15:58:59,455 - INFO - 步骤8: 运行Pipeline...
2025-11-14 15:58:59,455 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 15:58:59,455 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:58:59,455 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 15:58:59,455 - INFO - 检查依赖文件...
2025-11-14 15:58:59,456 - INFO - 依赖文件检查通过
2025-11-14 15:58:59,456 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 15:58:59,457 - INFO - 找到 6 个GIS数据文件
2025-11-14 15:58:59,457 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 15:58:59,457 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 15:58:59,457 - INFO - 开始执行: GIS数据格式转换
2025-11-14 15:58:59,457 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 15:59:00,121 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 15:59:00,121 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 15:59:00,122 - INFO - 开始执行: GIS数据修复
2025-11-14 15:59:00,122 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 15:59:00,295 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 15:59:00,295 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 15:59:00,296 - INFO - === 步骤2: 配置生成 ===
2025-11-14 15:59:00,296 - INFO - 开始执行: 生成系统配置
2025-11-14 15:59:00,296 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 15:59:01,103 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 15:59:01,103 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 15:59:01,103 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 15:59:01,104 - INFO - 开始执行: 生成灌溉计划
2025-11-14 15:59:01,104 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json --multi-pump --summary --realtime
2025-11-14 15:59:01,192 - INFO - 输出: [DEBUG] 实时水位API不可用
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 0
需要灌溉的段: []
有效水泵组合: []
生成方案数: 0
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json

2025-11-14 15:59:01,192 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 15:59:01,192 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.737505
2025-11-14 15:59:01,193 - INFO - 生成的文件:
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 15:59:01,193 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 15:59:01,194 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 15:59:01,195 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 15:59:01,195 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 15:59:01,195 - INFO - Pipeline执行结果: success=True
2025-11-14 15:59:01,196 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 15:59:01,196 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 15:59:01,196 - INFO - 开始生成多水泵方案对比
2025-11-14 15:59:01,197 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 15:59:01,197 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 15:59:01,197 - INFO - 灌溉计划生成完成
2025-11-14 16:07:02,275 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:07:02,275 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:09:09,261 - INFO - pipeline模块导入成功
2025-11-14 16:09:09,262 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:09:09,262 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,262 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:09:09,262 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:09:09,262 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,262 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:09:09,263 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:09:09,263 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:09:09,263 - INFO - Pipeline实例创建成功
2025-11-14 16:09:09,263 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:09:09,263 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:09:09,263 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:09:09,263 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:09:09,263 - INFO - 检查依赖文件...
2025-11-14 16:09:09,264 - INFO - 依赖文件检查通过
2025-11-14 16:09:09,264 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:09:09,265 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:09:09,265 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:09:09,265 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:09:09,265 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:09:09,265 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:09:09,968 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:09:09,969 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:09:09,969 - INFO - 开始执行: GIS数据修复
2025-11-14 16:09:09,969 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:09:10,152 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:09:10,152 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:09:10,153 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:09:10,153 - INFO - 开始执行: 生成系统配置
2025-11-14 16:09:10,153 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:09:10,932 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:09:10,933 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:09:10,933 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:09:10,933 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:09:10,933 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json --multi-pump --summary --realtime
2025-11-14 16:09:13,640 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json

2025-11-14 16:09:13,641 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:09:13,641 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.377191
2025-11-14 16:09:13,641 - INFO - 生成的文件:
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:09:13,642 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:09:13,643 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:09:13,644 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:09:13,644 - INFO - Pipeline执行结果: success=True
2025-11-14 16:09:13,645 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:09:13,686 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:09:13,687 - INFO - 开始生成多水泵方案对比
2025-11-14 16:09:13,687 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:09:13,687 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:09:13,688 - INFO - 灌溉计划生成完成
2025-11-14 16:09:21,954 - INFO - 手动更新水位数据 - 农场: 13944136728576
2025-11-14 16:09:21,955 - INFO - 加载了 36 个田块ID映射
2025-11-14 16:09:22,319 - INFO - 从API获取到 25 个有效水位读数
2025-11-14 16:09:22,320 - INFO - 生成水位摘要: 25/25 个田块有数据
2025-11-14 16:09:27,862 - INFO - 开始获取田块 S3-G2-F1 的水位历史，时间窗口: 24小时
2025-11-14 16:09:27,863 - INFO - 水位管理器获取成功，field_histories数量: 25
2025-11-14 16:09:27,863 - WARNING - 田块 S3-G2-F1 没有历史数据，尝试初始化...
2025-11-14 16:09:27,863 - INFO - 为田块 S3-G2-F1 创建了 24 条模拟历史数据
2025-11-14 16:09:27,863 - INFO - 田块 S3-G2-F1 水位历史获取成功: 24 条记录
2025-11-14 16:10:38,345 - INFO - 开始初始化系统组件...
2025-11-14 16:10:38,346 - INFO - 数据库初始化完成
2025-11-14 16:10:38,346 - INFO - 日志系统初始化完成
2025-11-14 16:10:38,347 - INFO - 执行状态管理器初始化完成
2025-11-14 16:10:38,347 - INFO - 加载了 36 个田块ID映射
2025-11-14 16:10:38,347 - INFO - 水位管理器初始化完成
2025-11-14 16:10:38,348 - INFO - 配置文件加载成功: config.json
2025-11-14 16:10:38,348 - INFO - 计划模板加载成功: irrigation_plan_template.json
2025-11-14 16:10:38,348 - INFO - 计划重新生成器初始化完成
2025-11-14 16:10:38,349 - INFO - 配置文件加载成功: config.json
2025-11-14 16:10:38,349 - INFO - 批次执行调度器初始化完成
2025-11-14 16:10:38,349 - INFO - 所有系统组件初始化成功
2025-11-14 16:10:53,555 - INFO - 生成水位摘要: 26/26 个田块有数据
2025-11-14 16:11:06,990 - INFO - 生成水位摘要: 26/26 个田块有数据
2025-11-14 16:11:13,347 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 16:11:13,349 - ERROR - 获取水位目标值失败: No module named 'farm_irr_full_device_modified'
2025-11-14 16:12:00,049 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:12:00,049 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:14:06,322 - INFO - pipeline模块导入成功
2025-11-14 16:14:06,323 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:14:06,323 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,323 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:14:06,323 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:14:06,323 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,323 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:14:06,323 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:14:06,324 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:14:06,324 - INFO - Pipeline实例创建成功
2025-11-14 16:14:06,324 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:14:06,324 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:14:06,324 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:14:06,324 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:14:06,324 - INFO - 检查依赖文件...
2025-11-14 16:14:06,325 - INFO - 依赖文件检查通过
2025-11-14 16:14:06,325 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:14:06,326 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:14:06,326 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:14:06,326 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:14:06,326 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:14:06,326 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:14:07,039 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:14:07,040 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:14:07,040 - INFO - 开始执行: GIS数据修复
2025-11-14 16:14:07,040 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:14:07,210 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:14:07,210 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:14:07,210 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:14:07,211 - INFO - 开始执行: 生成系统配置
2025-11-14 16:14:07,211 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:14:07,991 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:14:07,991 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:14:07,992 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:14:07,992 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:14:07,992 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json --multi-pump --summary --realtime
2025-11-14 16:14:10,403 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json

2025-11-14 16:14:10,403 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:14:10,404 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.080503
2025-11-14 16:14:10,404 - INFO - 生成的文件:
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:14:10,404 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:14:10,405 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:14:10,406 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:14:10,406 - INFO - Pipeline执行结果: success=True
2025-11-14 16:14:10,407 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:14:10,448 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:14:10,448 - INFO - 开始生成多水泵方案对比
2025-11-14 16:14:10,449 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:14:10,449 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:14:10,449 - INFO - 灌溉计划生成完成
2025-11-14 16:14:14,163 - INFO - 手动重新生成批次 1
2025-11-14 16:14:14,163 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 16:14:14,163 - WARNING - output目录中没有找到计划文件，尝试加载根目录的plan.json
2025-11-14 16:14:14,164 - ERROR - 计划文件不存在: plan.json
2025-11-14 16:15:04,031 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:15:04,031 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:16:31,388 - INFO - pipeline模块导入成功
2025-11-14 16:16:31,388 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:16:31,388 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,388 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:16:31,388 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:16:31,389 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,389 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:16:31,389 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:16:31,389 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:16:31,389 - INFO - Pipeline实例创建成功
2025-11-14 16:16:31,389 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:16:31,390 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:16:31,390 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:16:31,390 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:16:31,390 - INFO - 检查依赖文件...
2025-11-14 16:16:31,390 - INFO - 依赖文件检查通过
2025-11-14 16:16:31,390 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:16:31,391 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:16:31,391 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:16:31,392 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:16:31,392 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:16:31,392 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:16:32,111 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:16:32,111 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:16:32,111 - INFO - 开始执行: GIS数据修复
2025-11-14 16:16:32,111 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:16:32,291 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:16:32,292 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:16:32,292 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:16:32,293 - INFO - 开始执行: 生成系统配置
2025-11-14 16:16:32,293 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:16:33,102 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:16:33,102 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:16:33,103 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:16:33,103 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:16:33,103 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json --multi-pump --summary --realtime
2025-11-14 16:16:35,380 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json

2025-11-14 16:16:35,381 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:16:35,381 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.991320
2025-11-14 16:16:35,381 - INFO - 生成的文件:
2025-11-14 16:16:35,381 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:16:35,381 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:16:35,382 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:16:35,383 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:16:35,384 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:16:35,384 - INFO - Pipeline执行结果: success=True
2025-11-14 16:16:35,385 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:16:35,386 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:16:35,386 - INFO - 开始生成多水泵方案对比
2025-11-14 16:16:35,387 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:16:35,387 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:16:35,387 - INFO - 灌溉计划生成完成
2025-11-14 16:16:38,160 - INFO - 手动重新生成批次 1
2025-11-14 16:16:38,161 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 16:16:38,161 - WARNING - output目录中没有找到计划文件，尝试加载根目录的plan.json
2025-11-14 16:16:38,161 - ERROR - 计划文件不存在: plan.json
2025-11-14 16:18:11,770 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:18:11,770 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:21:23,783 - INFO - pipeline模块导入成功
2025-11-14 16:21:23,784 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:21:23,784 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,784 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:21:23,784 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:21:23,784 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,784 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:21:23,785 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:21:23,785 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:21:23,785 - INFO - Pipeline实例创建成功
2025-11-14 16:21:23,785 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:21:23,785 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:21:23,785 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:21:23,785 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:21:23,785 - INFO - 检查依赖文件...
2025-11-14 16:21:23,786 - INFO - 依赖文件检查通过
2025-11-14 16:21:23,786 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:21:23,787 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:21:23,787 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:21:23,787 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:21:23,787 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:21:23,788 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:21:24,540 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:21:24,541 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:21:24,541 - INFO - 开始执行: GIS数据修复
2025-11-14 16:21:24,541 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:21:24,714 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:21:24,715 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:21:24,715 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:21:24,716 - INFO - 开始执行: 生成系统配置
2025-11-14 16:21:24,716 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:21:25,486 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:21:25,486 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:21:25,487 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:21:25,487 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:21:25,487 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json --multi-pump --summary --realtime
2025-11-14 16:21:27,603 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json

2025-11-14 16:21:27,604 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:21:27,604 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.819358
2025-11-14 16:21:27,605 - INFO - 生成的文件:
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:21:27,605 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:21:27,606 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:21:27,607 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:21:27,607 - INFO - Pipeline执行结果: success=True
2025-11-14 16:21:27,608 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:21:27,610 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:21:27,610 - INFO - 开始生成多水泵方案对比
2025-11-14 16:21:27,610 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:21:27,610 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:21:27,610 - INFO - 灌溉计划生成完成
2025-11-14 16:21:32,167 - INFO - 开始灌溉计划优化 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_162125.json
2025-11-14 16:21:32,168 - INFO - 优化目标: ['cost_minimization', 'time_minimization', 'balanced', 'off_peak']
2025-11-14 16:21:32,172 - INFO - 计算得到低谷时段: [(0.0, 8.0), (22.0, 24.0)]
2025-11-14 16:21:32,172 - INFO - 保存缓存: f3c94434cb8fa3f660a176ee6dde84cf
2025-11-14 16:21:32,172 - INFO - 成功生成 4 个优化方案
2025-11-14 16:22:50,863 - INFO - pipeline模块导入成功
2025-11-14 16:22:50,863 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:22:50,863 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,863 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:22:50,863 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:22:50,863 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,864 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:22:50,864 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:22:50,864 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:22:50,864 - INFO - Pipeline实例创建成功
2025-11-14 16:22:50,864 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:22:50,864 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:22:50,864 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:22:50,864 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:22:50,865 - INFO - 检查依赖文件...
2025-11-14 16:22:50,865 - INFO - 依赖文件检查通过
2025-11-14 16:22:50,865 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:22:50,866 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:22:50,866 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:22:50,866 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:22:50,866 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:22:50,866 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:22:51,587 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:22:51,587 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:22:51,587 - INFO - 开始执行: GIS数据修复
2025-11-14 16:22:51,587 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:22:51,753 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:22:51,754 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:22:51,754 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:22:51,755 - INFO - 开始执行: 生成系统配置
2025-11-14 16:22:51,755 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:22:52,549 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:22:52,549 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:22:52,549 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:22:52,550 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:22:52,550 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json --multi-pump --summary --realtime
2025-11-14 16:22:54,714 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json

2025-11-14 16:22:54,714 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:22:54,714 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.849847
2025-11-14 16:22:54,715 - INFO - 生成的文件:
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:22:54,715 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:22:54,716 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:22:54,717 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:22:54,718 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:22:54,718 - INFO - Pipeline执行结果: success=True
2025-11-14 16:22:54,719 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:22:54,720 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:22:54,721 - INFO - 开始生成多水泵方案对比
2025-11-14 16:22:54,757 - INFO - 多水泵方案生成成功，共 0 个方案（触发阈值: 1个田块）
2025-11-14 16:22:54,757 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:22:54,758 - INFO - 灌溉计划生成完成
2025-11-14 16:25:34,090 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 16:25:34,090 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 16:26:47,025 - INFO - pipeline模块导入成功
2025-11-14 16:26:47,026 - INFO - 步骤4: 设置默认参数...
2025-11-14 16:26:47,026 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,026 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 16:26:47,026 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 16:26:47,026 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,026 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 16:26:47,026 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 16:26:47,027 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 16:26:47,027 - INFO - Pipeline实例创建成功
2025-11-14 16:26:47,027 - INFO - 步骤8: 运行Pipeline...
2025-11-14 16:26:47,027 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 16:26:47,027 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:26:47,027 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 16:26:47,027 - INFO - 检查依赖文件...
2025-11-14 16:26:47,028 - INFO - 依赖文件检查通过
2025-11-14 16:26:47,028 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 16:26:47,029 - INFO - 找到 6 个GIS数据文件
2025-11-14 16:26:47,029 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 16:26:47,029 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 16:26:47,029 - INFO - 开始执行: GIS数据格式转换
2025-11-14 16:26:47,029 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 16:26:47,767 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 16:26:47,767 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 16:26:47,767 - INFO - 开始执行: GIS数据修复
2025-11-14 16:26:47,767 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 16:26:47,946 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 16:26:47,947 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 16:26:47,947 - INFO - === 步骤2: 配置生成 ===
2025-11-14 16:26:47,948 - INFO - 开始执行: 生成系统配置
2025-11-14 16:26:47,948 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 16:26:48,731 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 16:26:48,731 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 16:26:48,731 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 16:26:48,732 - INFO - 开始执行: 生成灌溉计划
2025-11-14 16:26:48,732 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json --multi-pump --summary --realtime
2025-11-14 16:26:51,031 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行54.08h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.78元 - 运行27.04h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.78元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json

2025-11-14 16:26:51,031 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 16:26:51,031 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.004537
2025-11-14 16:26:51,032 - INFO - 生成的文件:
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 16:26:51,032 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 16:26:51,033 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 16:26:51,034 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 16:26:51,035 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 16:26:51,035 - INFO - Pipeline执行结果: success=True
2025-11-14 16:26:51,036 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 16:26:51,038 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 16:26:51,038 - INFO - 开始生成多水泵方案对比
2025-11-14 16:26:52,443 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 16:26:52,443 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 16:26:52,443 - INFO - 灌溉计划生成完成
2025-11-14 20:40:39,170 - INFO - pipeline模块导入成功
2025-11-14 20:40:39,170 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:40:39,170 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,170 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:40:39,170 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:40:39,171 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,171 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:40:39,171 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:40:39,171 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:40:39,171 - INFO - Pipeline实例创建成功
2025-11-14 20:40:39,171 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:40:39,172 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:40:39,172 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:40:39,172 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:40:39,172 - INFO - 检查依赖文件...
2025-11-14 20:40:39,172 - INFO - 依赖文件检查通过
2025-11-14 20:40:39,172 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:40:39,173 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:40:39,173 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:40:39,173 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:40:39,174 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:40:39,174 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:40:39,863 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:40:39,863 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:40:39,864 - INFO - 开始执行: GIS数据修复
2025-11-14 20:40:39,864 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:40:40,034 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:40:40,035 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:40:40,035 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:40:40,036 - INFO - 开始执行: 生成系统配置
2025-11-14 20:40:40,036 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:40:40,788 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:40:40,789 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:40:40,789 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:40:40,789 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:40:40,789 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json --multi-pump --summary --realtime
2025-11-14 20:40:43,060 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json

2025-11-14 20:40:43,061 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:40:43,061 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.890163
2025-11-14 20:40:43,062 - INFO - 生成的文件:
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:40:43,062 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:40:43,063 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:40:43,064 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:40:43,065 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:40:43,065 - INFO - Pipeline执行结果: success=True
2025-11-14 20:40:43,066 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:40:43,067 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:40:43,068 - INFO - 开始生成多水泵方案对比
2025-11-14 20:40:44,641 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:40:44,641 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:40:44,641 - INFO - 灌溉计划生成完成
2025-11-14 20:42:05,489 - INFO - 手动重新生成批次 1
2025-11-14 20:42:05,490 - INFO - 配置文件加载成功: config.json
2025-11-14 20:42:05,490 - INFO - 配置文件加载成功: config.json
2025-11-14 20:42:05,491 - INFO - 计划模板加载成功: irrigation_plan_template.json
2025-11-14 20:42:05,491 - INFO - 当前没有执行计划，尝试加载默认计划文件
2025-11-14 20:42:05,492 - INFO - 找到计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:42:05,494 - INFO - 使用scenarios格式，选择第一个scenario: 全部水泵(P1+P2)组合使用
2025-11-14 20:42:05,494 - INFO - 批次 1: 开始时间 0.00h, 持续时间 19.98h
2025-11-14 20:42:05,494 - INFO - 批次 2: 开始时间 19.98h, 持续时间 7.06h
2025-11-14 20:42:05,494 - INFO - 灌溉计划加载成功: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:42:05,494 - INFO - 共有 2 个批次
2025-11-14 20:42:05,494 - INFO - 当前计划包含 3 个scenarios，使用第一个scenario: '全部水泵(P1+P2)组合使用'
2025-11-14 20:42:05,494 - INFO - 开始重新生成批次 1 的计划
2025-11-14 20:42:05,504 - INFO - 批次 1 计划重新生成完成，共 2 项变更
2025-11-14 20:42:05,504 - ERROR - 更新批次 1 计划失败: ExecutionStatusManager.update_execution_status() got an unexpected keyword argument 'batch_id'
2025-11-14 20:42:05,505 - INFO - 原始计划包含 3 个scenarios
2025-11-14 20:42:05,506 - INFO - 已更新scenario: 全部水泵(P1+P2)组合使用
2025-11-14 20:42:05,506 - INFO - 保留原始scenario: P2单独使用
2025-11-14 20:42:05,506 - INFO - 保留原始scenario: P1单独使用
2025-11-14 20:42:05,506 - INFO - 最终保存的计划包含 3 个scenarios
2025-11-14 20:42:05,512 - INFO - 修改后的计划已保存到: e:\irrigation_schedule\farm_irrigation\src\api\output\irrigation_plan_manual_regen_1763124125.json
2025-11-14 20:42:05,512 - INFO - 使用自定义水位标准：1 个田块
2025-11-14 20:42:10,727 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:42:10,727 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 20:49:38,968 - INFO - pipeline模块导入成功
2025-11-14 20:49:38,968 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:49:38,968 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,968 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:49:38,968 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:49:38,968 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,968 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:49:38,969 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:49:38,969 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:49:38,969 - INFO - Pipeline实例创建成功
2025-11-14 20:49:38,969 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:49:38,969 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:49:38,969 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:49:38,969 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:49:38,970 - INFO - 检查依赖文件...
2025-11-14 20:49:38,970 - INFO - 依赖文件检查通过
2025-11-14 20:49:38,970 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:49:38,971 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:49:38,971 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:49:38,971 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:49:38,971 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:49:38,972 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:49:39,688 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:49:39,689 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:49:39,689 - INFO - 开始执行: GIS数据修复
2025-11-14 20:49:39,689 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:49:39,857 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:49:39,858 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:49:39,858 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:49:39,858 - INFO - 开始执行: 生成系统配置
2025-11-14 20:49:39,859 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:49:40,610 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:49:40,610 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:49:40,610 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:49:40,611 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:49:40,611 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json --multi-pump --summary --realtime
2025-11-14 20:49:42,832 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json

2025-11-14 20:49:42,832 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:49:42,832 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.862471
2025-11-14 20:49:42,833 - INFO - 生成的文件:
2025-11-14 20:49:42,833 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:49:42,834 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:49:42,835 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:49:42,836 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:49:42,837 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:49:42,837 - INFO - Pipeline执行结果: success=True
2025-11-14 20:49:42,838 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:42,840 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:49:42,840 - INFO - 开始生成多水泵方案对比
2025-11-14 20:49:44,230 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:49:44,230 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:49:44,230 - INFO - 灌溉计划生成完成
2025-11-14 20:49:56,241 - INFO - 开始批次顺序调整 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_204940.json
2025-11-14 20:49:56,241 - INFO - 新顺序: None
2025-11-14 20:49:56,254 - INFO - 成功加载计划: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:49:56,256 - INFO - 成功重新排序批次: [2, 1, 3]
2025-11-14 20:49:56,256 - INFO - 已调整scenario 'P1单独使用' 的批次顺序
2025-11-14 20:49:56,257 - INFO - 成功重新排序批次: [3, 1, 2]
2025-11-14 20:49:56,257 - INFO - 已调整scenario 'P2单独使用' 的批次顺序
2025-11-14 20:49:56,257 - INFO - 成功重新排序批次: [2, 1]
2025-11-14 20:49:56,257 - INFO - 已调整scenario '全部水泵(P1+P2)组合使用' 的批次顺序
2025-11-14 20:49:56,262 - INFO - 重新排序后的计划已保存: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 20:49:56,263 - INFO - 批次顺序调整完成 - 成功调整3个scenario的批次顺序
2025-11-14 20:50:14,749 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:50:14,749 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 20:54:12,536 - INFO - pipeline模块导入成功
2025-11-14 20:54:12,536 - INFO - 步骤4: 设置默认参数...
2025-11-14 20:54:12,536 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,536 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 20:54:12,536 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 20:54:12,536 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,537 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 20:54:12,537 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 20:54:12,537 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 20:54:12,537 - INFO - Pipeline实例创建成功
2025-11-14 20:54:12,537 - INFO - 步骤8: 运行Pipeline...
2025-11-14 20:54:12,537 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 20:54:12,537 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:54:12,537 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 20:54:12,537 - INFO - 检查依赖文件...
2025-11-14 20:54:12,538 - INFO - 依赖文件检查通过
2025-11-14 20:54:12,538 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 20:54:12,539 - INFO - 找到 6 个GIS数据文件
2025-11-14 20:54:12,539 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 20:54:12,539 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 20:54:12,539 - INFO - 开始执行: GIS数据格式转换
2025-11-14 20:54:12,539 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 20:54:13,222 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 20:54:13,223 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 20:54:13,223 - INFO - 开始执行: GIS数据修复
2025-11-14 20:54:13,223 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 20:54:13,390 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 20:54:13,390 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 20:54:13,390 - INFO - === 步骤2: 配置生成 ===
2025-11-14 20:54:13,391 - INFO - 开始执行: 生成系统配置
2025-11-14 20:54:13,391 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 20:54:14,172 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 20:54:14,173 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 20:54:14,173 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 20:54:14,173 - INFO - 开始执行: 生成灌溉计划
2025-11-14 20:54:14,173 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json --multi-pump --summary --realtime
2025-11-14 20:54:16,468 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行27.04h
方案 2: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
方案 3: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1946.69元 - 运行54.07h
推荐方案: 水泵['P1', 'P2'] (电费: 1946.69元, 运行时间: 27.04h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json

2025-11-14 20:54:16,469 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 20:54:16,469 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.931620
2025-11-14 20:54:16,470 - INFO - 生成的文件:
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 20:54:16,470 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 20:54:16,471 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:16,472 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 20:54:16,473 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 20:54:16,473 - INFO - Pipeline执行结果: success=True
2025-11-14 20:54:16,475 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:16,476 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 20:54:16,476 - INFO - 开始生成多水泵方案对比
2025-11-14 20:54:18,240 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 20:54:18,241 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 20:54:18,241 - INFO - 灌溉计划生成完成
2025-11-14 20:54:21,404 - INFO - 开始批次顺序调整 - plan_id: e:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251114_205414.json
2025-11-14 20:54:21,405 - INFO - 新顺序: None
2025-11-14 20:54:21,407 - INFO - 成功加载计划: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [2, 1, 3]
2025-11-14 20:54:21,409 - INFO - 已调整scenario 'P1单独使用' 的批次顺序
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [3, 1, 2]
2025-11-14 20:54:21,409 - INFO - 已调整scenario 'P2单独使用' 的批次顺序
2025-11-14 20:54:21,409 - INFO - 成功重新排序批次: [2, 1]
2025-11-14 20:54:21,410 - INFO - 已调整scenario '全部水泵(P1+P2)组合使用' 的批次顺序
2025-11-14 20:54:21,415 - INFO - 重新排序后的计划已保存: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-14 20:54:21,415 - INFO - 批次顺序调整完成 - 成功调整3个scenario的批次顺序
2025-11-14 20:54:27,309 - INFO - 手动更新水位数据 - 农场: 13944136728576
2025-11-14 20:54:27,310 - INFO - 加载了 36 个田块ID映射
2025-11-14 20:54:27,311 - INFO - 从缓存加载了 29 个田块的水位历史
2025-11-14 20:54:27,713 - INFO - 从API获取到 23 个有效水位读数
2025-11-14 20:54:27,717 - INFO - 生成水位摘要: 29/29 个田块有数据
2025-11-14 20:54:30,939 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 20:54:30,940 - INFO - 成功获取 36 个田块的水位目标值
2025-11-14 20:55:04,801 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 20:55:04,801 - INFO - 智能灌溉动态执行系统已关闭
2025-11-14 22:03:57,744 - INFO - pipeline模块导入成功
2025-11-14 22:03:57,744 - INFO - 步骤4: 设置默认参数...
2025-11-14 22:03:57,744 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,744 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-14 22:03:57,744 - INFO - 步骤5: 确保输出目录存在...
2025-11-14 22:03:57,745 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,745 - INFO - 步骤6: 构建pipeline参数...
2025-11-14 22:03:57,745 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-14 22:03:57,745 - INFO - 步骤7: 创建Pipeline实例...
2025-11-14 22:03:57,745 - INFO - Pipeline实例创建成功
2025-11-14 22:03:57,745 - INFO - 步骤8: 运行Pipeline...
2025-11-14 22:03:57,746 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-14 22:03:57,746 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 22:03:57,746 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-14 22:03:57,746 - INFO - 检查依赖文件...
2025-11-14 22:03:57,746 - INFO - 依赖文件检查通过
2025-11-14 22:03:57,746 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-14 22:03:57,747 - INFO - 找到 6 个GIS数据文件
2025-11-14 22:03:57,747 - INFO - === 步骤1: 数据预处理 ===
2025-11-14 22:03:57,748 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-14 22:03:57,748 - INFO - 开始执行: GIS数据格式转换
2025-11-14 22:03:57,748 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-14 22:03:58,493 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-14 22:03:58,494 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-14 22:03:58,494 - INFO - 开始执行: GIS数据修复
2025-11-14 22:03:58,494 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-14 22:03:58,658 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-14 22:03:58,659 - INFO - [OK] GIS数据修复 执行成功
2025-11-14 22:03:58,659 - INFO - === 步骤2: 配置生成 ===
2025-11-14 22:03:58,659 - INFO - 开始执行: 生成系统配置
2025-11-14 22:03:58,660 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-14 22:03:59,390 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-14 22:03:59,391 - INFO - [OK] 生成系统配置 执行成功
2025-11-14 22:03:59,391 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-14 22:03:59,391 - INFO - 开始执行: 生成灌溉计划
2025-11-14 22:03:59,391 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json --multi-pump --summary --realtime
2025-11-14 22:04:01,666 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行54.17h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行54.17h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1949.97元 - 运行27.08h
推荐方案: 水泵['P1', 'P2'] (电费: 1949.97元, 运行时间: 27.08h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json

2025-11-14 22:04:01,667 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-14 22:04:01,667 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.922869
2025-11-14 22:04:01,668 - INFO - 生成的文件:
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-14 22:04:01,668 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-14 22:04:01,669 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-14 22:04:01,670 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-14 22:04:01,671 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-14 22:04:01,671 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-14 22:04:01,671 - INFO - Pipeline执行结果: success=True
2025-11-14 22:04:01,672 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-14 22:04:01,673 - INFO - 成功读取计划数据，包含 3 项
2025-11-14 22:04:01,674 - INFO - 开始生成多水泵方案对比
2025-11-14 22:04:03,293 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-14 22:04:03,293 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-14 22:04:03,293 - INFO - 灌溉计划生成完成
2025-11-14 22:04:16,065 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-14 22:04:16,066 - INFO - 成功获取 36 个田块的水位目标值
2025-11-14 22:04:27,281 - INFO - 开始查询农场 13944136728576 的所有田块设备状态
2025-11-14 22:04:27,281 - INFO - 使用 app_id: YJY... (已隐藏)
2025-11-14 22:04:36,015 - INFO - ✅ 成功查询农场 13944136728576 的设备状态，共 42 个田块
2025-11-14 22:05:16,254 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-14 22:05:16,254 - INFO - 智能灌溉动态执行系统已关闭
2025-11-16 00:25:13,633 - INFO - pipeline模块导入成功
2025-11-16 00:25:13,634 - INFO - 步骤4: 设置默认参数...
2025-11-16 00:25:13,635 - INFO - output_dir: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,635 - INFO - config_path: e:\irrigation_schedule\farm_irrigation\config.json
2025-11-16 00:25:13,635 - INFO - 步骤5: 确保输出目录存在...
2025-11-16 00:25:13,636 - INFO - 输出目录已创建/确认: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,636 - INFO - 步骤6: 构建pipeline参数...
2025-11-16 00:25:13,639 - INFO - Pipeline参数: {'input_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'e:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'e:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-16 00:25:13,640 - INFO - 步骤7: 创建Pipeline实例...
2025-11-16 00:25:13,640 - INFO - Pipeline实例创建成功
2025-11-16 00:25:13,641 - INFO - 步骤8: 运行Pipeline...
2025-11-16 00:25:13,641 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-16 00:25:13,641 - INFO - 输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-16 00:25:13,641 - INFO - 输出目录: e:\irrigation_schedule\farm_irrigation\data\output
2025-11-16 00:25:13,642 - INFO - 检查依赖文件...
2025-11-16 00:25:13,643 - INFO - 依赖文件检查通过
2025-11-16 00:25:13,643 - INFO - 检查输入目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-16 00:25:13,644 - INFO - 找到 6 个GIS数据文件
2025-11-16 00:25:13,644 - INFO - === 步骤1: 数据预处理 ===
2025-11-16 00:25:13,645 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-16 00:25:13,645 - INFO - 开始执行: GIS数据格式转换
2025-11-16 00:25:13,645 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-16 00:25:14,717 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-16 00:25:14,717 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-16 00:25:14,717 - INFO - 开始执行: GIS数据修复
2025-11-16 00:25:14,717 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-16 00:25:14,902 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: e:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-16 00:25:14,903 - INFO - [OK] GIS数据修复 执行成功
2025-11-16 00:25:14,904 - INFO - === 步骤2: 配置生成 ===
2025-11-16 00:25:14,904 - INFO - 开始执行: 生成系统配置
2025-11-16 00:25:14,905 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields e:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-16 00:25:15,765 - WARNING - 警告: e:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:124: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-16 00:25:15,765 - INFO - [OK] 生成系统配置 执行成功
2025-11-16 00:25:15,765 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-16 00:25:15,765 - INFO - 开始执行: 生成灌溉计划
2025-11-16 00:25:15,766 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json --multi-pump --summary --realtime
2025-11-16 00:25:17,984 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=17, 无水位数据=19, 低于阈值=17
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 17
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行25.40h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行25.40h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费914.41元 - 运行12.70h
推荐方案: 水泵['P1', 'P2'] (电费: 914.41元, 运行时间: 12.70h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json

2025-11-16 00:25:17,984 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-16 00:25:17,985 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:04.345319
2025-11-16 00:25:17,985 - INFO - 生成的文件:
2025-11-16 00:25:17,985 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-16 00:25:17,985 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-16 00:25:17,986 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-16 00:25:17,987 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-16 00:25:17,988 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-16 00:25:17,989 - INFO -   - e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-16 00:25:17,989 - INFO - Pipeline执行结果: success=True
2025-11-16 00:25:17,991 - INFO - 读取计划文件: e:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-16 00:25:17,992 - INFO - 成功读取计划数据，包含 3 项
2025-11-16 00:25:17,992 - INFO - 开始生成多水泵方案对比
2025-11-16 00:25:19,358 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-16 00:25:19,358 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-16 00:25:19,358 - INFO - 灌溉计划生成完成
2025-11-20 12:27:59,662 - INFO - pipeline模块导入成功
2025-11-20 12:27:59,662 - INFO - 步骤4: 设置默认参数...
2025-11-20 12:27:59,663 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,663 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config_rice_20251120_122759.json
2025-11-20 12:27:59,663 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 12:27:59,663 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,663 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 12:27:59,663 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config_rice_20251120_122759.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 12:27:59,664 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 12:27:59,664 - INFO - Pipeline实例创建成功
2025-11-20 12:27:59,664 - INFO - 步骤8: 运行Pipeline...
2025-11-20 12:27:59,664 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 12:27:59,664 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 12:27:59,664 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 12:27:59,664 - INFO - 检查依赖文件...
2025-11-20 12:27:59,664 - INFO - 依赖文件检查通过
2025-11-20 12:27:59,665 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 12:27:59,665 - INFO - 找到 6 个GIS数据文件
2025-11-20 12:27:59,666 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 12:27:59,666 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 12:27:59,666 - INFO - 开始执行: GIS数据格式转换
2025-11-20 12:27:59,666 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 12:28:00,664 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 12:28:00,665 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 12:28:00,665 - INFO - 开始执行: GIS数据修复
2025-11-20 12:28:00,665 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 12:28:00,845 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 12:28:00,846 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 12:28:00,846 - INFO - === 步骤2: 配置生成 ===
2025-11-20 12:28:00,847 - INFO - 开始执行: 生成系统配置
2025-11-20 12:28:00,847 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 12:28:01,641 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 12:28:01,641 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 12:28:01,641 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 12:28:01,642 - INFO - 开始执行: 生成灌溉计划
2025-11-20 12:28:01,642 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json --summary --realtime
2025-11-20 12:28:02,412 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.95 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.88h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json

2025-11-20 12:28:02,413 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 12:28:02,413 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.748388
2025-11-20 12:28:02,413 - INFO - 生成的文件:
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 12:28:02,414 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 12:28:02,415 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 12:28:02,416 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 12:28:02,417 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 12:28:02,418 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 12:28:02,419 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 12:28:02,419 - INFO - Pipeline执行结果: success=True
2025-11-20 12:28:02,420 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 12:28:02,421 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 12:28:02,421 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 12:28:02,421 - INFO - 灌溉计划生成完成
2025-11-20 12:28:02,422 - INFO - ✓ 临时配置已清理
2025-11-20 12:35:51,920 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 12:35:51,921 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 12:46:33,794 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 12:46:33,795 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:14:17,933 - INFO - pipeline模块导入成功
2025-11-20 13:14:17,934 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:14:17,934 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,934 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:14:17,934 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:14:17,934 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,935 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:14:17,935 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:14:17,935 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:14:17,935 - INFO - Pipeline实例创建成功
2025-11-20 13:14:17,935 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:14:17,936 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:14:17,936 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:14:17,936 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:14:17,936 - INFO - 检查依赖文件...
2025-11-20 13:14:17,936 - INFO - 依赖文件检查通过
2025-11-20 13:14:17,936 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:14:17,937 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:14:17,937 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:14:17,938 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:14:17,938 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:14:17,938 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:14:18,640 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:14:18,640 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:14:18,640 - INFO - 开始执行: GIS数据修复
2025-11-20 13:14:18,641 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:14:18,813 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:14:18,814 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:14:18,815 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:14:18,815 - INFO - 开始执行: 生成系统配置
2025-11-20 13:14:18,815 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:14:19,580 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:14:19,580 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:14:19,580 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:14:19,580 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:14:19,581 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json --summary --realtime
2025-11-20 13:14:20,330 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json

2025-11-20 13:14:20,330 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:14:20,331 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.396489
2025-11-20 13:14:20,331 - INFO - 生成的文件:
2025-11-20 13:14:20,331 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:14:20,332 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:14:20,333 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:14:20,334 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:14:20,335 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:14:20,336 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:14:20,337 - INFO - Pipeline执行结果: success=True
2025-11-20 13:14:20,338 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:14:20,339 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:14:20,339 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:14:20,339 - INFO - 灌溉计划生成完成
2025-11-20 13:14:28,894 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:14:28,895 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:14:48,274 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:14:48,275 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:17:04,816 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:17:04,816 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:19:34,863 - INFO - pipeline模块导入成功
2025-11-20 13:19:34,864 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:19:34,864 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,864 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:19:34,864 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:19:34,864 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,864 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:19:34,865 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:19:34,865 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:19:34,865 - INFO - Pipeline实例创建成功
2025-11-20 13:19:34,865 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:19:34,865 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:19:34,865 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:19:34,866 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:19:34,866 - INFO - 检查依赖文件...
2025-11-20 13:19:34,866 - INFO - 依赖文件检查通过
2025-11-20 13:19:34,866 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:19:34,867 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:19:34,867 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:19:34,868 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:19:34,868 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:19:34,868 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:19:35,595 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:19:35,596 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:19:35,596 - INFO - 开始执行: GIS数据修复
2025-11-20 13:19:35,596 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:19:35,762 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:19:35,763 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:19:35,763 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:19:35,764 - INFO - 开始执行: 生成系统配置
2025-11-20 13:19:35,764 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:19:36,607 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:19:36,608 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:19:36,608 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:19:36,608 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:19:36,608 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json --summary --realtime
2025-11-20 13:19:37,373 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json

2025-11-20 13:19:37,373 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:19:37,373 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.508176
2025-11-20 13:19:37,374 - INFO - 生成的文件:
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:19:37,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:19:37,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:19:37,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:19:37,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:19:37,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:19:37,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:19:37,379 - INFO - Pipeline执行结果: success=True
2025-11-20 13:19:37,381 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:19:37,381 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:19:37,381 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:19:37,382 - INFO - 灌溉计划生成完成
2025-11-20 13:22:15,162 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:22:15,163 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:22:46,272 - INFO - pipeline模块导入成功
2025-11-20 13:22:46,272 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:22:46,272 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,272 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:22:46,272 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:22:46,273 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,273 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:22:46,273 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:22:46,273 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:22:46,273 - INFO - Pipeline实例创建成功
2025-11-20 13:22:46,273 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:22:46,273 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:22:46,274 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:22:46,274 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:22:46,274 - INFO - 检查依赖文件...
2025-11-20 13:22:46,274 - INFO - 依赖文件检查通过
2025-11-20 13:22:46,274 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:22:46,275 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:22:46,275 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:22:46,275 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:22:46,276 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:22:46,276 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:22:46,979 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:22:46,979 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:22:46,980 - INFO - 开始执行: GIS数据修复
2025-11-20 13:22:46,980 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:22:47,156 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:22:47,157 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:22:47,157 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:22:47,158 - INFO - 开始执行: 生成系统配置
2025-11-20 13:22:47,158 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:22:47,965 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:22:47,965 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:22:47,966 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:22:47,966 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:22:47,966 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json --summary --realtime
2025-11-20 13:22:48,734 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json

2025-11-20 13:22:48,734 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:22:48,735 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.461523
2025-11-20 13:22:48,735 - INFO - 生成的文件:
2025-11-20 13:22:48,735 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:22:48,735 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:22:48,736 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:22:48,737 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:22:48,738 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:22:48,739 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:22:48,740 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:22:48,741 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:22:48,741 - INFO - Pipeline执行结果: success=True
2025-11-20 13:22:48,744 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:22:48,744 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:22:48,745 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:22:48,745 - INFO - 灌溉计划生成完成
2025-11-20 13:26:31,739 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:26:31,739 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:27:09,095 - INFO - pipeline模块导入成功
2025-11-20 13:27:09,095 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:27:09,096 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,096 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:27:09,096 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:27:09,096 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,096 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:27:09,096 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:27:09,097 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:27:09,097 - INFO - Pipeline实例创建成功
2025-11-20 13:27:09,097 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:27:09,097 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:27:09,097 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:27:09,097 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:27:09,097 - INFO - 检查依赖文件...
2025-11-20 13:27:09,098 - INFO - 依赖文件检查通过
2025-11-20 13:27:09,098 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:27:09,099 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:27:09,099 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:27:09,100 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:27:09,100 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:27:09,100 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:27:09,792 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:27:09,792 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:27:09,793 - INFO - 开始执行: GIS数据修复
2025-11-20 13:27:09,793 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:27:09,965 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:27:09,966 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:27:09,966 - INFO - === 步骤2: 配置生成 ===
2025-11-20 13:27:09,967 - INFO - 开始执行: 生成系统配置
2025-11-20 13:27:09,967 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.auto_to_config --segments E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪水路_code.geojson --gates E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪阀门与节制闸_code.geojson --fields E:\irrigation_schedule\farm_irrigation\data\gzp_farm\港中坪田块_code.geojson
2025-11-20 13:27:10,757 - WARNING - 警告: E:\irrigation_schedule\farm_irrigation\src\converter\auto_to_config.py:127: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.
  c = gdf.unary_union.centroid

2025-11-20 13:27:10,757 - INFO - [OK] 生成系统配置 执行成功
2025-11-20 13:27:10,757 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:27:10,758 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:27:10,758 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json --summary --realtime
2025-11-20 13:27:11,506 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 26.98 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=19.90h  田块数=28
 - 批次2 ETA=7.08h  田块数=8
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json

2025-11-20 13:27:11,507 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:27:11,507 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.410217
2025-11-20 13:27:11,508 - INFO - 生成的文件:
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:27:11,508 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:27:11,509 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:27:11,510 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:27:11,511 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:27:11,512 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:27:11,513 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:27:11,514 - INFO - Pipeline执行结果: success=True
2025-11-20 13:27:11,515 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:27:11,516 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:27:11,516 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:27:11,516 - INFO - 灌溉计划生成完成
2025-11-20 13:27:11,516 - INFO - 计划生成完成，再次写入 Rice 配置...
2025-11-20 13:27:11,519 - INFO - ✓ Rice 配置已再次写入（确保不被覆盖）
2025-11-20 13:27:11,520 - INFO - ✓ 最终验证成功: config.json 包含 Rice 配置
2025-11-20 13:27:11,520 - INFO - ✓ 田块验证成功: S3-G2-F1 wl_opt=50.0
2025-11-20 13:27:56,778 - INFO - 获取水位目标值 - farm_id: 13944136728576, field_id: None
2025-11-20 13:27:56,779 - INFO - 成功获取 36 个田块的水位目标值
2025-11-20 13:29:54,280 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 13:29:54,280 - INFO - 智能灌溉动态执行系统已关闭
2025-11-20 13:58:07,685 - INFO - pipeline模块导入成功
2025-11-20 13:58:07,685 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:58:07,685 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,685 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:07,686 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:58:07,686 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,686 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:58:07,686 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-20 13:58:07,687 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:58:07,687 - INFO - Pipeline实例创建成功
2025-11-20 13:58:07,687 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:58:07,687 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:58:07,687 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:07,688 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:07,688 - INFO - 检查依赖文件...
2025-11-20 13:58:07,688 - INFO - 依赖文件检查通过
2025-11-20 13:58:07,688 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:07,689 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:58:07,689 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:07,690 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-20 13:58:07,690 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:58:07,690 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:58:07,690 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:58:07,690 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:58:08,415 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:58:08,415 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:58:08,416 - INFO - 开始执行: GIS数据修复
2025-11-20 13:58:08,416 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:58:08,595 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:58:08,596 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:58:08,596 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:58:08,596 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:58:08,596 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json --summary --realtime
2025-11-20 13:58:09,354 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 17.52 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 480.0 m3/h
灌溉批次: 1 批
 - 批次1 ETA=17.52h  田块数=36
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json

2025-11-20 13:58:09,354 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:58:09,355 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.668511
2025-11-20 13:58:09,356 - INFO - 生成的文件:
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:58:09,356 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:58:09,357 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:58:09,358 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:58:09,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:58:09,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:58:09,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:58:09,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:58:09,362 - INFO - Pipeline执行结果: success=True
2025-11-20 13:58:09,364 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:09,364 - INFO - 成功读取计划数据，包含 8 项
2025-11-20 13:58:09,364 - INFO - 灌溉计划结果已保存到缓存 - cache_key: e4ca3b1906eb19c1acd34c6d26d20a1b
2025-11-20 13:58:09,364 - INFO - 灌溉计划生成完成
2025-11-20 13:58:09,365 - INFO - 计划生成完成，再次写入 Rice 配置...
2025-11-20 13:58:09,367 - INFO - ✓ Rice 配置已再次写入（确保不被覆盖）
2025-11-20 13:58:09,368 - INFO - ✓ 最终验证成功: config.json 包含 Rice 配置
2025-11-20 13:58:09,368 - INFO - ✓ 田块验证成功: S3-G2-F1 wl_opt=50.0
2025-11-20 13:58:31,600 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-20 13:58:31,600 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-20 13:58:31,600 - INFO - 步骤1: 生成缓存键...
2025-11-20 13:58:31,600 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-20 13:58:31,600 - INFO - 步骤2: 检查缓存...
2025-11-20 13:58:31,601 - INFO - 缓存未命中，继续执行...
2025-11-20 13:58:31,601 - INFO - 步骤3: 导入pipeline模块...
2025-11-20 13:58:31,601 - INFO - pipeline模块导入成功
2025-11-20 13:58:31,601 - INFO - 步骤4: 设置默认参数...
2025-11-20 13:58:31,601 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,601 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:31,601 - INFO - 步骤5: 确保输出目录存在...
2025-11-20 13:58:31,602 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,602 - INFO - 步骤6: 构建pipeline参数...
2025-11-20 13:58:31,602 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-20 13:58:31,602 - INFO - 步骤7: 创建Pipeline实例...
2025-11-20 13:58:31,602 - INFO - Pipeline实例创建成功
2025-11-20 13:58:31,602 - INFO - 步骤8: 运行Pipeline...
2025-11-20 13:58:31,602 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-20 13:58:31,602 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:31,602 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-20 13:58:31,603 - INFO - 检查依赖文件...
2025-11-20 13:58:31,603 - INFO - 依赖文件检查通过
2025-11-20 13:58:31,603 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-20 13:58:31,604 - INFO - 找到 6 个GIS数据文件
2025-11-20 13:58:31,604 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-20 13:58:31,604 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-20 13:58:31,604 - INFO - === 步骤1: 数据预处理 ===
2025-11-20 13:58:31,605 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-20 13:58:31,605 - INFO - 开始执行: GIS数据格式转换
2025-11-20 13:58:31,605 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-20 13:58:32,302 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-20 13:58:32,302 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-20 13:58:32,302 - INFO - 开始执行: GIS数据修复
2025-11-20 13:58:32,303 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-20 13:58:32,476 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-20 13:58:32,477 - INFO - [OK] GIS数据修复 执行成功
2025-11-20 13:58:32,477 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-20 13:58:32,477 - INFO - 开始执行: 生成灌溉计划
2025-11-20 13:58:32,478 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json --multi-pump --summary --realtime
2025-11-20 13:58:34,472 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=36
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 36
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行35.04h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行35.04h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1261.51元 - 运行17.52h
推荐方案: 水泵['P1', 'P2'] (电费: 1261.51元, 运行时间: 17.52h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json

2025-11-20 13:58:34,473 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-20 13:58:34,473 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.871153
2025-11-20 13:58:34,474 - INFO - 生成的文件:
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-20 13:58:34,474 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-20 13:58:34,475 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-20 13:58:34,476 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-20 13:58:34,477 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-20 13:58:34,478 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-20 13:58:34,479 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-20 13:58:34,479 - INFO - Pipeline执行结果: success=True
2025-11-20 13:58:34,481 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-20 13:58:34,482 - INFO - 成功读取计划数据，包含 3 项
2025-11-20 13:58:34,482 - INFO - 开始生成多水泵方案对比
2025-11-20 13:58:35,809 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-20 13:58:35,809 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-20 13:58:35,809 - INFO - 灌溉计划生成完成
2025-11-20 14:03:36,342 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-20 14:03:36,342 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 11:45:34,777 - INFO - pipeline模块导入成功
2025-11-21 11:45:34,777 - INFO - 步骤4: 设置默认参数...
2025-11-21 11:45:34,777 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,777 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:45:34,778 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 11:45:34,778 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,778 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 11:45:34,778 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 11:45:34,778 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 11:45:34,778 - INFO - Pipeline实例创建成功
2025-11-21 11:45:34,779 - INFO - 步骤8: 运行Pipeline...
2025-11-21 11:45:34,779 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 11:45:34,779 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:45:34,779 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:45:34,779 - INFO - 检查依赖文件...
2025-11-21 11:45:34,780 - INFO - 依赖文件检查通过
2025-11-21 11:45:34,780 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:45:34,781 - INFO - 找到 6 个GIS数据文件
2025-11-21 11:45:34,781 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:45:34,781 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 11:45:34,781 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 11:45:34,781 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 11:45:34,782 - INFO - 开始执行: GIS数据格式转换
2025-11-21 11:45:34,782 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 11:45:35,787 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 11:45:35,787 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 11:45:35,788 - INFO - 开始执行: GIS数据修复
2025-11-21 11:45:35,788 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 11:45:35,978 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 11:45:35,979 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 11:45:35,979 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 11:45:35,979 - INFO - 开始执行: 生成灌溉计划
2025-11-21 11:45:35,979 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json --multi-pump --summary --realtime
2025-11-21 11:45:37,964 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=33
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 33
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行15.80h
推荐方案: 水泵['P1', 'P2'] (电费: 1137.31元, 运行时间: 15.80h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json

2025-11-21 11:45:37,965 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 11:45:37,965 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:03.186788
2025-11-21 11:45:37,966 - INFO - 生成的文件:
2025-11-21 11:45:37,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 11:45:37,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 11:45:37,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 11:45:37,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 11:45:37,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 11:45:37,970 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 11:45:37,971 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 11:45:37,972 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 11:45:37,973 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 11:45:37,973 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 11:45:37,973 - INFO - Pipeline执行结果: success=True
2025-11-21 11:45:37,975 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:45:37,976 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 11:45:37,976 - INFO - 开始生成多水泵方案对比
2025-11-21 11:45:39,129 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 11:45:39,129 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:45:39,129 - INFO - 灌溉计划生成完成
2025-11-21 11:47:05,067 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114535.json
2025-11-21 11:47:05,071 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:47:05,071 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:47:05,071 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:47:05,071 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:47:05,072 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:47:05,072 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:47:05,072 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:47:05,072 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:47:05,072 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:47:05,072 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:47:05,073 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:47:05,073 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:47:05,073 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:47:05,073 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:47:05,078 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 11:47:05,078 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 47b54063cf7830cc8eae54699e3c891a
2025-11-21 11:47:05,079 - INFO - 批次重新生成完成
2025-11-21 11:49:03,165 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114535.json
2025-11-21 11:49:03,169 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:03,169 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:03,169 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:49:03,170 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:49:03,170 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:03,170 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:49:03,170 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:49:03,170 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:49:03,171 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:49:03,171 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:49:03,171 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:49:03,171 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:49:03,176 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 11:49:03,176 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 6c901fbb760c8f7234f1017f22857b2c
2025-11-21 11:49:03,176 - INFO - 批次重新生成完成
2025-11-21 11:49:12,004 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 11:49:12,004 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 11:49:12,004 - INFO - 步骤1: 生成缓存键...
2025-11-21 11:49:12,004 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:12,005 - INFO - 步骤2: 检查缓存...
2025-11-21 11:49:12,005 - INFO - 从缓存返回灌溉计划结果 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:17,090 - INFO - 所有缓存已清除
2025-11-21 11:49:21,476 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 11:49:21,477 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 11:49:21,477 - INFO - 步骤1: 生成缓存键...
2025-11-21 11:49:21,477 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:21,477 - INFO - 步骤2: 检查缓存...
2025-11-21 11:49:21,477 - INFO - 缓存未命中，继续执行...
2025-11-21 11:49:21,477 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 11:49:21,478 - INFO - pipeline模块导入成功
2025-11-21 11:49:21,478 - INFO - 步骤4: 设置默认参数...
2025-11-21 11:49:21,478 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,478 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:49:21,478 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 11:49:21,478 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,478 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 11:49:21,478 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 11:49:21,479 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 11:49:21,479 - INFO - Pipeline实例创建成功
2025-11-21 11:49:21,479 - INFO - 步骤8: 运行Pipeline...
2025-11-21 11:49:21,479 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 11:49:21,479 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:49:21,479 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 11:49:21,479 - INFO - 检查依赖文件...
2025-11-21 11:49:21,480 - INFO - 依赖文件检查通过
2025-11-21 11:49:21,480 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 11:49:21,481 - INFO - 找到 6 个GIS数据文件
2025-11-21 11:49:21,481 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 11:49:21,481 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 11:49:21,481 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 11:49:21,481 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 11:49:21,481 - INFO - 开始执行: GIS数据格式转换
2025-11-21 11:49:21,481 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 11:49:22,230 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 11:49:22,230 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 11:49:22,230 - INFO - 开始执行: GIS数据修复
2025-11-21 11:49:22,231 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 11:49:22,410 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 11:49:22,410 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 11:49:22,411 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 11:49:22,411 - INFO - 开始执行: 生成灌溉计划
2025-11-21 11:49:22,411 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json --multi-pump --summary --realtime
2025-11-21 11:49:24,371 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=33
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 33
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行31.59h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1137.31元 - 运行15.80h
推荐方案: 水泵['P1', 'P2'] (电费: 1137.31元, 运行时间: 15.80h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json

2025-11-21 11:49:24,371 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 11:49:24,372 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.892699
2025-11-21 11:49:24,373 - INFO - 生成的文件:
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 11:49:24,373 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 11:49:24,374 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 11:49:24,375 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 11:49:24,376 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 11:49:24,377 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 11:49:24,378 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 11:49:24,379 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 11:49:24,379 - INFO - Pipeline执行结果: success=True
2025-11-21 11:49:24,381 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 11:49:24,382 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 11:49:24,382 - INFO - 开始生成多水泵方案对比
2025-11-21 11:49:25,545 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 11:49:25,545 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 11:49:25,546 - INFO - 灌溉计划生成完成
2025-11-21 11:49:37,787 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 11:49:37,792 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:37,793 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:37,793 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 11:49:37,794 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 11:49:37,794 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 11:49:37,794 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 11:49:37,795 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 11:49:37,795 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 11:49:37,795 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 11:49:37,795 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 11:49:37,796 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 11:49:37,796 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 11:49:37,796 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 11:49:37,796 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 11:49:37,804 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696977.json
2025-11-21 11:49:37,805 - INFO - 批次重新生成结果已保存到缓存 - cache_key: feac38f3ba1ab8bfacb0bfc70e6798c4
2025-11-21 11:49:37,805 - INFO - 批次重新生成完成
2025-11-21 12:15:43,756 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:15:43,760 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:15:43,760 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:15:43,760 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P2']
2025-11-21 12:15:43,761 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P2': 22.428105936272082}
2025-11-21 12:15:43,761 - INFO - [时间修改] 批次 1 时长调整: 19.16h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:15:43,761 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:15:43,761 - INFO - [时间修改]   批次 2: 时长=12.43h, 水泵=['P1']
2025-11-21 12:15:43,762 - INFO - [时间修改] 计算完成 - total_duration=22.43h, total_deficit=5382.75m³, pump_runtime={'P1': 22.428105936272082}
2025-11-21 12:15:43,762 - INFO - [时间修改] 批次 1 时长调整: 30.82h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:15:43,762 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:15:43,762 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:15:43,762 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:15:43,767 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698543.json
2025-11-21 12:15:43,768 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:15:43,768 - INFO - 批次重新生成完成
2025-11-21 12:15:54,077 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:15:54,077 - INFO - 从缓存返回批次重新生成结果 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:18:16,580 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 12:18:16,580 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 12:19:04,005 - INFO - pipeline模块导入成功
2025-11-21 12:19:04,005 - INFO - 步骤4: 设置默认参数...
2025-11-21 12:19:04,005 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,005 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:19:04,006 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 12:19:04,006 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,006 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 12:19:04,006 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 12:19:04,007 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 12:19:04,007 - INFO - Pipeline实例创建成功
2025-11-21 12:19:04,007 - INFO - 步骤8: 运行Pipeline...
2025-11-21 12:19:04,007 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 12:19:04,007 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:19:04,007 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:19:04,008 - INFO - 检查依赖文件...
2025-11-21 12:19:04,008 - INFO - 依赖文件检查通过
2025-11-21 12:19:04,008 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:19:04,009 - INFO - 找到 6 个GIS数据文件
2025-11-21 12:19:04,009 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:19:04,009 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 12:19:04,010 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 12:19:04,010 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 12:19:04,010 - INFO - 开始执行: GIS数据格式转换
2025-11-21 12:19:04,010 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 12:19:04,749 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 12:19:04,749 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 12:19:04,749 - INFO - 开始执行: GIS数据修复
2025-11-21 12:19:04,749 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 12:19:04,916 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 12:19:04,917 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 12:19:04,917 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 12:19:04,918 - INFO - 开始执行: 生成灌溉计划
2025-11-21 12:19:04,918 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json --multi-pump --summary --realtime
2025-11-21 12:19:06,961 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行16.90h
推荐方案: 水泵['P1', 'P2'] (电费: 1217.10元, 运行时间: 16.90h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json

2025-11-21 12:19:06,962 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 12:19:06,962 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.955210
2025-11-21 12:19:06,963 - INFO - 生成的文件:
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 12:19:06,963 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 12:19:06,964 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 12:19:06,965 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 12:19:06,966 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 12:19:06,967 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114535.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_114922.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 12:19:06,968 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696825.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696943.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763696977.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698543.json
2025-11-21 12:19:06,969 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 12:19:06,969 - INFO - Pipeline执行结果: success=True
2025-11-21 12:19:06,971 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_121904.json
2025-11-21 12:19:06,972 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 12:19:06,973 - INFO - 开始生成多水泵方案对比
2025-11-21 12:19:08,122 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 12:19:08,122 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:19:08,122 - INFO - 灌溉计划生成完成
2025-11-21 12:19:12,890 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_114922.json
2025-11-21 12:19:12,894 - INFO - [时间修改] 批次 1 时长调整: 36.77h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:19:12,894 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:19:12,894 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:19:12,894 - INFO - [时间修改]   批次 2: 时长=23.57h, 水泵=['P2']
2025-11-21 12:19:12,894 - INFO - [时间修改] 计算完成 - total_duration=33.57h, total_deficit=8056.15m³, pump_runtime={'P2': 33.56727775000001}
2025-11-21 12:19:12,894 - INFO - [时间修改] 批次 1 时长调整: 36.77h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:19:12,895 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 2: 时长=23.57h, 水泵=['P1']
2025-11-21 12:19:12,895 - INFO - [时间修改] 计算完成 - total_duration=33.57h, total_deficit=8056.15m³, pump_runtime={'P1': 33.56727775000001}
2025-11-21 12:19:12,895 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:19:12,895 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:19:12,895 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:19:12,896 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:19:12,901 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698752.json
2025-11-21 12:19:12,901 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 13c4b11ff4c2325991614c6b77b3f407
2025-11-21 12:19:12,901 - INFO - 批次重新生成完成
2025-11-21 12:20:55,628 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 12:20:55,629 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 12:20:55,629 - INFO - 步骤1: 生成缓存键...
2025-11-21 12:20:55,629 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:20:55,629 - INFO - 步骤2: 检查缓存...
2025-11-21 12:20:55,629 - INFO - 从缓存返回灌溉计划结果 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:03,253 - INFO - 所有缓存已清除
2025-11-21 12:21:08,146 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 12:21:08,146 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 12:21:08,146 - INFO - 步骤1: 生成缓存键...
2025-11-21 12:21:08,147 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:08,147 - INFO - 步骤2: 检查缓存...
2025-11-21 12:21:08,147 - INFO - 缓存未命中，继续执行...
2025-11-21 12:21:08,147 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 12:21:08,147 - INFO - pipeline模块导入成功
2025-11-21 12:21:08,147 - INFO - 步骤4: 设置默认参数...
2025-11-21 12:21:08,147 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,147 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:21:08,148 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 12:21:08,148 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,148 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 12:21:08,148 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 12:21:08,148 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 12:21:08,149 - INFO - Pipeline实例创建成功
2025-11-21 12:21:08,149 - INFO - 步骤8: 运行Pipeline...
2025-11-21 12:21:08,149 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 12:21:08,149 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:21:08,149 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 12:21:08,149 - INFO - 检查依赖文件...
2025-11-21 12:21:08,150 - INFO - 依赖文件检查通过
2025-11-21 12:21:08,150 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 12:21:08,151 - INFO - 找到 6 个GIS数据文件
2025-11-21 12:21:08,151 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 12:21:08,151 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 12:21:08,151 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 12:21:08,152 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 12:21:08,152 - INFO - 开始执行: GIS数据格式转换
2025-11-21 12:21:08,152 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 12:21:08,902 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 12:21:08,903 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 12:21:08,903 - INFO - 开始执行: GIS数据修复
2025-11-21 12:21:08,903 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 12:21:09,090 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 12:21:09,091 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 12:21:09,091 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 12:21:09,091 - INFO - 开始执行: 生成灌溉计划
2025-11-21 12:21:09,091 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json --multi-pump --summary --realtime
2025-11-21 12:21:11,010 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行33.81h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1217.10元 - 运行16.90h
推荐方案: 水泵['P1', 'P2'] (电费: 1217.10元, 运行时间: 16.90h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json

2025-11-21 12:21:11,010 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 12:21:11,011 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.862057
2025-11-21 12:21:11,011 - INFO - 生成的文件:
2025-11-21 12:21:11,011 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 12:21:11,012 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 12:21:11,013 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 12:21:11,014 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 12:21:11,015 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 12:21:11,016 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 12:21:11,017 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 12:21:11,017 - INFO - Pipeline执行结果: success=True
2025-11-21 12:21:11,019 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 12:21:11,020 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 12:21:11,020 - INFO - 开始生成多水泵方案对比
2025-11-21 12:21:12,203 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 12:21:12,203 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 12:21:12,203 - INFO - 灌溉计划生成完成
2025-11-21 12:22:41,734 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_122109.json
2025-11-21 12:22:41,738 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:22:41,738 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:22:41,738 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 12:22:41,738 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 12:22:41,738 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 12:22:41,739 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 12:22:41,739 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 12:22:41,739 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 12:22:41,739 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 12:22:41,739 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 12:22:41,739 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 12:22:41,740 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 12:22:41,740 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 12:22:41,740 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 12:22:41,745 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 12:22:41,746 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 82435f3a933d3ec915402573ccd557d8
2025-11-21 12:22:41,746 - INFO - 批次重新生成完成
2025-11-21 13:09:38,955 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_122109.json
2025-11-21 13:09:38,959 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:09:38,959 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:09:38,959 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:09:38,959 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:09:38,959 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:09:38,960 - INFO - [时间修改] 批次 1 时长调整: 34.68h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:09:38,960 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:09:38,960 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:09:38,960 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:09:38,960 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:09:38,961 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:09:38,961 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:09:38,961 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:09:38,961 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:09:38,966 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 13:09:38,967 - INFO - 批次重新生成结果已保存到缓存 - cache_key: 82435f3a933d3ec915402573ccd557d8
2025-11-21 13:09:38,967 - INFO - 批次重新生成完成
2025-11-21 13:14:23,408 - INFO - 开始生成灌溉计划 - farm_id: 13944136728576
2025-11-21 13:14:23,408 - INFO - 请求参数: output_dir=, config_path=, multi_pump_scenarios=True
2025-11-21 13:14:23,408 - INFO - 步骤1: 生成缓存键...
2025-11-21 13:14:23,409 - INFO - 缓存键生成成功: 407aa85133e3f440f410a1e2f7904869
2025-11-21 13:14:23,409 - INFO - 步骤2: 检查缓存...
2025-11-21 13:14:23,409 - INFO - 缓存未命中，继续执行...
2025-11-21 13:14:23,409 - INFO - 步骤3: 导入pipeline模块...
2025-11-21 13:14:23,409 - INFO - pipeline模块导入成功
2025-11-21 13:14:23,410 - INFO - 步骤4: 设置默认参数...
2025-11-21 13:14:23,410 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,410 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 13:14:23,410 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 13:14:23,410 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,410 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 13:14:23,410 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': True}
2025-11-21 13:14:23,411 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 13:14:23,411 - INFO - Pipeline实例创建成功
2025-11-21 13:14:23,411 - INFO - 步骤8: 运行Pipeline...
2025-11-21 13:14:23,411 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 13:14:23,411 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 13:14:23,411 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 13:14:23,412 - INFO - 检查依赖文件...
2025-11-21 13:14:23,412 - INFO - 依赖文件检查通过
2025-11-21 13:14:23,412 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 13:14:23,413 - INFO - 找到 6 个GIS数据文件
2025-11-21 13:14:23,413 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 13:14:23,413 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 13:14:23,413 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 13:14:23,413 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 13:14:23,413 - INFO - 开始执行: GIS数据格式转换
2025-11-21 13:14:23,414 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 13:14:24,130 - INFO - 输出: 找到 3 个 .shp 文件
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 3/3 个文件

2025-11-21 13:14:24,131 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 13:14:24,131 - INFO - 开始执行: GIS数据修复
2025-11-21 13:14:24,131 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 13:14:24,312 - INFO - 输出: 找到 3 个 geojson 文件: ['港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 13:14:24,313 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 13:14:24,313 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 13:14:24,313 - INFO - 开始执行: 生成灌溉计划
2025-11-21 13:14:24,313 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json --multi-pump --summary --realtime
2025-11-21 13:14:26,358 - INFO - 输出: [DEBUG] 使用真实实时水位API
[DEBUG] 多水泵方案分析: 总田块数=36, 有水位数据=36, 无水位数据=0, 低于阈值=35
====== 多水泵方案对比摘要 ======
需要灌溉的地块总数: 35
需要灌溉的段: ['S3', 'S4', 'S5', 'S6', 'S7', 'S8']
有效水泵组合: [['P2'], ['P1'], ['P1', 'P2']]
生成方案数: 3
方案 1: 水泵['P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行33.78h
方案 2: 水泵['P1'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行33.78h
方案 3: 水泵['P1', 'P2'] - 覆盖段6个['S3', 'S4', 'S5', 'S6', 'S7', 'S8'] - 电费1216.14元 - 运行16.89h
推荐方案: 水泵['P1', 'P2'] (电费: 1216.14元, 运行时间: 16.89h)
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json

2025-11-21 13:14:26,358 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 13:14:26,358 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:02.947396
2025-11-21 13:14:26,359 - INFO - 生成的文件:
2025-11-21 13:14:26,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 13:14:26,359 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 13:14:26,360 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 13:14:26,361 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 13:14:26,362 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 13:14:26,363 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 13:14:26,364 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 13:14:26,365 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 13:14:26,366 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 13:14:26,366 - INFO - Pipeline执行结果: success=True
2025-11-21 13:14:26,368 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 13:14:26,369 - INFO - 成功读取计划数据，包含 3 项
2025-11-21 13:14:26,369 - INFO - 开始生成多水泵方案对比
2025-11-21 13:14:27,534 - INFO - 多水泵方案生成成功，共 3 个方案（触发阈值: 1个田块）
2025-11-21 13:14:27,534 - INFO - 灌溉计划结果已保存到缓存 - cache_key: 407aa85133e3f440f410a1e2f7904869
2025-11-21 13:14:27,534 - INFO - 灌溉计划生成完成
2025-11-21 13:14:40,187 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_131424.json
2025-11-21 13:14:40,190 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:40,190 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:40,190 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:14:40,191 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:14:40,191 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:40,191 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:14:40,191 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:14:40,192 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:14:40,192 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:14:40,192 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:14:40,192 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:14:40,192 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:14:40,198 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 13:14:40,198 - INFO - 批次重新生成结果已保存到缓存 - cache_key: fa9746c2b879c72934314d246ac04db4
2025-11-21 13:14:40,198 - INFO - 批次重新生成完成
2025-11-21 13:14:52,149 - INFO - 所有缓存已清除
2025-11-21 13:14:55,335 - INFO - 开始批次重新生成 - plan_id: E:/irrigation_schedule/farm_irrigation/data/output/irrigation_plan_20251121_131424.json
2025-11-21 13:14:55,339 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:55,339 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:55,339 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P2']
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P2']
2025-11-21 13:14:55,340 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P2': 35.65832275000001}
2025-11-21 13:14:55,340 - INFO - [时间修改] 批次 1 时长调整: 34.69h -> 10.00h, 供水量: 2400.00 m³
2025-11-21 13:14:55,340 - INFO - [时间修改] 重新计算scenario统计数据，共有 2 个批次
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1']
2025-11-21 13:14:55,340 - INFO - [时间修改]   批次 2: 时长=25.66h, 水泵=['P1']
2025-11-21 13:14:55,341 - INFO - [时间修改] 计算完成 - total_duration=35.66h, total_deficit=8558.00m³, pump_runtime={'P1': 35.65832275000001}
2025-11-21 13:14:55,341 - INFO - [时间修改] 批次 1 时长调整: 30.17h -> 10.00h, 供水量: 4800.00 m³
2025-11-21 13:14:55,341 - INFO - [时间修改] 重新计算scenario统计数据，共有 1 个批次
2025-11-21 13:14:55,341 - INFO - [时间修改]   批次 1: 时长=10.00h, 水泵=['P1', 'P2']
2025-11-21 13:14:55,341 - INFO - [时间修改] 计算完成 - total_duration=10.00h, total_deficit=4800.00m³, pump_runtime={'P1': 10.0, 'P2': 10.0}
2025-11-21 13:14:55,347 - INFO - 修改后的计划已保存到: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 13:14:55,347 - INFO - 批次重新生成结果已保存到缓存 - cache_key: fa9746c2b879c72934314d246ac04db4
2025-11-21 13:14:55,347 - INFO - 批次重新生成完成
2025-11-21 14:48:32,838 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 14:48:32,839 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 16:02:12,959 - INFO - pipeline模块导入成功
2025-11-21 16:02:12,959 - INFO - 步骤4: 设置默认参数...
2025-11-21 16:02:12,959 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,959 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:02:12,959 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 16:02:12,960 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,960 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 16:02:12,960 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 16:02:12,960 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 16:02:12,960 - INFO - Pipeline实例创建成功
2025-11-21 16:02:12,960 - INFO - 步骤8: 运行Pipeline...
2025-11-21 16:02:12,960 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 16:02:12,961 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:02:12,961 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:02:12,961 - INFO - 检查依赖文件...
2025-11-21 16:02:12,961 - INFO - 依赖文件检查通过
2025-11-21 16:02:12,961 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:02:12,962 - INFO - 找到 15 个GIS数据文件
2025-11-21 16:02:12,962 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:02:12,962 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 16:02:12,962 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 16:02:12,962 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 16:02:12,963 - INFO - 开始执行: GIS数据格式转换
2025-11-21 16:02:12,963 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 16:02:13,744 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 16:02:13,745 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 16:02:13,745 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 16:02:13,745 - INFO - 开始执行: GIS数据修复
2025-11-21 16:02:13,745 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 16:02:13,945 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 16:02:13,946 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 16:02:13,946 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 16:02:13,946 - INFO - 开始执行: 生成灌溉计划
2025-11-21 16:02:13,947 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json --summary --realtime
2025-11-21 16:02:14,804 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 30.29 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=16.84h  田块数=11
 - 批次2 ETA=13.45h  田块数=3
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json

2025-11-21 16:02:14,805 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 16:02:14,805 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.845081
2025-11-21 16:02:14,806 - INFO - 生成的文件:
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 16:02:14,806 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 16:02:14,807 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 16:02:14,808 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 16:02:14,809 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 16:02:14,810 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 16:02:14,811 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 16:02:14,812 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 16:02:14,813 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 16:02:14,813 - INFO - Pipeline执行结果: success=True
2025-11-21 16:02:14,815 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:02:14,816 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 16:02:14,816 - INFO - 灌溉计划结果已保存到缓存 - cache_key: c0cc3c6198d2babde967fc760ec8457a
2025-11-21 16:02:14,816 - INFO - 灌溉计划生成完成
2025-11-21 16:02:14,817 - INFO - 灌溉计划生成完成: 灌溉计划生成成功
2025-11-21 16:03:34,024 - INFO - 智能灌溉动态执行系统关闭中...
2025-11-21 16:03:34,024 - INFO - 智能灌溉动态执行系统已关闭
2025-11-21 16:18:29,209 - INFO - pipeline模块导入成功
2025-11-21 16:18:29,209 - INFO - 步骤4: 设置默认参数...
2025-11-21 16:18:29,209 - INFO - output_dir: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,209 - INFO - config_path: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:18:29,209 - INFO - 步骤5: 确保输出目录存在...
2025-11-21 16:18:29,210 - INFO - 输出目录已创建/确认: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,210 - INFO - 步骤6: 构建pipeline参数...
2025-11-21 16:18:29,210 - INFO - Pipeline参数: {'input_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\gzp_farm', 'output_dir': 'E:\\irrigation_schedule\\farm_irrigation\\data\\output', 'config_file': 'E:\\irrigation_schedule\\farm_irrigation\\config.json', 'merge_waterlevels': True, 'print_summary': True, 'multi_pump_scenarios': False}
2025-11-21 16:18:29,210 - INFO - 步骤7: 创建Pipeline实例...
2025-11-21 16:18:29,210 - INFO - Pipeline实例创建成功
2025-11-21 16:18:29,210 - INFO - 步骤8: 运行Pipeline...
2025-11-21 16:18:29,210 - INFO - 开始执行农场灌溉调度系统自动化流水线
2025-11-21 16:18:29,211 - INFO - 输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:18:29,211 - INFO - 输出目录: E:\irrigation_schedule\farm_irrigation\data\output
2025-11-21 16:18:29,211 - INFO - 检查依赖文件...
2025-11-21 16:18:29,211 - INFO - 依赖文件检查通过
2025-11-21 16:18:29,211 - INFO - 检查输入目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm
2025-11-21 16:18:29,212 - INFO - 找到 15 个GIS数据文件
2025-11-21 16:18:29,212 - INFO - 使用现有配置文件: E:\irrigation_schedule\farm_irrigation\config.json
2025-11-21 16:18:29,212 - INFO - 跳过配置生成步骤（保留 Rice 决策配置）
2025-11-21 16:18:29,212 - INFO - === 步骤1: 数据预处理 ===
2025-11-21 16:18:29,212 - INFO - 发现Shapefile文件，运行格式转换...
2025-11-21 16:18:29,212 - INFO - 开始执行: GIS数据格式转换
2025-11-21 16:18:29,213 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.farmgis_convert
2025-11-21 16:18:30,040 - INFO - 输出: 找到 6 个 .shp 文件
已转换: 岳麓水路.shp -> 岳麓水路_code.geojson
已转换: 岳麓田块.shp -> 岳麓田块_code.geojson
已转换: 岳麓阀门与节制闸.shp -> 岳麓阀门与节制闸_code.geojson
已转换: 港中坪水路.shp -> 港中坪水路_code.geojson
已转换: 港中坪田块.shp -> 港中坪田块_code.geojson
已转换: 港中坪阀门与节制闸.shp -> 港中坪阀门与节制闸_code.geojson
转换完成！共转换 6/6 个文件

2025-11-21 16:18:30,041 - WARNING - 警告: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(
C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\pyogrio\geopandas.py:710: UserWarning: 'crs' was not provided.  The output dataset will not have projection information defined and may not be usable in other systems.
  write(

2025-11-21 16:18:30,041 - INFO - [OK] GIS数据格式转换 执行成功
2025-11-21 16:18:30,041 - INFO - 开始执行: GIS数据修复
2025-11-21 16:18:30,042 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.converter.fix_farmgis_convert
2025-11-21 16:18:30,230 - INFO - 输出: 找到 9 个 geojson 文件: ['84911829811210_fields_code.geojson', '84911829811210_gates_code.geojson', '84911829811210_segments_code.geojson', '岳麓水路_code.geojson', '岳麓田块_code.geojson', '岳麓阀门与节制闸_code.geojson', '港中坪水路_code.geojson', '港中坪田块_code.geojson', '港中坪阀门与节制闸_code.geojson']
工作目录: E:\irrigation_schedule\farm_irrigation\data\gzp_farm

[处理] data/gzp_farm\84911829811210_fields_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\84911829811210_fields_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_fields_code.geojson

[处理] data/gzp_farm\84911829811210_gates_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\84911829811210_gates_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_gates_code.geojson

[处理] data/gzp_farm\84911829811210_segments_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\84911829811210_segments_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\84911829811210_segments_code.geojson

[处理] data/gzp_farm\岳麓水路_code.geojson
  总要素: 5  =>  保留: 5  删除: 0
  已备份 -> data/gzp_farm\岳麓水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓水路_code.geojson

[处理] data/gzp_farm\岳麓田块_code.geojson
  总要素: 25  =>  保留: 25  删除: 0
  已备份 -> data/gzp_farm\岳麓田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓田块_code.geojson

[处理] data/gzp_farm\岳麓阀门与节制闸_code.geojson
  总要素: 55  =>  保留: 55  删除: 0
  已备份 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\岳麓阀门与节制闸_code.geojson

[处理] data/gzp_farm\港中坪水路_code.geojson
  总要素: 9  =>  保留: 9  删除: 0
  已备份 -> data/gzp_farm\港中坪水路_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪水路_code.geojson

[处理] data/gzp_farm\港中坪田块_code.geojson
  总要素: 42  =>  保留: 42  删除: 0
  已备份 -> data/gzp_farm\港中坪田块_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪田块_code.geojson

[处理] data/gzp_farm\港中坪阀门与节制闸_code.geojson
  总要素: 57  =>  保留: 57  删除: 0
  已备份 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson.bak
  已写回清洗后的文件 -> data/gzp_farm\港中坪阀门与节制闸_code.geojson

完成。请刷新前端页面验证。

2025-11-21 16:18:30,231 - INFO - [OK] GIS数据修复 执行成功
2025-11-21 16:18:30,231 - INFO - === 步骤3: 灌溉计划生成 ===
2025-11-21 16:18:30,231 - INFO - 开始执行: 生成灌溉计划
2025-11-21 16:18:30,232 - INFO - 命令: C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe -m src.core.run_irrigation_plan --out E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json --summary --realtime
2025-11-21 16:18:31,020 - INFO - 输出: [DEBUG] 使用真实实时水位API
====== 灌溉决策摘要 ======
总 ETA: 30.29 h
并灌时窗: 20.0 h
目标补水深: 90.0 mm
等效泵流量: 240.0 m3/h
灌溉批次: 2 批
 - 批次1 ETA=16.84h  田块数=11
 - 批次2 ETA=13.45h  田块数=3
[done] 计划已写入：E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json

2025-11-21 16:18:31,021 - INFO - [OK] 生成灌溉计划 执行成功
2025-11-21 16:18:31,021 - INFO - [SUCCESS] 流水线执行完成！总耗时: 0:00:01.811414
2025-11-21 16:18:31,022 - INFO - 生成的文件:
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_133959.json
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_134752.json
2025-11-21 16:18:31,022 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_165622.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251110_234901_reordered_20251110_235632.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_105505.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251111_205429.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_214549.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251112_215837_reordered_20251112_220007.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247.json
2025-11-21 16:18:31,023 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_101247_reordered_20251113_101347.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251113_121622_reordered_20251113_121642.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_155901.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_160910.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161407.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_161633.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162125.json
2025-11-21 16:18:31,024 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162252.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_162648.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204040.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_204940_reordered_20251114_204956.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_205414_reordered_20251114_205421.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251114_220359.json
2025-11-21 16:18:31,025 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251116_002515.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_122801.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131419.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_131936.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132247.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_132710.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135808.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251120_135832.json
2025-11-21 16:18:31,026 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_122109.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_131424.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_160213.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762845153.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_manual_regen_1762998753.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753218.json
2025-11-21 16:18:31,027 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1762753686.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108354.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763108366.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763698961.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763701778.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702080.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_modified_1763702095.json
2025-11-21 16:18:31,028 - INFO -   - E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_selfcheck_20251121_091623.json
2025-11-21 16:18:31,029 - INFO - Pipeline执行结果: success=True
2025-11-21 16:18:31,032 - INFO - 读取计划文件: E:\irrigation_schedule\farm_irrigation\data\output\irrigation_plan_20251121_161830.json
2025-11-21 16:18:31,033 - INFO - 成功读取计划数据，包含 8 项
2025-11-21 16:18:31,033 - INFO - 灌溉计划结果已保存到缓存 - cache_key: c0cc3c6198d2babde967fc760ec8457a
2025-11-21 16:18:31,033 - INFO - 灌溉计划生成完成
2025-11-21 16:18:31,034 - INFO - 灌溉计划生成完成: 灌溉计划生成成功
