{
  "info": {
    "name": "çŒæº‰ç³»ç»ŸAPIæµ‹è¯•é›†åˆ",
    "description": "å†œåœºçŒæº‰ç®¡ç†ç³»ç»Ÿå®Œæ•´APIæµ‹è¯•é›†åˆ",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. ç³»ç»Ÿç®¡ç†",
      "item": [
        {
          "name": "ç³»ç»Ÿåˆå§‹åŒ–",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_file_path\": \"/path/to/config.json\",\n  \"force_reinit\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/system/init",
              "host": ["{{base_url}}"],
              "path": ["api", "system", "init"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€ç ä¸º200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æˆåŠŸæ ‡è¯†\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "å¥åº·æ£€æŸ¥",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/system/health-check",
              "host": ["{{base_url}}"],
              "path": ["api", "system", "health-check"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æœåŠ¡å¥åº·çŠ¶æ€æ­£å¸¸\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql(\"healthy\");",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. åŠ¨æ€æ‰§è¡Œ",
      "item": [
        {
          "name": "å¯åŠ¨åŠ¨æ€æ‰§è¡Œ",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_file_path\": \"{{plan_id}}\",\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_file_path\": \"\",\n  \"auto_start\": true,\n  \"water_level_update_interval_minutes\": 30,\n  \"enable_plan_regeneration\": true,\n  \"execution_mode\": \"simulation\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/execution/start",
              "host": ["{{base_url}}"],
              "path": ["api", "execution", "start"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰§è¡Œå¯åŠ¨æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // ä¿å­˜execution_idä¾›åç»­ä½¿ç”¨",
                  "    if (jsonData.data && jsonData.data.execution_id) {",
                  "        pm.environment.set(\"execution_id\", jsonData.data.execution_id);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/execution/status?execution_id={{execution_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "execution", "status"],
              "query": [
                {
                  "key": "execution_id",
                  "value": "{{execution_id}}"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"çŠ¶æ€æŸ¥è¯¢æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property(\"status\");",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«scenarioä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.selected_scenario) {",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"scenario_name\");",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"pumps_used\");",
                  "        pm.expect(jsonData.data.selected_scenario).to.have.property(\"total_batches\");",
                  "        console.log(\"å½“å‰æ‰§è¡Œçš„scenario:\", jsonData.data.selected_scenario.scenario_name);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "åœæ­¢æ‰§è¡Œ",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"execution_id\": \"{{execution_id}}\",\n  \"reason\": \"æ‰‹åŠ¨åœæ­¢æµ‹è¯•\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/execution/stop",
              "host": ["{{base_url}}"],
              "path": ["api", "execution", "stop"]
            }
          }
        }
      ]
    },
    {
      "name": "3. æ°´ä½ç®¡ç†",
      "item": [
        {
          "name": "æ›´æ–°æ°´ä½æ•°æ®",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"field_id\": \"{{field_id}}\",\n  \"water_level_mm\": {{water_level}},\n  \"timestamp\": \"2025-01-01T12:00:00Z\",\n  \"source\": \"manual\",\n  \"quality\": \"good\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/water-levels/update",
              "host": ["{{base_url}}"],
              "path": ["api", "water-levels", "update"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ°´ä½æ›´æ–°æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–æ°´ä½å†å²",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/history?farm_id={{farm_id}}&field_id={{field_id}}&hours=24",
              "host": ["{{base_url}}"],
              "path": ["api", "water-levels", "history"],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "field_id",
                  "value": "{{field_id}}"
                },
                {
                  "key": "hours",
                  "value": "24"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–æ°´ä½æ±‡æ€»",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/water-levels/summary?farm_id={{farm_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "water-levels", "summary"],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "4. è®¡åˆ’é‡æ–°ç”Ÿæˆ",
      "item": [
        {
          "name": "æ‰‹åŠ¨é‡æ–°ç”Ÿæˆï¼ˆæ°´ä½ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"batch_index\": 1,\n  \"custom_water_levels\": {\n    \"S3-G5-F3\": {{custom_water_level}}\n  },\n  \"custom_water_level_standards\": {\n    \"S3-G5-F3\": {\n      \"wl_low\": {{custom_wl_low}},\n      \"wl_opt\": {{custom_wl_opt}},\n      \"wl_high\": {{custom_wl_high}}\n    }\n  },\n  \"force_regeneration\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/manual",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "manual"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"é‡æ–°ç”Ÿæˆè¯·æ±‚æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«æ°´ä½æ ‡å‡†å‚æ•°\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('wl_low');",
                  "    pm.expect(jsonData).to.have.property('wl_opt');",
                  "    pm.expect(jsonData).to.have.property('wl_high');",
                  "    pm.expect(jsonData).to.have.property('d_target_mm');",
                  "    ",
                  "    console.log('\\n=== å…¨å±€æ°´ä½æ ‡å‡†å‚æ•° ===');",
                  "    console.log('ä½æ°´ä½é˜ˆå€¼ (wl_low): ' + jsonData.wl_low + ' mm - è§¦å‘çŒæº‰çš„åˆ¤æ–­æ ‡å‡†');",
                  "    console.log('æœ€ä¼˜æ°´ä½ (wl_opt): ' + jsonData.wl_opt + ' mm - ç†æƒ³çš„ç”°é—´æŒæ°´é‡');",
                  "    console.log('é«˜æ°´ä½é˜ˆå€¼ (wl_high): ' + jsonData.wl_high + ' mm - è¶…è¿‡åˆ™ä¸éœ€è¦çŒæº‰');",
                  "    console.log('ç›®æ ‡çŒæº‰æ°´æ·± (d_target_mm): ' + jsonData.d_target_mm + ' mm - æ¯æ¬¡çŒæº‰å¢åŠ çš„æ°´æ·±');",
                  "    ",
                  "    // æ£€æŸ¥ç”°å—çº§æ°´ä½æ ‡å‡†ï¼ˆå¦‚æœæœ‰è‡ªå®šä¹‰ï¼‰",
                  "    if (jsonData.field_water_level_standards) {",
                  "        console.log('\\n=== ç”°å—çº§æ°´ä½æ ‡å‡†ï¼ˆè‡ªå®šä¹‰ï¼‰ ===');",
                  "        Object.keys(jsonData.field_water_level_standards).forEach(function(fieldId) {",
                  "            var standards = jsonData.field_water_level_standards[fieldId];",
                  "            console.log('ç”°å— ' + fieldId + ':');",
                  "            console.log('  - wl_low: ' + standards.wl_low + ' mm');",
                  "            console.log('  - wl_opt: ' + standards.wl_opt + ' mm');",
                  "            console.log('  - wl_high: ' + standards.wl_high + ' mm');",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–æ‰§è¡ŒçŠ¶æ€",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/execution/status",
              "host": ["{{base_url}}"],
              "path": ["api", "execution", "status"]
            }
          }
        },
        {
          "name": "æ‰¹æ¬¡é‡æ–°ç”Ÿæˆï¼ˆç”°å—+æ—¶é—´ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"scenario_name\": null,\n  \"field_modifications\": [\n    {\n      \"field_id\": \"{{test_field_add}}\",\n      \"action\": \"add\",\n      \"custom_water_level\": {{custom_water_level}}\n    },\n    {\n      \"field_id\": \"{{test_field_remove}}\",\n      \"action\": \"remove\"\n    }\n  ],\n  \"time_modifications\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"start_time_h\": {{start_time_h}},\n      \"duration_h\": {{duration_h}}\n    }\n  ],\n  \"regeneration_params\": {\n    \"force_regeneration\": true,\n    \"optimize_schedule\": true\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/batch",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "batch"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é‡æ–°ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.original_plan).to.exist;",
                  "    pm.expect(jsonData.modified_plan).to.exist;",
                  "    pm.expect(jsonData.modifications_summary).to.exist;",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜æ–°ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„åˆ°plan_idç¯å¢ƒå˜é‡",
                  "    if (jsonData.modified_plan_path) {",
                  "        pm.environment.set('plan_id', jsonData.modified_plan_path);",
                  "        console.log('âœ… æ–°æ–‡ä»¶è·¯å¾„å·²è‡ªåŠ¨ä¿å­˜åˆ°plan_id:', jsonData.modified_plan_path);",
                  "        console.log('ğŸ’¡ æç¤ºï¼šå¯ä»¥ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºä¸‹ä¸€æ¬¡ä¿®æ”¹çš„è¾“å…¥ï¼');",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"ä¿®æ”¹æ‘˜è¦åŒ…å«é¢„æœŸå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    pm.expect(summary.field_modifications).to.be.an('array');",
                  "    pm.expect(summary.time_modifications).to.be.an('array');",
                  "    pm.expect(summary.total_changes).to.be.a('number');",
                  "    console.log('\\n=== æ¥å£1-ALL: åªä¿®æ”¹ç”°å—å’Œæ—¶é—´ï¼Œä¸æ¶‰åŠæ°´æ³µ ===');",
                  "});",
                  "",
                  "pm.test(\"ä¿®æ”¹æ‘˜è¦åŒ…å«scenarioç»Ÿè®¡ä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    ",
                  "    console.log('\\n=== Scenarioä¿®æ”¹ç»Ÿè®¡ ===');",
                  "    if (summary.scenarios_modified) {",
                  "        console.log('å·²ä¿®æ”¹çš„scenarios:', summary.scenarios_modified.join(', '));",
                  "    }",
                  "    if (summary.scenarios_unchanged) {",
                  "        console.log('æœªä¿®æ”¹çš„scenarios:', summary.scenarios_unchanged.join(', '));",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ‰¹æ¬¡é‡æ–°ç”Ÿæˆï¼ˆæ°´æ³µ+æ—¶é—´ï¼‰",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"scenario_name\": \"{{scenario_name}}\",\n  \"pump_assignments\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"pump_ids\": [\"{{pump_id_1}}\"]\n    }\n  ],\n  \"time_modifications\": [\n    {\n      \"batch_index\": {{batch_index}},\n      \"start_time_h\": {{start_time_h}},\n      \"duration_h\": {{duration_h}}\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/regeneration/batch",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "batch"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é‡æ–°ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜æ–°ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„åˆ°plan_idç¯å¢ƒå˜é‡",
                  "    if (jsonData.modified_plan_path) {",
                  "        pm.environment.set('plan_id', jsonData.modified_plan_path);",
                  "        console.log('âœ… æ–°æ–‡ä»¶è·¯å¾„å·²è‡ªåŠ¨ä¿å­˜åˆ°plan_id:', jsonData.modified_plan_path);",
                  "        console.log('ğŸ’¡ æç¤ºï¼šå¯ä»¥ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºä¸‹ä¸€æ¬¡ä¿®æ”¹çš„è¾“å…¥ï¼');",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"åªä¿®æ”¹äº†æŒ‡å®šçš„scenario\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.modifications_summary;",
                  "    ",
                  "    console.log('\\n=== æ¥å£2-scenario: æ°´æ³µ+æ—¶é—´ä¿®æ”¹ï¼ˆåªå½±å“æŒ‡å®šscenarioï¼‰ ===');",
                  "    console.log('æŒ‡å®šä¿®æ”¹:', pm.environment.get('scenario_name'));",
                  "    ",
                  "    if (summary.scenarios_modified) {",
                  "        console.log('å®é™…ä¿®æ”¹çš„scenarios:', summary.scenarios_modified);",
                  "        pm.expect(summary.scenarios_modified).to.include(pm.environment.get('scenario_name'));",
                  "    }",
                  "    ",
                  "    if (summary.scenarios_unchanged) {",
                  "        console.log('æœªä¿®æ”¹çš„scenarios:', summary.scenarios_unchanged);",
                  "    }",
                  "    ",
                  "    // éªŒè¯æ°´æ³µåˆ†é…ä¸­åŒ…å«scenarios_affectedå­—æ®µ",
                  "    if (summary.pump_assignments && summary.pump_assignments.length > 0) {",
                  "        pm.expect(summary.pump_assignments[0]).to.have.property('scenarios_affected');",
                  "        console.log('\\nå—å½±å“çš„scenarios:', summary.pump_assignments[0].scenarios_affected);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æŸ¥è¯¢å¯ç”¨æ–¹æ¡ˆåç§°",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/regeneration/scenarios",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "scenarios"],
              "query": [
                {
                  "key": "plan_id",
                  "value": "{{plan_id}}",
                  "description": "å¯é€‰ï¼šæŒ‡å®šè®¡åˆ’IDæˆ–æ–‡ä»¶è·¯å¾„ã€‚ä¸æä¾›åˆ™è‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„è®¡åˆ’æ–‡ä»¶",
                  "disabled": true
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æŸ¥è¯¢scenariosæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.exist;",
                  "    pm.expect(jsonData.data.available_scenarios).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨scenarios\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var scenarios = jsonData.data.available_scenarios;",
                  "    ",
                  "    console.log('\\n=== å¯ç”¨çš„Scenarios ===');",
                  "    console.log('æ€»æ•°:', jsonData.data.total_scenarios);",
                  "    console.log('');",
                  "    ",
                  "    scenarios.forEach(function(scenario, index) {",
                  "        console.log(`${index + 1}. ${scenario.scenario_name}`);",
                  "        console.log(`   æ°´æ³µ: ${scenario.pumps_used.join(', ')}`);",
                  "        console.log(`   æ‰¹æ¬¡æ•°: ${scenario.total_batches}`);",
                  "        console.log(`   æ€»æ—¶é•¿: ${scenario.total_eta_h.toFixed(1)}h`);",
                  "        console.log(`   æ€»ç”µè´¹: Â¥${scenario.total_electricity_cost.toFixed(2)}`);",
                  "        if (scenario.optimization_goal) {",
                  "            console.log(`   ä¼˜åŒ–ç›®æ ‡: ${scenario.optimization_goal}`);",
                  "        }",
                  "        console.log('');",
                  "    });",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜ç¬¬ä¸€ä¸ªscenarioåç§°åˆ°ç¯å¢ƒå˜é‡",
                  "    if (scenarios.length > 0) {",
                  "        pm.environment.set('scenario_name', scenarios[0].scenario_name);",
                  "        console.log('âœ… å·²è‡ªåŠ¨è®¾ç½®scenario_nameä¸º:', scenarios[0].scenario_name);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ¸…é™¤ç¼“å­˜",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/regeneration/clear-cache",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "clear-cache"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ¸…é™¤ç¼“å­˜æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    console.log('âœ…', jsonData.message);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "è·å–é‡æ–°ç”Ÿæˆæ‘˜è¦",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/regeneration/summary/{{farm_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "regeneration", "summary", "{{farm_id}}"]
            }
          }
        },
        {
          "name": "æ‰¹æ¬¡é—´ç”°å—è°ƒæ•´",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_id\": \"{{plan_id}}\",\n  \"field_adjustments\": [\n    {\n      \"field_id\": \"{{field_id_move_1}}\",\n      \"from_batch\": {{from_batch_1}},\n      \"to_batch\": {{to_batch_1}}\n    },\n    {\n      \"field_id\": \"{{field_id_move_2}}\",\n      \"from_batch\": {{from_batch_2}},\n      \"to_batch\": {{to_batch_2}}\n    }\n  ],\n  \"options\": {\n    \"recalculate_sequence\": true,\n    \"recalculate_timing\": true,\n    \"maintain_pump_assignments\": true,\n    \"regenerate_commands\": true\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/batch/adjust",
              "host": ["{{base_url}}"],
              "path": ["api", "batch", "adjust"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é—´ç”°å—è°ƒæ•´æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.original_plan).to.exist;",
                  "    pm.expect(jsonData.adjusted_plan).to.exist;",
                  "    pm.expect(jsonData.changes_summary).to.exist;",
                  "});",
                  "",
                  "pm.test(\"å˜æ›´æ‘˜è¦åŒ…å«é¢„æœŸå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.changes_summary;",
                  "    pm.expect(summary.total_fields_moved).to.be.a('number');",
                  "    pm.expect(summary.affected_batches).to.be.an('array');",
                  "    pm.expect(summary.field_movements).to.be.an('array');",
                  "    pm.expect(summary.batch_time_changes).to.be.an('array');",
                  "    ",
                  "    console.log('\\n=== æ‰¹æ¬¡è°ƒæ•´ç»“æœ ===');",
                  "    console.log('ç§»åŠ¨ç”°å—æ•°: ' + summary.total_fields_moved);",
                  "    console.log('å—å½±å“æ‰¹æ¬¡: ' + summary.affected_batches.join(', '));",
                  "    ",
                  "    if (summary.batch_time_changes && summary.batch_time_changes.length > 0) {",
                  "        console.log('\\næ‰¹æ¬¡æ—¶é—´å˜åŒ–:');",
                  "        summary.batch_time_changes.forEach(function(change) {",
                  "            console.log('  æ‰¹æ¬¡' + change.batch_index + ': ' + change.old_duration_h + 'h -> ' + change.new_duration_h + 'h (å˜åŒ–: ' + change.time_diff_h + 'h)');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"éªŒè¯é€šè¿‡\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.validation).to.exist;",
                  "    pm.expect(jsonData.validation.is_valid).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "æ‰¹æ¬¡é—´é¡ºåºè°ƒæ•´",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"plan_id\": \"{{plan_id}}\",\n  \"scenario_name\": \"{{scenario_name}}\",\n  \"new_order\": [2, 1]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/batch/reorder",
              "host": ["{{base_url}}"],
              "path": ["api", "batch", "reorder"]
            },
            "description": "è°ƒæ•´æ‰¹æ¬¡çš„æ‰§è¡Œé¡ºåº\n\n**å‚æ•°è¯´æ˜**:\n- plan_id: è®¡åˆ’IDæˆ–æ–‡ä»¶è·¯å¾„\n- scenario_name: æŒ‡å®šè¦è°ƒæ•´çš„scenarioåç§°ï¼ˆå»ºè®®æŒ‡å®šï¼‰\n- new_order: æ–°çš„æ‰¹æ¬¡æ‰§è¡Œé¡ºåºï¼Œä¾‹å¦‚ [2, 1, 3] è¡¨ç¤ºæ‰¹æ¬¡2å…ˆæ‰§è¡Œï¼Œç„¶åæ‰¹æ¬¡1ï¼Œæœ€åæ‰¹æ¬¡3\n\n**âš ï¸ é‡è¦**:\nä¸åŒscenarioçš„æ‰¹æ¬¡æ•°é‡å¯èƒ½ä¸åŒï¼š\n- P1å•ç‹¬ä½¿ç”¨ï¼š10ä¸ªæ‰¹æ¬¡\n- P2å•ç‹¬ä½¿ç”¨ï¼š10ä¸ªæ‰¹æ¬¡\n- P1+P2ç»„åˆä½¿ç”¨ï¼š5ä¸ªæ‰¹æ¬¡ï¼ˆåŒæ³µæµé‡å¤§ï¼‰\n\nå»ºè®®æ˜ç¡®æŒ‡å®šscenario_nameå‚æ•°ï¼Œé¿å…æ‰¹æ¬¡æ•°é‡ä¸åŒ¹é…é”™è¯¯ã€‚\n\n**ä½¿ç”¨åœºæ™¯**:\n- æ‰¹æ¬¡2çš„ç”°å—éœ€è¦ä¼˜å…ˆçŒæº‰\n- æ ¹æ®å¤©æ°”æˆ–èµ„æºæƒ…å†µè°ƒæ•´çŒæº‰é¡ºåº\n- ä¸´æ—¶åº”æ€¥è°ƒæ•´"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"æ‰¹æ¬¡é¡ºåºè°ƒæ•´æˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.original_plan).to.exist;",
                  "    pm.expect(jsonData.reordered_plan).to.exist;",
                  "    pm.expect(jsonData.changes_summary).to.exist;",
                  "});",
                  "",
                  "pm.test(\"é¡ºåºå˜æ›´æ‘˜è¦åŒ…å«é¢„æœŸå­—æ®µ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var summary = jsonData.changes_summary;",
                  "    pm.expect(summary.order_changed).to.be.a('boolean');",
                  "    pm.expect(summary.original_order).to.be.an('array');",
                  "    pm.expect(summary.new_order).to.be.an('array');",
                  "    pm.expect(summary.batch_changes).to.be.an('array');",
                  "    ",
                  "    console.log('\\n=== æ‰¹æ¬¡é¡ºåºè°ƒæ•´ç»“æœ ===');",
                  "    console.log('åŸé¡ºåº: [' + summary.original_order.join(', ') + ']');",
                  "    console.log('æ–°é¡ºåº: [' + summary.new_order.join(', ') + ']');",
                  "    console.log('æ€»æ‰¹æ¬¡æ•°: ' + summary.total_batches);",
                  "    ",
                  "    if (summary.batch_changes && summary.batch_changes.length > 0) {",
                  "        console.log('\\næ‰¹æ¬¡ä½ç½®å˜åŒ–:');",
                  "        summary.batch_changes.forEach(function(change) {",
                  "            var direction = change.position_change > 0 ? 'åç§»' : (change.position_change < 0 ? 'å‰ç§»' : 'ä¸å˜');",
                  "            console.log('  ' + change.batch_name + ': ç¬¬' + change.original_position + 'ä½ -> ç¬¬' + change.new_position + 'ä½ (' + direction + ')');",
                  "            if (change.time_change && Object.keys(change.time_change).length > 0) {",
                  "                console.log('    æ—¶é—´: ' + change.time_change.original_start + 'h -> ' + change.time_change.new_start + 'h');",
                  "            }",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"éªŒè¯é€šè¿‡\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.validation).to.exist;",
                  "    pm.expect(jsonData.validation.is_valid).to.be.true;",
                  "});",
                  "",
                  "// è‡ªåŠ¨ä¿å­˜è¾“å‡ºæ–‡ä»¶è·¯å¾„",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.output_file) {",
                  "        pm.environment.set('plan_id', jsonData.output_file);",
                  "        console.log('\\nå·²è‡ªåŠ¨æ›´æ–° plan_id: ' + jsonData.output_file);",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5. æ‰¹æ¬¡ç®¡ç†",
      "item": [
        {
          "name": "è·å–æ‰¹æ¬¡åˆ—è¡¨",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/batches?farm_id={{farm_id}}&status=active",
              "host": ["{{base_url}}"],
              "path": ["api", "batches"],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                },
                {
                  "key": "status",
                  "value": "active"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–æ‰¹æ¬¡è¯¦æƒ…",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/batches/{{batch_index}}/details",
              "host": ["{{base_url}}"],
              "path": ["api", "batches", "{{batch_index}}", "details"]
            }
          }
        }
      ]
    },
    {
      "name": "6. çŒæº‰è®¡åˆ’ç”Ÿæˆ",
      "item": [
        {
          "name": "ç”ŸæˆçŒæº‰è®¡åˆ’",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"farm_id\": \"{{farm_id}}\",\n  \"config_path\": \"{{config_file_path}}\",\n  \"output_dir\": \"{{output_dir}}\",\n  \"scenario_name\": \"test_scenario\",\n  \"multi_pump_scenarios\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-generation",
              "host": ["{{base_url}}"],
              "path": ["api", "irrigation", "plan-generation"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"è®¡åˆ’ç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    ",
                  "    // ä¿å­˜plan_idä¾›åç»­ä½¿ç”¨ï¼ˆplan_idåœ¨å“åº”æ ¹çº§åˆ«ï¼‰",
                  "    if (jsonData.plan_id) {",
                  "        pm.environment.set(\"plan_id\", jsonData.plan_id);",
                  "        console.log(\"âœ… plan_idå·²è‡ªåŠ¨è®¾ç½®: \" + jsonData.plan_id);",
                  "    } else {",
                  "        console.log(\"âš ï¸ å“åº”ä¸­æ²¡æœ‰æ‰¾åˆ°plan_id\");",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "ä¸Šä¼ å¹¶ç”Ÿæˆè®¡åˆ’",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "config_file",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}",
                  "type": "text"
                },
                {
                  "key": "scenario_name",
                  "value": "upload_test",
                  "type": "text"
                },
                {
                  "key": "multi_pump_scenarios",
                  "value": "true",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-with-upload",
              "host": ["{{base_url}}"],
              "path": ["api", "irrigation", "plan-with-upload"]
            }
          }
        },
        {
          "name": "å¤šæ°´æ³µæ–¹æ¡ˆå¯¹æ¯”",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"config_file\": \"config.json\",\n  \"active_pumps\": null,\n  \"zone_ids\": null,\n  \"use_realtime_wl\": true,\n  \"min_fields_trigger\": {{min_fields_trigger}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/multi-pump-scenarios",
              "host": ["{{base_url}}"],
              "path": ["api", "irrigation", "multi-pump-scenarios"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"å¤šæ°´æ³µæ–¹æ¡ˆç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.scenarios).to.be.an('array');",
                  "    pm.expect(jsonData.analysis).to.be.an('object');",
                  "    pm.expect(jsonData.total_scenarios).to.be.a('number');",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«è§¦å‘æ¡ä»¶ä¿¡æ¯\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.analysis) {",
                  "        pm.expect(jsonData.analysis).to.have.property('min_fields_trigger');",
                  "        console.log('è§¦å‘é˜ˆå€¼:', jsonData.analysis.min_fields_trigger);",
                  "        console.log('ä½äºé˜ˆå€¼çš„ç”°å—æ•°:', jsonData.analysis.total_fields_below_threshold);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "çŒæº‰è®¡åˆ’ä¼˜åŒ–",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"original_plan_id\": \"{{plan_id}}\",\n  \"optimization_goals\": [\n    \"cost_minimization\",\n    \"time_minimization\",\n    \"balanced\",\n    \"off_peak\"\n  ],\n  \"constraints\": {\n    \"max_duration_hours\": 24,\n    \"electricity_price_schedule\": {\n      \"peak\": {\n        \"hours\": [8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],\n        \"price\": 1.0\n      },\n      \"valley\": {\n        \"hours\": [22, 23, 0, 1, 2, 3, 4, 5, 6, 7],\n        \"price\": 0.4\n      }\n    },\n    \"available_pumps\": [\"P1\", \"P2\"]\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/irrigation/plan-optimization",
              "host": ["{{base_url}}"],
              "path": ["api", "irrigation", "plan-optimization"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"ä¼˜åŒ–æ–¹æ¡ˆç”ŸæˆæˆåŠŸ\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.total_scenarios).to.be.above(0);",
                  "});",
                  "",
                  "pm.test(\"å“åº”åŒ…å«ä¼˜åŒ–æ–¹æ¡ˆ\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.scenarios).to.be.an('array');",
                  "    pm.expect(jsonData.comparison).to.be.an('object');",
                  "    pm.expect(jsonData.base_plan_summary).to.be.an('object');",
                  "    ",
                  "    console.log('\\n=== ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯” ===');",
                  "    jsonData.scenarios.forEach(function(scenario) {",
                  "        console.log(scenario.name + ':');",
                  "        console.log('  - æ€»æ—¶é•¿: ' + scenario.total_eta_h.toFixed(1) + 'å°æ—¶');",
                  "        console.log('  - æ€»ç”µè´¹: Â¥' + scenario.total_electricity_cost.toFixed(2));",
                  "        console.log('  - è¯´æ˜: ' + scenario.description);",
                  "    });",
                  "    ",
                  "    console.log('\\næ¨èæ–¹æ¡ˆ: ' + jsonData.comparison.recommended);",
                  "    console.log('ç”µè´¹èŒƒå›´: Â¥' + jsonData.comparison.cost_range.min.toFixed(2) + ' - Â¥' + jsonData.comparison.cost_range.max.toFixed(2));",
                  "    console.log('æ—¶é•¿èŒƒå›´: ' + jsonData.comparison.time_range.min.toFixed(1) + 'h - ' + jsonData.comparison.time_range.max.toFixed(1) + 'h');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "7. Webå¯è§†åŒ–",
      "item": [
        {
          "name": "è·å–GeoJSONæ•°æ®",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/geojson/fields?farm_id={{farm_id}}",
              "host": ["{{base_url}}"],
              "path": ["geojson", "fields"],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                }
              ]
            }
          }
        },
        {
          "name": "è·å–ç›‘æ§é¢æ¿æ•°æ®",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/monitoring/dashboard?farm_id={{farm_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "monitoring", "dashboard"],
              "query": [
                {
                  "key": "farm_id",
                  "value": "{{farm_id}}"
                }
              ]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€é¢„è¯·æ±‚è„šæœ¬",
          "console.log('å‘é€è¯·æ±‚åˆ°:', pm.request.url);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€æµ‹è¯•è„šæœ¬",
          "pm.test('å“åº”æ—¶é—´å°äº5ç§’', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});"
        ]
      }
    }
  ]
}